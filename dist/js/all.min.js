function BlendCharacterGui(t){var e={gui:null,"Show Model":!0,"Show Skeleton":!1,"Time Scale":1,"Step Size":.016,"Crossfade Time":3.5,idle:.33,walk:.33,run:.33},t=t;this.showModel=function(){return e["Show Model"]},this.showSkeleton=function(){return e["Show Skeleton"]},this.getTimeScale=function(){return e["Time Scale"]},this.update=function(i){e.idle=t.getWeight("idle"),e.walk=t.getWeight("walk"),e.run=t.getWeight("run")};var i=function(){e.gui=new dat.GUI;var t=e.gui.addFolder("Settings"),i=e.gui.addFolder("Playback"),o=e.gui.addFolder("Blend Tuning");t.add(e,"Show Model").onChange(e.showModelChanged),t.add(e,"Show Skeleton").onChange(e.showSkeletonChanged),t.add(e,"Time Scale",0,1,.01),t.add(e,"Step Size",.01,.1,.01),t.add(e,"Crossfade Time",.1,6,.05),i.add(e,"start"),i.add(e,"pause"),i.add(e,"step"),i.add(e,"idle to walk"),i.add(e,"walk to run"),i.add(e,"warp walk to run"),o.add(e,"idle",0,1,.01).listen().onChange(e.weight),o.add(e,"walk",0,1,.01).listen().onChange(e.weight),o.add(e,"run",0,1,.01).listen().onChange(e.weight),t.open(),i.open(),o.open()},o=function(){return{detail:{anims:["idle","walk","run"],weights:[e.idle,e.walk,e.run]}}};e.start=function(){var t=new CustomEvent("start-animation",o());window.dispatchEvent(t)},e.stop=function(){var t=new CustomEvent("stop-animation");window.dispatchEvent(t)},e.pause=function(){var t=new CustomEvent("pause-animation");window.dispatchEvent(t)},e.step=function(){var t={detail:{stepSize:e["Step Size"]}};window.dispatchEvent(new CustomEvent("step-animation",t))},e.weight=function(){var t=e.idle+e.walk+e.run;e.idle/=t,e.walk/=t,e.run/=t;var i=new CustomEvent("weight-animation",o());window.dispatchEvent(i)},e.crossfade=function(t,i){var n=o();n.detail.from=t,n.detail.to=i,n.detail.time=e["Crossfade Time"],window.dispatchEvent(new CustomEvent("crossfade",n))},e.warp=function(t,i){var n=o();n.detail.from="walk",n.detail.to="run",n.detail.time=e["Crossfade Time"],window.dispatchEvent(new CustomEvent("warp",n))},e["idle to walk"]=function(){e.crossfade("idle","walk")},e["walk to run"]=function(){e.crossfade("walk","run")},e["warp walk to run"]=function(){e.warp("walk","run")},e.showSkeletonChanged=function(){var t={detail:{shouldShow:e["Show Skeleton"]}};window.dispatchEvent(new CustomEvent("toggle-show-skeleton",t))},e.showModelChanged=function(){var t={detail:{shouldShow:e["Show Model"]}};window.dispatchEvent(new CustomEvent("toggle-show-model",t))},i.call(this)}function plane(t,e){return function(i,o){var n=(i-.5)*t,r=(o+.5)*e,s=0;return new THREE.Vector3(n,r,s)}}function Particle(t,e,i,o){this.position=clothFunction(t,e),this.previous=clothFunction(t,e),this.original=clothFunction(t,e),this.a=new THREE.Vector3(0,0,0),this.mass=o,this.invMass=1/o,this.tmp=new THREE.Vector3,this.tmp2=new THREE.Vector3}function satisifyConstrains(t,e,i){diff.subVectors(e.position,t.position);var o=diff.length();if(0!==o){var n=diff.multiplyScalar(1-i/o),r=n.multiplyScalar(.5);t.position.add(r),e.position.sub(r)}}function Cloth(t,e){function i(e,i){return e+i*(t+1)}t=t||10,e=e||10,this.w=t,this.h=e;var o,n,r=[],s=[];for(n=0;n<=e;n++)for(o=0;o<=t;o++)r.push(new Particle(o/t,n/e,0,MASS));for(n=0;n<e;n++)for(o=0;o<t;o++)s.push([r[i(o,n)],r[i(o,n+1)],restDistance]),s.push([r[i(o,n)],r[i(o+1,n)],restDistance]);for(o=t,n=0;n<e;n++)s.push([r[i(o,n)],r[i(o,n+1)],restDistance]);for(n=e,o=0;o<t;o++)s.push([r[i(o,n)],r[i(o+1,n)],restDistance]);this.particles=r,this.constrains=s,this.index=i}function simulate(t){if(!lastTime)return void(lastTime=t);var e,i,o,n,r,s;if(wind){var a,l,h=clothGeometry.faces;for(o=cloth.particles,e=0,i=h.length;e<i;e++)a=h[e],l=a.normal,tmpForce.copy(l).normalize().multiplyScalar(l.dot(windForce)),o[a.a].addForce(tmpForce),o[a.b].addForce(tmpForce),o[a.c].addForce(tmpForce)}for(o=cloth.particles,e=0,i=o.length;e<i;e++)n=o[e],n.addForce(gravity),n.integrate(TIMESTEP_SQ);for(r=cloth.constrains,i=r.length,e=0;e<i;e++)s=r[e],satisifyConstrains(s[0],s[1],s[2]);if(ballPosition.z=90*-Math.sin(Date.now()/600),ballPosition.x=70*Math.cos(Date.now()/400),sphere.visible)for(o=cloth.particles,e=0,i=o.length;e<i;e++)n=o[e],pos=n.position,diff.subVectors(pos,ballPosition),diff.length()<ballSize&&(diff.normalize().multiplyScalar(ballSize),pos.copy(ballPosition).add(diff));for(o=cloth.particles,e=0,i=o.length;e<i;e++)n=o[e],pos=n.position,pos.y<-250&&(pos.y=-250);for(e=0,i=pins.length;e<i;e++){var c=pins[e],u=o[c];u.position.copy(u.original),u.previous.copy(u.original)}}function GPUComputationRenderer(t,e,i){function o(i){i.defines.resolution="vec2( "+t.toFixed(1)+", "+e.toFixed(1)+" )"}function n(t,e){e=e||{};var i=new THREE.ShaderMaterial({uniforms:e,vertexShader:r(),fragmentShader:t});return o(i),i}function r(){return"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n"}function s(){return"uniform sampler2D texture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( texture, uv );\n\n}\n"}this.variables=[],this.currentTextureIndex=0;var a=new THREE.Scene,l=new THREE.Camera;l.position.z=1;var h={texture:{value:null}},c=n(s(),h),u=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),c);a.add(u),this.addVariable=function(t,e,i){var o=this.createShaderMaterial(e),n={name:t,initialValueTexture:i,material:o,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};return this.variables.push(n),n},this.setVariableDependencies=function(t,e){t.dependencies=e},this.init=function(){if(!i.extensions.get("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===i.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var o=0;o<this.variables.length;o++){var n=this.variables[o];n.renderTargets[0]=this.createRenderTarget(t,e,n.wrapS,n.wrapT,n.minFilter,n.magFilter),n.renderTargets[1]=this.createRenderTarget(t,e,n.wrapS,n.wrapT,n.minFilter,n.magFilter),this.renderTexture(n.initialValueTexture,n.renderTargets[0]),this.renderTexture(n.initialValueTexture,n.renderTargets[1]);var r=n.material,s=r.uniforms;if(null!==n.dependencies)for(var a=0;a<n.dependencies.length;a++){var l=n.dependencies[a];if(l.name!==n.name){for(var h=!1,c=0;c<this.variables.length;c++)if(l.name===this.variables[c].name){h=!0;break}if(!h)return"Variable dependency not found. Variable="+n.name+", dependency="+l.name}s[l.name]={value:null},r.fragmentShader="\nuniform sampler2D "+l.name+";\n"+r.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var t=this.currentTextureIndex,e=0===this.currentTextureIndex?1:0,i=0,o=this.variables.length;i<o;i++){var n=this.variables[i];if(null!==n.dependencies)for(var r=n.material.uniforms,s=0,a=n.dependencies.length;s<a;s++){var l=n.dependencies[s];r[l.name].value=l.renderTargets[t].texture}this.doRenderTarget(n.material,n.renderTargets[e])}this.currentTextureIndex=e},this.getCurrentRenderTarget=function(t){return t.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(t){return t.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=o,this.createShaderMaterial=n,this.createRenderTarget=function(i,o,n,r,s,a){i=i||t,o=o||e,n=n||THREE.ClampToEdgeWrapping,r=r||THREE.ClampToEdgeWrapping,s=s||THREE.NearestFilter,a=a||THREE.NearestFilter;var l=new THREE.WebGLRenderTarget(i,o,{wrapS:n,wrapT:r,minFilter:s,magFilter:a,format:THREE.RGBAFormat,type:THREE.FloatType,stencilBuffer:!1});return l},this.createTexture=function(i,o){i=i||t,o=o||e;var n=new Float32Array(i*o*4),r=new THREE.DataTexture(n,t,e,THREE.RGBAFormat,THREE.FloatType);return r.needsUpdate=!0,r},this.renderTexture=function(t,e){h.texture.value=t,this.doRenderTarget(c,e),h.texture.value=null},this.doRenderTarget=function(t,e){u.material=t,i.render(a,l,e),u.material=c}}if(+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.affix"),r="object"==typeof e&&e;n||o.data("bs.affix",n=new i(this,r)),"string"==typeof e&&n[e]()})}var i=function(e,o){this.options=t.extend({},i.DEFAULTS,o),this.$target=t(this.options.target).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};i.VERSION="3.3.7",i.RESET="affix affix-top affix-bottom",i.DEFAULTS={offset:0,target:window},i.prototype.getState=function(t,e,i,o){var n=this.$target.scrollTop(),r=this.$element.offset(),s=this.$target.height();if(null!=i&&"top"==this.affixed)return n<i&&"top";if("bottom"==this.affixed)return null!=i?!(n+this.unpin<=r.top)&&"bottom":!(n+s<=t-o)&&"bottom";var a=null==this.affixed,l=a?n:r.top,h=a?s:e;return null!=i&&n<=i?"top":null!=o&&l+h>=t-o&&"bottom"},i.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(i.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},i.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},i.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),o=this.options.offset,n=o.top,r=o.bottom,s=Math.max(t(document).height(),t(document.body).height());"object"!=typeof o&&(r=n=o),"function"==typeof n&&(n=o.top(this.$element)),"function"==typeof r&&(r=o.bottom(this.$element));var a=this.getState(s,e,n,r);if(this.affixed!=a){null!=this.unpin&&this.$element.css("top","");var l="affix"+(a?"-"+a:""),h=t.Event(l+".bs.affix");if(this.$element.trigger(h),h.isDefaultPrevented())return;this.affixed=a,this.unpin="bottom"==a?this.getPinnedOffset():null,this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==a&&this.$element.offset({top:s-e-r})}};var o=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=i,t.fn.affix.noConflict=function(){return t.fn.affix=o,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var i=t(this),o=i.data();o.offset=o.offset||{},null!=o.offsetBottom&&(o.offset.bottom=o.offsetBottom),null!=o.offsetTop&&(o.offset.top=o.offsetTop),e.call(i,o)})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var i=t(this),n=i.data("bs.alert");n||i.data("bs.alert",n=new o(this)),"string"==typeof e&&n[e].call(i)})}var i='[data-dismiss="alert"]',o=function(e){t(e).on("click",i,this.close)};o.VERSION="3.3.7",o.TRANSITION_DURATION=150,o.prototype.close=function(e){function i(){s.detach().trigger("closed.bs.alert").remove()}var n=t(this),r=n.attr("data-target");r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));var s=t("#"===r?[]:r);e&&e.preventDefault(),s.length||(s=n.closest(".alert")),s.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(s.removeClass("in"),t.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",i).emulateTransitionEnd(o.TRANSITION_DURATION):i())};var n=t.fn.alert;t.fn.alert=e,t.fn.alert.Constructor=o,t.fn.alert.noConflict=function(){return t.fn.alert=n,this},t(document).on("click.bs.alert.data-api",i,o.prototype.close)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.button"),r="object"==typeof e&&e;n||o.data("bs.button",n=new i(this,r)),"toggle"==e?n.toggle():e&&n.setState(e)})}var i=function(e,o){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,o),this.isLoading=!1};i.VERSION="3.3.7",i.DEFAULTS={loadingText:"loading..."},i.prototype.setState=function(e){var i="disabled",o=this.$element,n=o.is("input")?"val":"html",r=o.data();e+="Text",null==r.resetText&&o.data("resetText",o[n]()),setTimeout(t.proxy(function(){o[n](null==r[e]?this.options[e]:r[e]),"loadingText"==e?(this.isLoading=!0,o.addClass(i).attr(i,i).prop(i,!0)):this.isLoading&&(this.isLoading=!1,o.removeClass(i).removeAttr(i).prop(i,!1))},this),0)},i.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var o=t.fn.button;t.fn.button=e,t.fn.button.Constructor=i,t.fn.button.noConflict=function(){return t.fn.button=o,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(i){var o=t(i.target).closest(".btn");e.call(o,"toggle"),t(i.target).is('input[type="radio"], input[type="checkbox"]')||(i.preventDefault(),o.is("input,button")?o.trigger("focus"):o.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.carousel"),r=t.extend({},i.DEFAULTS,o.data(),"object"==typeof e&&e),s="string"==typeof e?e:r.slide;n||o.data("bs.carousel",n=new i(this,r)),"number"==typeof e?n.to(e):s?n[s]():r.interval&&n.pause().cycle()})}var i=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=600,i.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},i.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},i.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},i.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},i.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e),o="prev"==t&&0===i||"next"==t&&i==this.$items.length-1;if(o&&!this.options.wrap)return e;var n="prev"==t?-1:1,r=(i+n)%this.$items.length;return this.$items.eq(r)},i.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},i.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},i.prototype.next=function(){if(!this.sliding)return this.slide("next")},i.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},i.prototype.slide=function(e,o){var n=this.$element.find(".item.active"),r=o||this.getItemForDirection(e,n),s=this.interval,a="next"==e?"left":"right",l=this;if(r.hasClass("active"))return this.sliding=!1;var h=r[0],c=t.Event("slide.bs.carousel",{relatedTarget:h,direction:a});if(this.$element.trigger(c),!c.isDefaultPrevented()){if(this.sliding=!0,s&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var u=t(this.$indicators.children()[this.getItemIndex(r)]);u&&u.addClass("active")}var d=t.Event("slid.bs.carousel",{relatedTarget:h,direction:a});return t.support.transition&&this.$element.hasClass("slide")?(r.addClass(e),r[0].offsetWidth,n.addClass(a),r.addClass(a),n.one("bsTransitionEnd",function(){r.removeClass([e,a].join(" ")).addClass("active"),n.removeClass(["active",a].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(d)},0)}).emulateTransitionEnd(i.TRANSITION_DURATION)):(n.removeClass("active"),r.addClass("active"),this.sliding=!1,this.$element.trigger(d)),s&&this.cycle(),this}};var o=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=i,t.fn.carousel.noConflict=function(){return t.fn.carousel=o,this};var n=function(i){var o,n=t(this),r=t(n.attr("data-target")||(o=n.attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,""));if(r.hasClass("carousel")){var s=t.extend({},r.data(),n.data()),a=n.attr("data-slide-to");a&&(s.interval=!1),e.call(r,s),a&&r.data("bs.carousel").to(a),i.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",n).on("click.bs.carousel.data-api","[data-slide-to]",n),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var i=t(this);e.call(i,i.data())})})}(jQuery),+function(t){"use strict";function e(e){var i,o=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(o)}function i(e){return this.each(function(){var i=t(this),n=i.data("bs.collapse"),r=t.extend({},o.DEFAULTS,i.data(),"object"==typeof e&&e);!n&&r.toggle&&/show|hide/.test(e)&&(r.toggle=!1),n||i.data("bs.collapse",n=new o(this,r)),"string"==typeof e&&n[e]()})}var o=function(e,i){this.$element=t(e),this.options=t.extend({},o.DEFAULTS,i),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};o.VERSION="3.3.7",o.TRANSITION_DURATION=350,o.DEFAULTS={toggle:!0},o.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},o.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,n=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(n&&n.length&&(e=n.data("bs.collapse"),e&&e.transitioning))){var r=t.Event("show.bs.collapse");if(this.$element.trigger(r),!r.isDefaultPrevented()){n&&n.length&&(i.call(n,"hide"),e||n.data("bs.collapse",null));var s=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[s](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[s](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return a.call(this);var l=t.camelCase(["scroll",s].join("-"));this.$element.one("bsTransitionEnd",t.proxy(a,this)).emulateTransitionEnd(o.TRANSITION_DURATION)[s](this.$element[0][l])}}}},o.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return t.support.transition?void this.$element[i](0).one("bsTransitionEnd",t.proxy(n,this)).emulateTransitionEnd(o.TRANSITION_DURATION):n.call(this)}}},o.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},o.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(i,o){var n=t(o);this.addAriaAndCollapsedClass(e(n),n)},this)).end()},o.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var n=t.fn.collapse;t.fn.collapse=i,t.fn.collapse.Constructor=o,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(o){var n=t(this);n.attr("data-target")||o.preventDefault();var r=e(n),s=r.data("bs.collapse"),a=s?"toggle":n.data();i.call(r,a)})}(jQuery),+function(t){"use strict";function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var o=i&&t(i);return o&&o.length?o:e.parent()}function i(i){i&&3===i.which||(t(n).remove(),t(r).each(function(){var o=t(this),n=e(o),r={relatedTarget:this};n.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(n[0],i.target)||(n.trigger(i=t.Event("hide.bs.dropdown",r)),i.isDefaultPrevented()||(o.attr("aria-expanded","false"),n.removeClass("open").trigger(t.Event("hidden.bs.dropdown",r)))))}))}function o(e){return this.each(function(){var i=t(this),o=i.data("bs.dropdown");o||i.data("bs.dropdown",o=new s(this)),"string"==typeof e&&o[e].call(i)})}var n=".dropdown-backdrop",r='[data-toggle="dropdown"]',s=function(e){t(e).on("click.bs.dropdown",this.toggle)};s.VERSION="3.3.7",s.prototype.toggle=function(o){var n=t(this);if(!n.is(".disabled, :disabled")){var r=e(n),s=r.hasClass("open");if(i(),!s){"ontouchstart"in document.documentElement&&!r.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var a={relatedTarget:this};if(r.trigger(o=t.Event("show.bs.dropdown",a)),o.isDefaultPrevented())return;n.trigger("focus").attr("aria-expanded","true"),r.toggleClass("open").trigger(t.Event("shown.bs.dropdown",a))}return!1}},s.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var o=t(this);if(i.preventDefault(),i.stopPropagation(),!o.is(".disabled, :disabled")){var n=e(o),s=n.hasClass("open");if(!s&&27!=i.which||s&&27==i.which)return 27==i.which&&n.find(r).trigger("focus"),o.trigger("click");var a=" li:not(.disabled):visible a",l=n.find(".dropdown-menu"+a);if(l.length){var h=l.index(i.target);38==i.which&&h>0&&h--,40==i.which&&h<l.length-1&&h++,~h||(h=0),l.eq(h).trigger("focus")}}}};var a=t.fn.dropdown;t.fn.dropdown=o,t.fn.dropdown.Constructor=s,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=a,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",r,s.prototype.toggle).on("keydown.bs.dropdown.data-api",r,s.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",s.prototype.keydown)}(jQuery),+function(t){"use strict";function e(e,o){return this.each(function(){var n=t(this),r=n.data("bs.modal"),s=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e);r||n.data("bs.modal",r=new i(this,s)),"string"==typeof e?r[e](o):s.show&&r.show(o)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var o=this,n=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){o.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(o.$element)&&(o.ignoreBackdropClick=!0)})}),this.backdrop(function(){var n=t.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(o.$body),o.$element.show().scrollTop(0),o.adjustDialog(),n&&o.$element[0].offsetWidth,o.$element.addClass("in"),o.enforceFocus();var r=t.Event("shown.bs.modal",{relatedTarget:e});n?o.$dialog.one("bsTransitionEnd",function(){o.$element.trigger("focus").trigger(r)}).emulateTransitionEnd(i.TRANSITION_DURATION):o.$element.trigger("focus").trigger(r)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var o=this,n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var r=t.support.transition&&n;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+n).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),r&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;r?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){o.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):s()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var o=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=o,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var o=t(this),n=o.attr("href"),r=t(o.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),s=r.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(n)&&n},r.data(),o.data());o.is("a")&&i.preventDefault(),r.one("show.bs.modal",function(t){t.isDefaultPrevented()||r.one("hidden.bs.modal",function(){o.is(":visible")&&o.trigger("focus")})}),e.call(r,s,this)})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.popover"),r="object"==typeof e&&e;!n&&/destroy|hide/.test(e)||(n||o.data("bs.popover",n=new i(this,r)),"string"==typeof e&&n[e]())})}var i=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");i.VERSION="3.3.7",i.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),i.prototype.constructor=i,i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},i.prototype.hasContent=function(){return this.getTitle()||this.getContent()},i.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var o=t.fn.popover;t.fn.popover=e,t.fn.popover.Constructor=i,t.fn.popover.noConflict=function(){return t.fn.popover=o,this}}(jQuery),+function(t){"use strict";function e(i,o){this.$body=t(document.body),this.$scrollElement=t(t(i).is(document.body)?window:i),this.options=t.extend({},e.DEFAULTS,o),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each(function(){var o=t(this),n=o.data("bs.scrollspy"),r="object"==typeof i&&i;n||o.data("bs.scrollspy",n=new e(this,r)),"string"==typeof i&&n[i]()})}e.VERSION="3.3.7",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",o=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",o=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),n=e.data("target")||e.attr("href"),r=/^#./.test(n)&&t(n);return r&&r.length&&r.is(":visible")&&[[r[i]().top+o,n]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),o=this.options.offset+i-this.$scrollElement.height(),n=this.offsets,r=this.targets,s=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),
e>=o)return s!=(t=r[r.length-1])&&this.activate(t);if(s&&e<n[0])return this.activeTarget=null,this.clear();for(t=n.length;t--;)s!=r[t]&&e>=n[t]&&(void 0===n[t+1]||e<n[t+1])&&this.activate(r[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',o=t(i).parents("li").addClass("active");o.parent(".dropdown-menu").length&&(o=o.closest("li.dropdown").addClass("active")),o.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var o=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=o,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);i.call(e,e.data())})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.tab");n||o.data("bs.tab",n=new i(this)),"string"==typeof e&&n[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),o=e.data("target");if(o||(o=e.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var n=i.find(".active:last a"),r=t.Event("hide.bs.tab",{relatedTarget:e[0]}),s=t.Event("show.bs.tab",{relatedTarget:n[0]});if(n.trigger(r),e.trigger(s),!s.isDefaultPrevented()&&!r.isDefaultPrevented()){var a=t(o);this.activate(e.closest("li"),i),this.activate(a,a.parent(),function(){n.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:n[0]})})}}},i.prototype.activate=function(e,o,n){function r(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),a?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),n&&n()}var s=o.find("> .active"),a=n&&t.support.transition&&(s.length&&s.hasClass("fade")||!!o.find("> .fade").length);s.length&&a?s.one("bsTransitionEnd",r).emulateTransitionEnd(i.TRANSITION_DURATION):r(),s.removeClass("in")};var o=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=o,this};var n=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',n).on("click.bs.tab.data-api",'[data-toggle="pill"]',n)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.tooltip"),r="object"==typeof e&&e;!n&&/destroy|hide/.test(e)||(n||o.data("bs.tooltip",n=new i(this,r)),"string"==typeof e&&n[e]())})}var i=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},i.prototype.init=function(e,i,o){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(o),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var n=this.options.trigger.split(" "),r=n.length;r--;){var s=n[r];if("click"==s)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",l="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},i.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,o){i[t]!=o&&(e[t]=o)}),e},i.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState?void(i.hoverState="in"):(clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show())},i.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},i.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),!i.isInStateTrue())return clearTimeout(i.timeout),i.hoverState="out",i.options.delay&&i.options.delay.hide?void(i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)):i.hide()},i.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var o=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!o)return;var n=this,r=this.tip(),s=this.getUID(this.type);this.setContent(),r.attr("id",s),this.$element.attr("aria-describedby",s),this.options.animation&&r.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,r[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,h=l.test(a);h&&(a=a.replace(l,"")||"top"),r.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?r.appendTo(this.options.container):r.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),u=r[0].offsetWidth,d=r[0].offsetHeight;if(h){var p=a,f=this.getPosition(this.$viewport);a="bottom"==a&&c.bottom+d>f.bottom?"top":"top"==a&&c.top-d<f.top?"bottom":"right"==a&&c.right+u>f.width?"left":"left"==a&&c.left-u<f.left?"right":a,r.removeClass(p).addClass(a)}var m=this.getCalculatedOffset(a,c,u,d);this.applyPlacement(m,a);var v=function(){var t=n.hoverState;n.$element.trigger("shown.bs."+n.type),n.hoverState=null,"out"==t&&n.leave(n)};t.support.transition&&this.$tip.hasClass("fade")?r.one("bsTransitionEnd",v).emulateTransitionEnd(i.TRANSITION_DURATION):v()}},i.prototype.applyPlacement=function(e,i){var o=this.tip(),n=o[0].offsetWidth,r=o[0].offsetHeight,s=parseInt(o.css("margin-top"),10),a=parseInt(o.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),e.top+=s,e.left+=a,t.offset.setOffset(o[0],t.extend({using:function(t){o.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),o.addClass("in");var l=o[0].offsetWidth,h=o[0].offsetHeight;"top"==i&&h!=r&&(e.top=e.top+r-h);var c=this.getViewportAdjustedDelta(i,e,l,h);c.left?e.left+=c.left:e.top+=c.top;var u=/top|bottom/.test(i),d=u?2*c.left-n+l:2*c.top-r+h,p=u?"offsetWidth":"offsetHeight";o.offset(e),this.replaceArrow(d,o[0][p],u)},i.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},i.prototype.hide=function(e){function o(){"in"!=n.hoverState&&r.detach(),n.$element&&n.$element.removeAttr("aria-describedby").trigger("hidden.bs."+n.type),e&&e()}var n=this,r=t(this.$tip),s=t.Event("hide.bs."+this.type);if(this.$element.trigger(s),!s.isDefaultPrevented())return r.removeClass("in"),t.support.transition&&r.hasClass("fade")?r.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),this.hoverState=null,this},i.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},i.prototype.hasContent=function(){return this.getTitle()},i.prototype.getPosition=function(e){e=e||this.$element;var i=e[0],o="BODY"==i.tagName,n=i.getBoundingClientRect();null==n.width&&(n=t.extend({},n,{width:n.right-n.left,height:n.bottom-n.top}));var r=window.SVGElement&&i instanceof window.SVGElement,s=o?{top:0,left:0}:r?null:e.offset(),a={scroll:o?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},l=o?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},n,a,l,s)},i.prototype.getCalculatedOffset=function(t,e,i,o){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-o,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-o/2,left:e.left-i}:{top:e.top+e.height/2-o/2,left:e.left+e.width}},i.prototype.getViewportAdjustedDelta=function(t,e,i,o){var n={top:0,left:0};if(!this.$viewport)return n;var r=this.options.viewport&&this.options.viewport.padding||0,s=this.getPosition(this.$viewport);if(/right|left/.test(t)){var a=e.top-r-s.scroll,l=e.top+r-s.scroll+o;a<s.top?n.top=s.top-a:l>s.top+s.height&&(n.top=s.top+s.height-l)}else{var h=e.left-r,c=e.left+r+i;h<s.left?n.left=s.left-h:c>s.right&&(n.left=s.left+s.width-c)}return n},i.prototype.getTitle=function(){var t,e=this.$element,i=this.options;return t=e.attr("data-original-title")||("function"==typeof i.title?i.title.call(e[0]):i.title)},i.prototype.getUID=function(t){do t+=~~(1e6*Math.random());while(document.getElementById(t));return t},i.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},i.prototype.enable=function(){this.enabled=!0},i.prototype.disable=function(){this.enabled=!1},i.prototype.toggleEnabled=function(){this.enabled=!this.enabled},i.prototype.toggle=function(e){var i=this;e&&(i=t(e.currentTarget).data("bs."+this.type),i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},i.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null})};var o=t.fn.tooltip;t.fn.tooltip=e,t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=o,this}}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,o=this;t(this).one("bsTransitionEnd",function(){i=!0});var n=function(){i||t(o).trigger(t.support.transition.end)};return setTimeout(n,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");if(+function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||e[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,o=this;t(this).one("bsTransitionEnd",function(){i=!0});var n=function(){i||t(o).trigger(t.support.transition.end)};return setTimeout(n,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var i=t(this),n=i.data("bs.alert");n||i.data("bs.alert",n=new o(this)),"string"==typeof e&&n[e].call(i)})}var i='[data-dismiss="alert"]',o=function(e){t(e).on("click",i,this.close)};o.VERSION="3.3.7",o.TRANSITION_DURATION=150,o.prototype.close=function(e){function i(){s.detach().trigger("closed.bs.alert").remove()}var n=t(this),r=n.attr("data-target");r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));var s=t("#"===r?[]:r);e&&e.preventDefault(),s.length||(s=n.closest(".alert")),s.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(s.removeClass("in"),t.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",i).emulateTransitionEnd(o.TRANSITION_DURATION):i())};var n=t.fn.alert;t.fn.alert=e,t.fn.alert.Constructor=o,t.fn.alert.noConflict=function(){return t.fn.alert=n,this},t(document).on("click.bs.alert.data-api",i,o.prototype.close)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.button"),r="object"==typeof e&&e;n||o.data("bs.button",n=new i(this,r)),"toggle"==e?n.toggle():e&&n.setState(e)})}var i=function(e,o){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,o),this.isLoading=!1};i.VERSION="3.3.7",i.DEFAULTS={loadingText:"loading..."},i.prototype.setState=function(e){var i="disabled",o=this.$element,n=o.is("input")?"val":"html",r=o.data();e+="Text",null==r.resetText&&o.data("resetText",o[n]()),setTimeout(t.proxy(function(){o[n](null==r[e]?this.options[e]:r[e]),"loadingText"==e?(this.isLoading=!0,o.addClass(i).attr(i,i).prop(i,!0)):this.isLoading&&(this.isLoading=!1,o.removeClass(i).removeAttr(i).prop(i,!1))},this),0)},i.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var o=t.fn.button;t.fn.button=e,t.fn.button.Constructor=i,t.fn.button.noConflict=function(){return t.fn.button=o,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(i){var o=t(i.target).closest(".btn");e.call(o,"toggle"),t(i.target).is('input[type="radio"], input[type="checkbox"]')||(i.preventDefault(),o.is("input,button")?o.trigger("focus"):o.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.carousel"),r=t.extend({},i.DEFAULTS,o.data(),"object"==typeof e&&e),s="string"==typeof e?e:r.slide;n||o.data("bs.carousel",n=new i(this,r)),"number"==typeof e?n.to(e):s?n[s]():r.interval&&n.pause().cycle()})}var i=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=600,i.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},i.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},i.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},i.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},i.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e),o="prev"==t&&0===i||"next"==t&&i==this.$items.length-1;if(o&&!this.options.wrap)return e;var n="prev"==t?-1:1,r=(i+n)%this.$items.length;return this.$items.eq(r)},i.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},i.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},i.prototype.next=function(){if(!this.sliding)return this.slide("next")},i.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},i.prototype.slide=function(e,o){var n=this.$element.find(".item.active"),r=o||this.getItemForDirection(e,n),s=this.interval,a="next"==e?"left":"right",l=this;if(r.hasClass("active"))return this.sliding=!1;var h=r[0],c=t.Event("slide.bs.carousel",{relatedTarget:h,direction:a});if(this.$element.trigger(c),!c.isDefaultPrevented()){if(this.sliding=!0,s&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var u=t(this.$indicators.children()[this.getItemIndex(r)]);u&&u.addClass("active")}var d=t.Event("slid.bs.carousel",{relatedTarget:h,direction:a});return t.support.transition&&this.$element.hasClass("slide")?(r.addClass(e),r[0].offsetWidth,n.addClass(a),r.addClass(a),n.one("bsTransitionEnd",function(){r.removeClass([e,a].join(" ")).addClass("active"),n.removeClass(["active",a].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(d)},0)}).emulateTransitionEnd(i.TRANSITION_DURATION)):(n.removeClass("active"),r.addClass("active"),this.sliding=!1,this.$element.trigger(d)),s&&this.cycle(),this}};var o=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=i,t.fn.carousel.noConflict=function(){return t.fn.carousel=o,this};var n=function(i){var o,n=t(this),r=t(n.attr("data-target")||(o=n.attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,""));if(r.hasClass("carousel")){var s=t.extend({},r.data(),n.data()),a=n.attr("data-slide-to");a&&(s.interval=!1),e.call(r,s),a&&r.data("bs.carousel").to(a),i.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",n).on("click.bs.carousel.data-api","[data-slide-to]",n),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var i=t(this);e.call(i,i.data())})})}(jQuery),+function(t){"use strict";function e(e){var i,o=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(o)}function i(e){return this.each(function(){var i=t(this),n=i.data("bs.collapse"),r=t.extend({},o.DEFAULTS,i.data(),"object"==typeof e&&e);!n&&r.toggle&&/show|hide/.test(e)&&(r.toggle=!1),n||i.data("bs.collapse",n=new o(this,r)),"string"==typeof e&&n[e]()})}var o=function(e,i){this.$element=t(e),this.options=t.extend({},o.DEFAULTS,i),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};o.VERSION="3.3.7",o.TRANSITION_DURATION=350,o.DEFAULTS={toggle:!0},o.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},o.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,n=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(n&&n.length&&(e=n.data("bs.collapse"),e&&e.transitioning))){var r=t.Event("show.bs.collapse");if(this.$element.trigger(r),!r.isDefaultPrevented()){n&&n.length&&(i.call(n,"hide"),e||n.data("bs.collapse",null));var s=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[s](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[s](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return a.call(this);var l=t.camelCase(["scroll",s].join("-"));this.$element.one("bsTransitionEnd",t.proxy(a,this)).emulateTransitionEnd(o.TRANSITION_DURATION)[s](this.$element[0][l])}}}},o.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return t.support.transition?void this.$element[i](0).one("bsTransitionEnd",t.proxy(n,this)).emulateTransitionEnd(o.TRANSITION_DURATION):n.call(this)}}},o.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},o.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(i,o){var n=t(o);this.addAriaAndCollapsedClass(e(n),n)},this)).end()},o.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var n=t.fn.collapse;t.fn.collapse=i,t.fn.collapse.Constructor=o,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(o){var n=t(this);n.attr("data-target")||o.preventDefault();var r=e(n),s=r.data("bs.collapse"),a=s?"toggle":n.data();i.call(r,a)})}(jQuery),+function(t){"use strict";function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var o=i&&t(i);return o&&o.length?o:e.parent()}function i(i){i&&3===i.which||(t(n).remove(),t(r).each(function(){var o=t(this),n=e(o),r={relatedTarget:this};n.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(n[0],i.target)||(n.trigger(i=t.Event("hide.bs.dropdown",r)),i.isDefaultPrevented()||(o.attr("aria-expanded","false"),n.removeClass("open").trigger(t.Event("hidden.bs.dropdown",r)))))}))}function o(e){return this.each(function(){var i=t(this),o=i.data("bs.dropdown");o||i.data("bs.dropdown",o=new s(this)),"string"==typeof e&&o[e].call(i)})}var n=".dropdown-backdrop",r='[data-toggle="dropdown"]',s=function(e){t(e).on("click.bs.dropdown",this.toggle)};s.VERSION="3.3.7",s.prototype.toggle=function(o){var n=t(this);if(!n.is(".disabled, :disabled")){var r=e(n),s=r.hasClass("open");if(i(),!s){"ontouchstart"in document.documentElement&&!r.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var a={relatedTarget:this};if(r.trigger(o=t.Event("show.bs.dropdown",a)),o.isDefaultPrevented())return;n.trigger("focus").attr("aria-expanded","true"),r.toggleClass("open").trigger(t.Event("shown.bs.dropdown",a))}return!1}},s.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var o=t(this);if(i.preventDefault(),i.stopPropagation(),!o.is(".disabled, :disabled")){var n=e(o),s=n.hasClass("open");if(!s&&27!=i.which||s&&27==i.which)return 27==i.which&&n.find(r).trigger("focus"),o.trigger("click");var a=" li:not(.disabled):visible a",l=n.find(".dropdown-menu"+a);if(l.length){var h=l.index(i.target);38==i.which&&h>0&&h--,40==i.which&&h<l.length-1&&h++,~h||(h=0),l.eq(h).trigger("focus")}}}};var a=t.fn.dropdown;t.fn.dropdown=o,t.fn.dropdown.Constructor=s,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=a,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",r,s.prototype.toggle).on("keydown.bs.dropdown.data-api",r,s.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",s.prototype.keydown)}(jQuery),+function(t){"use strict";function e(e,o){return this.each(function(){var n=t(this),r=n.data("bs.modal"),s=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e);r||n.data("bs.modal",r=new i(this,s)),"string"==typeof e?r[e](o):s.show&&r.show(o)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var o=this,n=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){o.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(o.$element)&&(o.ignoreBackdropClick=!0)})}),this.backdrop(function(){var n=t.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(o.$body),o.$element.show().scrollTop(0),o.adjustDialog(),n&&o.$element[0].offsetWidth,o.$element.addClass("in"),o.enforceFocus();var r=t.Event("shown.bs.modal",{relatedTarget:e});n?o.$dialog.one("bsTransitionEnd",function(){o.$element.trigger("focus").trigger(r)}).emulateTransitionEnd(i.TRANSITION_DURATION):o.$element.trigger("focus").trigger(r)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var o=this,n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var r=t.support.transition&&n;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+n).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),r&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;r?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){o.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):s()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var o=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=o,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var o=t(this),n=o.attr("href"),r=t(o.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),s=r.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(n)&&n},r.data(),o.data());o.is("a")&&i.preventDefault(),r.one("show.bs.modal",function(t){
t.isDefaultPrevented()||r.one("hidden.bs.modal",function(){o.is(":visible")&&o.trigger("focus")})}),e.call(r,s,this)})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.tooltip"),r="object"==typeof e&&e;!n&&/destroy|hide/.test(e)||(n||o.data("bs.tooltip",n=new i(this,r)),"string"==typeof e&&n[e]())})}var i=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},i.prototype.init=function(e,i,o){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(o),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var n=this.options.trigger.split(" "),r=n.length;r--;){var s=n[r];if("click"==s)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",l="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},i.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,o){i[t]!=o&&(e[t]=o)}),e},i.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState?void(i.hoverState="in"):(clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show())},i.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},i.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),!i.isInStateTrue())return clearTimeout(i.timeout),i.hoverState="out",i.options.delay&&i.options.delay.hide?void(i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)):i.hide()},i.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var o=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!o)return;var n=this,r=this.tip(),s=this.getUID(this.type);this.setContent(),r.attr("id",s),this.$element.attr("aria-describedby",s),this.options.animation&&r.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,r[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,h=l.test(a);h&&(a=a.replace(l,"")||"top"),r.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?r.appendTo(this.options.container):r.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),u=r[0].offsetWidth,d=r[0].offsetHeight;if(h){var p=a,f=this.getPosition(this.$viewport);a="bottom"==a&&c.bottom+d>f.bottom?"top":"top"==a&&c.top-d<f.top?"bottom":"right"==a&&c.right+u>f.width?"left":"left"==a&&c.left-u<f.left?"right":a,r.removeClass(p).addClass(a)}var m=this.getCalculatedOffset(a,c,u,d);this.applyPlacement(m,a);var v=function(){var t=n.hoverState;n.$element.trigger("shown.bs."+n.type),n.hoverState=null,"out"==t&&n.leave(n)};t.support.transition&&this.$tip.hasClass("fade")?r.one("bsTransitionEnd",v).emulateTransitionEnd(i.TRANSITION_DURATION):v()}},i.prototype.applyPlacement=function(e,i){var o=this.tip(),n=o[0].offsetWidth,r=o[0].offsetHeight,s=parseInt(o.css("margin-top"),10),a=parseInt(o.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),e.top+=s,e.left+=a,t.offset.setOffset(o[0],t.extend({using:function(t){o.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),o.addClass("in");var l=o[0].offsetWidth,h=o[0].offsetHeight;"top"==i&&h!=r&&(e.top=e.top+r-h);var c=this.getViewportAdjustedDelta(i,e,l,h);c.left?e.left+=c.left:e.top+=c.top;var u=/top|bottom/.test(i),d=u?2*c.left-n+l:2*c.top-r+h,p=u?"offsetWidth":"offsetHeight";o.offset(e),this.replaceArrow(d,o[0][p],u)},i.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},i.prototype.hide=function(e){function o(){"in"!=n.hoverState&&r.detach(),n.$element&&n.$element.removeAttr("aria-describedby").trigger("hidden.bs."+n.type),e&&e()}var n=this,r=t(this.$tip),s=t.Event("hide.bs."+this.type);if(this.$element.trigger(s),!s.isDefaultPrevented())return r.removeClass("in"),t.support.transition&&r.hasClass("fade")?r.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),this.hoverState=null,this},i.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},i.prototype.hasContent=function(){return this.getTitle()},i.prototype.getPosition=function(e){e=e||this.$element;var i=e[0],o="BODY"==i.tagName,n=i.getBoundingClientRect();null==n.width&&(n=t.extend({},n,{width:n.right-n.left,height:n.bottom-n.top}));var r=window.SVGElement&&i instanceof window.SVGElement,s=o?{top:0,left:0}:r?null:e.offset(),a={scroll:o?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},l=o?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},n,a,l,s)},i.prototype.getCalculatedOffset=function(t,e,i,o){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-o,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-o/2,left:e.left-i}:{top:e.top+e.height/2-o/2,left:e.left+e.width}},i.prototype.getViewportAdjustedDelta=function(t,e,i,o){var n={top:0,left:0};if(!this.$viewport)return n;var r=this.options.viewport&&this.options.viewport.padding||0,s=this.getPosition(this.$viewport);if(/right|left/.test(t)){var a=e.top-r-s.scroll,l=e.top+r-s.scroll+o;a<s.top?n.top=s.top-a:l>s.top+s.height&&(n.top=s.top+s.height-l)}else{var h=e.left-r,c=e.left+r+i;h<s.left?n.left=s.left-h:c>s.right&&(n.left=s.left+s.width-c)}return n},i.prototype.getTitle=function(){var t,e=this.$element,i=this.options;return t=e.attr("data-original-title")||("function"==typeof i.title?i.title.call(e[0]):i.title)},i.prototype.getUID=function(t){do t+=~~(1e6*Math.random());while(document.getElementById(t));return t},i.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},i.prototype.enable=function(){this.enabled=!0},i.prototype.disable=function(){this.enabled=!1},i.prototype.toggleEnabled=function(){this.enabled=!this.enabled},i.prototype.toggle=function(e){var i=this;e&&(i=t(e.currentTarget).data("bs."+this.type),i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},i.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null})};var o=t.fn.tooltip;t.fn.tooltip=e,t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=o,this}}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.popover"),r="object"==typeof e&&e;!n&&/destroy|hide/.test(e)||(n||o.data("bs.popover",n=new i(this,r)),"string"==typeof e&&n[e]())})}var i=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");i.VERSION="3.3.7",i.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),i.prototype.constructor=i,i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},i.prototype.hasContent=function(){return this.getTitle()||this.getContent()},i.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var o=t.fn.popover;t.fn.popover=e,t.fn.popover.Constructor=i,t.fn.popover.noConflict=function(){return t.fn.popover=o,this}}(jQuery),+function(t){"use strict";function e(i,o){this.$body=t(document.body),this.$scrollElement=t(t(i).is(document.body)?window:i),this.options=t.extend({},e.DEFAULTS,o),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each(function(){var o=t(this),n=o.data("bs.scrollspy"),r="object"==typeof i&&i;n||o.data("bs.scrollspy",n=new e(this,r)),"string"==typeof i&&n[i]()})}e.VERSION="3.3.7",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",o=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",o=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),n=e.data("target")||e.attr("href"),r=/^#./.test(n)&&t(n);return r&&r.length&&r.is(":visible")&&[[r[i]().top+o,n]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),o=this.options.offset+i-this.$scrollElement.height(),n=this.offsets,r=this.targets,s=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),e>=o)return s!=(t=r[r.length-1])&&this.activate(t);if(s&&e<n[0])return this.activeTarget=null,this.clear();for(t=n.length;t--;)s!=r[t]&&e>=n[t]&&(void 0===n[t+1]||e<n[t+1])&&this.activate(r[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',o=t(i).parents("li").addClass("active");o.parent(".dropdown-menu").length&&(o=o.closest("li.dropdown").addClass("active")),o.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var o=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=o,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);i.call(e,e.data())})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.tab");n||o.data("bs.tab",n=new i(this)),"string"==typeof e&&n[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),o=e.data("target");if(o||(o=e.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var n=i.find(".active:last a"),r=t.Event("hide.bs.tab",{relatedTarget:e[0]}),s=t.Event("show.bs.tab",{relatedTarget:n[0]});if(n.trigger(r),e.trigger(s),!s.isDefaultPrevented()&&!r.isDefaultPrevented()){var a=t(o);this.activate(e.closest("li"),i),this.activate(a,a.parent(),function(){n.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:n[0]})})}}},i.prototype.activate=function(e,o,n){function r(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),a?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),n&&n()}var s=o.find("> .active"),a=n&&t.support.transition&&(s.length&&s.hasClass("fade")||!!o.find("> .fade").length);s.length&&a?s.one("bsTransitionEnd",r).emulateTransitionEnd(i.TRANSITION_DURATION):r(),s.removeClass("in")};var o=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=o,this};var n=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',n).on("click.bs.tab.data-api",'[data-toggle="pill"]',n)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.affix"),r="object"==typeof e&&e;n||o.data("bs.affix",n=new i(this,r)),"string"==typeof e&&n[e]()})}var i=function(e,o){this.options=t.extend({},i.DEFAULTS,o),this.$target=t(this.options.target).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};i.VERSION="3.3.7",i.RESET="affix affix-top affix-bottom",i.DEFAULTS={offset:0,target:window},i.prototype.getState=function(t,e,i,o){var n=this.$target.scrollTop(),r=this.$element.offset(),s=this.$target.height();if(null!=i&&"top"==this.affixed)return n<i&&"top";if("bottom"==this.affixed)return null!=i?!(n+this.unpin<=r.top)&&"bottom":!(n+s<=t-o)&&"bottom";var a=null==this.affixed,l=a?n:r.top,h=a?s:e;return null!=i&&n<=i?"top":null!=o&&l+h>=t-o&&"bottom"},i.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(i.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},i.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},i.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),o=this.options.offset,n=o.top,r=o.bottom,s=Math.max(t(document).height(),t(document.body).height());"object"!=typeof o&&(r=n=o),"function"==typeof n&&(n=o.top(this.$element)),"function"==typeof r&&(r=o.bottom(this.$element));var a=this.getState(s,e,n,r);if(this.affixed!=a){null!=this.unpin&&this.$element.css("top","");var l="affix"+(a?"-"+a:""),h=t.Event(l+".bs.affix");if(this.$element.trigger(h),h.isDefaultPrevented())return;this.affixed=a,this.unpin="bottom"==a?this.getPinnedOffset():null,this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==a&&this.$element.offset({top:s-e-r})}};var o=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=i,t.fn.affix.noConflict=function(){return t.fn.affix=o,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var i=t(this),o=i.data();o.offset=o.offset||{},null!=o.offsetBottom&&(o.offset.bottom=o.offsetBottom),null!=o.offsetTop&&(o.offset.top=o.offsetTop),e.call(i,o)})})}(jQuery),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||e[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,o=this;t(this).one("bsTransitionEnd",function(){i=!0});var n=function(){i||t(o).trigger(t.support.transition.end)};return setTimeout(n,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var i=t(this),n=i.data("bs.alert");n||i.data("bs.alert",n=new o(this)),"string"==typeof e&&n[e].call(i)})}var i='[data-dismiss="alert"]',o=function(e){t(e).on("click",i,this.close)};o.VERSION="3.3.7",o.TRANSITION_DURATION=150,o.prototype.close=function(e){function i(){s.detach().trigger("closed.bs.alert").remove()}var n=t(this),r=n.attr("data-target");r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));var s=t("#"===r?[]:r);e&&e.preventDefault(),s.length||(s=n.closest(".alert")),s.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(s.removeClass("in"),t.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",i).emulateTransitionEnd(o.TRANSITION_DURATION):i())};var n=t.fn.alert;t.fn.alert=e,t.fn.alert.Constructor=o,t.fn.alert.noConflict=function(){return t.fn.alert=n,this},t(document).on("click.bs.alert.data-api",i,o.prototype.close)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.button"),r="object"==typeof e&&e;n||o.data("bs.button",n=new i(this,r)),"toggle"==e?n.toggle():e&&n.setState(e)})}var i=function(e,o){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,o),this.isLoading=!1};i.VERSION="3.3.7",i.DEFAULTS={loadingText:"loading..."},i.prototype.setState=function(e){var i="disabled",o=this.$element,n=o.is("input")?"val":"html",r=o.data();e+="Text",null==r.resetText&&o.data("resetText",o[n]()),setTimeout(t.proxy(function(){o[n](null==r[e]?this.options[e]:r[e]),"loadingText"==e?(this.isLoading=!0,o.addClass(i).attr(i,i).prop(i,!0)):this.isLoading&&(this.isLoading=!1,o.removeClass(i).removeAttr(i).prop(i,!1))},this),0)},i.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var o=t.fn.button;t.fn.button=e,t.fn.button.Constructor=i,t.fn.button.noConflict=function(){return t.fn.button=o,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(i){var o=t(i.target).closest(".btn");e.call(o,"toggle"),t(i.target).is('input[type="radio"], input[type="checkbox"]')||(i.preventDefault(),o.is("input,button")?o.trigger("focus"):o.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.carousel"),r=t.extend({},i.DEFAULTS,o.data(),"object"==typeof e&&e),s="string"==typeof e?e:r.slide;n||o.data("bs.carousel",n=new i(this,r)),"number"==typeof e?n.to(e):s?n[s]():r.interval&&n.pause().cycle()})}var i=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=600,i.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},i.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},i.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},i.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},i.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e),o="prev"==t&&0===i||"next"==t&&i==this.$items.length-1;if(o&&!this.options.wrap)return e;var n="prev"==t?-1:1,r=(i+n)%this.$items.length;return this.$items.eq(r)},i.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},i.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},i.prototype.next=function(){if(!this.sliding)return this.slide("next")},i.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},i.prototype.slide=function(e,o){var n=this.$element.find(".item.active"),r=o||this.getItemForDirection(e,n),s=this.interval,a="next"==e?"left":"right",l=this;if(r.hasClass("active"))return this.sliding=!1;var h=r[0],c=t.Event("slide.bs.carousel",{relatedTarget:h,direction:a});if(this.$element.trigger(c),!c.isDefaultPrevented()){if(this.sliding=!0,s&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var u=t(this.$indicators.children()[this.getItemIndex(r)]);u&&u.addClass("active")}var d=t.Event("slid.bs.carousel",{relatedTarget:h,direction:a});return t.support.transition&&this.$element.hasClass("slide")?(r.addClass(e),r[0].offsetWidth,n.addClass(a),r.addClass(a),n.one("bsTransitionEnd",function(){r.removeClass([e,a].join(" ")).addClass("active"),n.removeClass(["active",a].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(d)},0)}).emulateTransitionEnd(i.TRANSITION_DURATION)):(n.removeClass("active"),r.addClass("active"),this.sliding=!1,this.$element.trigger(d)),s&&this.cycle(),this}};var o=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=i,t.fn.carousel.noConflict=function(){return t.fn.carousel=o,this};var n=function(i){var o,n=t(this),r=t(n.attr("data-target")||(o=n.attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,""));if(r.hasClass("carousel")){var s=t.extend({},r.data(),n.data()),a=n.attr("data-slide-to");a&&(s.interval=!1),e.call(r,s),a&&r.data("bs.carousel").to(a),i.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",n).on("click.bs.carousel.data-api","[data-slide-to]",n),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var i=t(this);e.call(i,i.data())})})}(jQuery),+function(t){"use strict";function e(e){var i,o=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(o)}function i(e){return this.each(function(){var i=t(this),n=i.data("bs.collapse"),r=t.extend({},o.DEFAULTS,i.data(),"object"==typeof e&&e);!n&&r.toggle&&/show|hide/.test(e)&&(r.toggle=!1),n||i.data("bs.collapse",n=new o(this,r)),"string"==typeof e&&n[e]()})}var o=function(e,i){this.$element=t(e),this.options=t.extend({},o.DEFAULTS,i),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};o.VERSION="3.3.7",o.TRANSITION_DURATION=350,o.DEFAULTS={toggle:!0},o.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},o.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,n=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(n&&n.length&&(e=n.data("bs.collapse"),e&&e.transitioning))){var r=t.Event("show.bs.collapse");if(this.$element.trigger(r),!r.isDefaultPrevented()){n&&n.length&&(i.call(n,"hide"),e||n.data("bs.collapse",null));var s=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[s](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[s](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return a.call(this);var l=t.camelCase(["scroll",s].join("-"));this.$element.one("bsTransitionEnd",t.proxy(a,this)).emulateTransitionEnd(o.TRANSITION_DURATION)[s](this.$element[0][l])}}}},o.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return t.support.transition?void this.$element[i](0).one("bsTransitionEnd",t.proxy(n,this)).emulateTransitionEnd(o.TRANSITION_DURATION):n.call(this)}}},o.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},o.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(i,o){var n=t(o);this.addAriaAndCollapsedClass(e(n),n)},this)).end()},o.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var n=t.fn.collapse;t.fn.collapse=i,t.fn.collapse.Constructor=o,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(o){var n=t(this);n.attr("data-target")||o.preventDefault();var r=e(n),s=r.data("bs.collapse"),a=s?"toggle":n.data();i.call(r,a)})}(jQuery),+function(t){"use strict";function e(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var o=i&&t(i);return o&&o.length?o:e.parent()}function i(i){i&&3===i.which||(t(n).remove(),t(r).each(function(){var o=t(this),n=e(o),r={relatedTarget:this};n.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(n[0],i.target)||(n.trigger(i=t.Event("hide.bs.dropdown",r)),i.isDefaultPrevented()||(o.attr("aria-expanded","false"),n.removeClass("open").trigger(t.Event("hidden.bs.dropdown",r)))))}))}function o(e){return this.each(function(){var i=t(this),o=i.data("bs.dropdown");o||i.data("bs.dropdown",o=new s(this)),"string"==typeof e&&o[e].call(i)})}var n=".dropdown-backdrop",r='[data-toggle="dropdown"]',s=function(e){t(e).on("click.bs.dropdown",this.toggle)};s.VERSION="3.3.7",s.prototype.toggle=function(o){var n=t(this);if(!n.is(".disabled, :disabled")){var r=e(n),s=r.hasClass("open");if(i(),!s){"ontouchstart"in document.documentElement&&!r.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",i);var a={relatedTarget:this};if(r.trigger(o=t.Event("show.bs.dropdown",a)),o.isDefaultPrevented())return;n.trigger("focus").attr("aria-expanded","true"),r.toggleClass("open").trigger(t.Event("shown.bs.dropdown",a))}return!1}},s.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var o=t(this);if(i.preventDefault(),i.stopPropagation(),!o.is(".disabled, :disabled")){var n=e(o),s=n.hasClass("open");if(!s&&27!=i.which||s&&27==i.which)return 27==i.which&&n.find(r).trigger("focus"),o.trigger("click");var a=" li:not(.disabled):visible a",l=n.find(".dropdown-menu"+a);if(l.length){var h=l.index(i.target);38==i.which&&h>0&&h--,40==i.which&&h<l.length-1&&h++,~h||(h=0),l.eq(h).trigger("focus")}}}};var a=t.fn.dropdown;t.fn.dropdown=o,t.fn.dropdown.Constructor=s,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=a,this},t(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",r,s.prototype.toggle).on("keydown.bs.dropdown.data-api",r,s.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",s.prototype.keydown)}(jQuery),+function(t){"use strict";function e(e,o){return this.each(function(){var n=t(this),r=n.data("bs.modal"),s=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e);r||n.data("bs.modal",r=new i(this,s)),"string"==typeof e?r[e](o):s.show&&r.show(o)})}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};i.VERSION="3.3.7",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var o=this,n=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,
this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){o.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(o.$element)&&(o.ignoreBackdropClick=!0)})}),this.backdrop(function(){var n=t.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(o.$body),o.$element.show().scrollTop(0),o.adjustDialog(),n&&o.$element[0].offsetWidth,o.$element.addClass("in"),o.enforceFocus();var r=t.Event("shown.bs.modal",{relatedTarget:e});n?o.$dialog.one("bsTransitionEnd",function(){o.$element.trigger("focus").trigger(r)}).emulateTransitionEnd(i.TRANSITION_DURATION):o.$element.trigger("focus").trigger(r)}))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var o=this,n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var r=t.support.transition&&n;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+n).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),r&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;r?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){o.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):s()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var o=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=o,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(i){var o=t(this),n=o.attr("href"),r=t(o.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),s=r.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(n)&&n},r.data(),o.data());o.is("a")&&i.preventDefault(),r.one("show.bs.modal",function(t){t.isDefaultPrevented()||r.one("hidden.bs.modal",function(){o.is(":visible")&&o.trigger("focus")})}),e.call(r,s,this)})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.tooltip"),r="object"==typeof e&&e;!n&&/destroy|hide/.test(e)||(n||o.data("bs.tooltip",n=new i(this,r)),"string"==typeof e&&n[e]())})}var i=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},i.prototype.init=function(e,i,o){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(o),this.$viewport=this.options.viewport&&t(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var n=this.options.trigger.split(" "),r=n.length;r--;){var s=n[r];if("click"==s)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",l="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},i.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,o){i[t]!=o&&(e[t]=o)}),e},i.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);return i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState?void(i.hoverState="in"):(clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show())},i.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},i.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),!i.isInStateTrue())return clearTimeout(i.timeout),i.hoverState="out",i.options.delay&&i.options.delay.hide?void(i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)):i.hide()},i.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var o=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!o)return;var n=this,r=this.tip(),s=this.getUID(this.type);this.setContent(),r.attr("id",s),this.$element.attr("aria-describedby",s),this.options.animation&&r.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,r[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,h=l.test(a);h&&(a=a.replace(l,"")||"top"),r.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?r.appendTo(this.options.container):r.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),u=r[0].offsetWidth,d=r[0].offsetHeight;if(h){var p=a,f=this.getPosition(this.$viewport);a="bottom"==a&&c.bottom+d>f.bottom?"top":"top"==a&&c.top-d<f.top?"bottom":"right"==a&&c.right+u>f.width?"left":"left"==a&&c.left-u<f.left?"right":a,r.removeClass(p).addClass(a)}var m=this.getCalculatedOffset(a,c,u,d);this.applyPlacement(m,a);var v=function(){var t=n.hoverState;n.$element.trigger("shown.bs."+n.type),n.hoverState=null,"out"==t&&n.leave(n)};t.support.transition&&this.$tip.hasClass("fade")?r.one("bsTransitionEnd",v).emulateTransitionEnd(i.TRANSITION_DURATION):v()}},i.prototype.applyPlacement=function(e,i){var o=this.tip(),n=o[0].offsetWidth,r=o[0].offsetHeight,s=parseInt(o.css("margin-top"),10),a=parseInt(o.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),e.top+=s,e.left+=a,t.offset.setOffset(o[0],t.extend({using:function(t){o.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),o.addClass("in");var l=o[0].offsetWidth,h=o[0].offsetHeight;"top"==i&&h!=r&&(e.top=e.top+r-h);var c=this.getViewportAdjustedDelta(i,e,l,h);c.left?e.left+=c.left:e.top+=c.top;var u=/top|bottom/.test(i),d=u?2*c.left-n+l:2*c.top-r+h,p=u?"offsetWidth":"offsetHeight";o.offset(e),this.replaceArrow(d,o[0][p],u)},i.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},i.prototype.hide=function(e){function o(){"in"!=n.hoverState&&r.detach(),n.$element&&n.$element.removeAttr("aria-describedby").trigger("hidden.bs."+n.type),e&&e()}var n=this,r=t(this.$tip),s=t.Event("hide.bs."+this.type);if(this.$element.trigger(s),!s.isDefaultPrevented())return r.removeClass("in"),t.support.transition&&r.hasClass("fade")?r.one("bsTransitionEnd",o).emulateTransitionEnd(i.TRANSITION_DURATION):o(),this.hoverState=null,this},i.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},i.prototype.hasContent=function(){return this.getTitle()},i.prototype.getPosition=function(e){e=e||this.$element;var i=e[0],o="BODY"==i.tagName,n=i.getBoundingClientRect();null==n.width&&(n=t.extend({},n,{width:n.right-n.left,height:n.bottom-n.top}));var r=window.SVGElement&&i instanceof window.SVGElement,s=o?{top:0,left:0}:r?null:e.offset(),a={scroll:o?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},l=o?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},n,a,l,s)},i.prototype.getCalculatedOffset=function(t,e,i,o){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-o,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-o/2,left:e.left-i}:{top:e.top+e.height/2-o/2,left:e.left+e.width}},i.prototype.getViewportAdjustedDelta=function(t,e,i,o){var n={top:0,left:0};if(!this.$viewport)return n;var r=this.options.viewport&&this.options.viewport.padding||0,s=this.getPosition(this.$viewport);if(/right|left/.test(t)){var a=e.top-r-s.scroll,l=e.top+r-s.scroll+o;a<s.top?n.top=s.top-a:l>s.top+s.height&&(n.top=s.top+s.height-l)}else{var h=e.left-r,c=e.left+r+i;h<s.left?n.left=s.left-h:c>s.right&&(n.left=s.left+s.width-c)}return n},i.prototype.getTitle=function(){var t,e=this.$element,i=this.options;return t=e.attr("data-original-title")||("function"==typeof i.title?i.title.call(e[0]):i.title)},i.prototype.getUID=function(t){do t+=~~(1e6*Math.random());while(document.getElementById(t));return t},i.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},i.prototype.enable=function(){this.enabled=!0},i.prototype.disable=function(){this.enabled=!1},i.prototype.toggleEnabled=function(){this.enabled=!this.enabled},i.prototype.toggle=function(e){var i=this;e&&(i=t(e.currentTarget).data("bs."+this.type),i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},i.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null})};var o=t.fn.tooltip;t.fn.tooltip=e,t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=o,this}}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.popover"),r="object"==typeof e&&e;!n&&/destroy|hide/.test(e)||(n||o.data("bs.popover",n=new i(this,r)),"string"==typeof e&&n[e]())})}var i=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");i.VERSION="3.3.7",i.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),i.prototype.constructor=i,i.prototype.getDefaults=function(){return i.DEFAULTS},i.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},i.prototype.hasContent=function(){return this.getTitle()||this.getContent()},i.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},i.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var o=t.fn.popover;t.fn.popover=e,t.fn.popover.Constructor=i,t.fn.popover.noConflict=function(){return t.fn.popover=o,this}}(jQuery),+function(t){"use strict";function e(i,o){this.$body=t(document.body),this.$scrollElement=t(t(i).is(document.body)?window:i),this.options=t.extend({},e.DEFAULTS,o),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each(function(){var o=t(this),n=o.data("bs.scrollspy"),r="object"==typeof i&&i;n||o.data("bs.scrollspy",n=new e(this,r)),"string"==typeof i&&n[i]()})}e.VERSION="3.3.7",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",o=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",o=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),n=e.data("target")||e.attr("href"),r=/^#./.test(n)&&t(n);return r&&r.length&&r.is(":visible")&&[[r[i]().top+o,n]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),o=this.options.offset+i-this.$scrollElement.height(),n=this.offsets,r=this.targets,s=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),e>=o)return s!=(t=r[r.length-1])&&this.activate(t);if(s&&e<n[0])return this.activeTarget=null,this.clear();for(t=n.length;t--;)s!=r[t]&&e>=n[t]&&(void 0===n[t+1]||e<n[t+1])&&this.activate(r[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',o=t(i).parents("li").addClass("active");o.parent(".dropdown-menu").length&&(o=o.closest("li.dropdown").addClass("active")),o.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var o=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=o,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);i.call(e,e.data())})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.tab");n||o.data("bs.tab",n=new i(this)),"string"==typeof e&&n[e]()})}var i=function(e){this.element=t(e)};i.VERSION="3.3.7",i.TRANSITION_DURATION=150,i.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),o=e.data("target");if(o||(o=e.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var n=i.find(".active:last a"),r=t.Event("hide.bs.tab",{relatedTarget:e[0]}),s=t.Event("show.bs.tab",{relatedTarget:n[0]});if(n.trigger(r),e.trigger(s),!s.isDefaultPrevented()&&!r.isDefaultPrevented()){var a=t(o);this.activate(e.closest("li"),i),this.activate(a,a.parent(),function(){n.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:n[0]})})}}},i.prototype.activate=function(e,o,n){function r(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),a?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),n&&n()}var s=o.find("> .active"),a=n&&t.support.transition&&(s.length&&s.hasClass("fade")||!!o.find("> .fade").length);s.length&&a?s.one("bsTransitionEnd",r).emulateTransitionEnd(i.TRANSITION_DURATION):r(),s.removeClass("in")};var o=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=i,t.fn.tab.noConflict=function(){return t.fn.tab=o,this};var n=function(i){i.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',n).on("click.bs.tab.data-api",'[data-toggle="pill"]',n)}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var o=t(this),n=o.data("bs.affix"),r="object"==typeof e&&e;n||o.data("bs.affix",n=new i(this,r)),"string"==typeof e&&n[e]()})}var i=function(e,o){this.options=t.extend({},i.DEFAULTS,o),this.$target=t(this.options.target).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};i.VERSION="3.3.7",i.RESET="affix affix-top affix-bottom",i.DEFAULTS={offset:0,target:window},i.prototype.getState=function(t,e,i,o){var n=this.$target.scrollTop(),r=this.$element.offset(),s=this.$target.height();if(null!=i&&"top"==this.affixed)return n<i&&"top";if("bottom"==this.affixed)return null!=i?!(n+this.unpin<=r.top)&&"bottom":!(n+s<=t-o)&&"bottom";var a=null==this.affixed,l=a?n:r.top,h=a?s:e;return null!=i&&n<=i?"top":null!=o&&l+h>=t-o&&"bottom"},i.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(i.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},i.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},i.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),o=this.options.offset,n=o.top,r=o.bottom,s=Math.max(t(document).height(),t(document.body).height());"object"!=typeof o&&(r=n=o),"function"==typeof n&&(n=o.top(this.$element)),"function"==typeof r&&(r=o.bottom(this.$element));var a=this.getState(s,e,n,r);if(this.affixed!=a){null!=this.unpin&&this.$element.css("top","");var l="affix"+(a?"-"+a:""),h=t.Event(l+".bs.affix");if(this.$element.trigger(h),h.isDefaultPrevented())return;this.affixed=a,this.unpin="bottom"==a?this.getPinnedOffset():null,this.$element.removeClass(i.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==a&&this.$element.offset({top:s-e-r})}};var o=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=i,t.fn.affix.noConflict=function(){return t.fn.affix=o,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var i=t(this),o=i.data();o.offset=o.offset||{},null!=o.offsetBottom&&(o.offset.bottom=o.offsetBottom),null!=o.offsetTop&&(o.offset.top=o.offsetTop),e.call(i,o)})})}(jQuery),require("../../js/transition.js"),require("../../js/alert.js"),require("../../js/button.js"),require("../../js/carousel.js"),require("../../js/collapse.js"),require("../../js/dropdown.js"),require("../../js/modal.js"),require("../../js/tooltip.js"),require("../../js/popover.js"),require("../../js/scrollspy.js"),require("../../js/tab.js"),require("../../js/affix.js"),THREE.AnimationClipCreator=function(){},THREE.AnimationClipCreator.CreateRotationAnimation=function(t,e){var i=[0,t],o=[0,360];e=e||"x";var n=".rotation["+e+"]",r=new THREE.NumberKeyframeTrack(n,i,o);return new THREE.AnimationClip(null,t,[r])},THREE.AnimationClipCreator.CreateScaleAxisAnimation=function(t,e){var i=[0,t],o=[0,1];e=e||"x";var n=".scale["+e+"]",r=new THREE.NumberKeyframeTrack(n,i,o);return new THREE.AnimationClip(null,t,[r])},THREE.AnimationClipCreator.CreateShakeAnimation=function(t,e){for(var i=[],o=[],n=new THREE.Vector3,r=0;r<10*t;r++)i.push(r/10),n.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(e).toArray(o,o.length);var s=".position",a=new THREE.VectorKeyframeTrack(s,i,o);return new THREE.AnimationClip(null,t,[a])},THREE.AnimationClipCreator.CreatePulsationAnimation=function(t,e){for(var i=[],o=[],n=new THREE.Vector3,r=0;r<10*t;r++){i.push(r/10);var s=Math.random()*e;n.set(s,s,s).toArray(o,o.length)}var a=".scale",l=new THREE.VectorKeyframeTrack(a,keys);return new THREE.AnimationClip(null,t,[l])},THREE.AnimationClipCreator.CreateVisibilityAnimation=function(t){var e=[0,t/2,t],i=[!0,!1,!0],o=".visible",n=new THREE.BooleanKeyframeTrack(o,e,i);return new THREE.AnimationClip(null,t,[n])},THREE.AnimationClipCreator.CreateMaterialColorAnimation=function(t,e,i){for(var o=[],n=[],r=t/e.length,s=0;s<=e.length;s++)timees.push(s*r),n.push(e[s%e.length]);var a=".material[0].color",l=new THREE.ColorKeyframeTrack(a,o,n);return new THREE.AnimationClip(null,t,[l])},THREE.BlendCharacter=function(){this.weightSchedule=[],this.warpSchedule=[],this.load=function(t,e){var i=this,o=new THREE.ObjectLoader;o.load(t,function(o){if(o.traverse(function(t){t instanceof THREE.SkinnedMesh&&(i.skinnedMesh=t)}),THREE.SkinnedMesh.call(i,i.skinnedMesh.geometry,i.skinnedMesh.material),void 0==i.skinnedMesh)return void console.log("unable to find skinned mesh in "+t);i.material.skinning=!0,i.mixer=new THREE.AnimationMixer(i),i.mixer=i.mixer;for(var n=0;n<i.geometry.animations.length;++n)i.mixer.clipAction(i.geometry.animations[n]);void 0!==e&&e()})},this.loadJSON=function(t,e){var i=this,o=new THREE.JSONLoader;o.load(t,function(t,o){var n=o[0];n.skinning=!0,THREE.SkinnedMesh.call(i,t,n);var r=new THREE.AnimationMixer(i);i.mixer=r;for(var s=0;s<t.animations.length;++s)r.clipAction(t.animations[s]);void 0!==e&&e()})},this.update=function(t){this.mixer.update(t)},this.play=function(t,e){return this.mixer.clipAction(t).setEffectiveWeight(e).play()},this.crossfade=function(t,e,i){this.mixer.stopAllAction();var o=this.play(t,1),n=this.play(e,1);o.crossFadeTo(n,i,!1)},this.warp=function(t,e,i){this.mixer.stopAllAction();var o=this.play(t,1),n=this.play(e,1);o.crossFadeTo(n,i,!0)},this.applyWeight=function(t,e){this.mixer.clipAction(t).setEffectiveWeight(e)},this.getWeight=function(t){return this.mixer.clipAction(t).getEffectiveWeight()},this.pauseAll=function(){this.mixer.timeScale=0},this.unPauseAll=function(){this.mixer.timeScale=1},this.stopAll=function(){this.mixer.stopAllAction()},this.showModel=function(t){this.visible=t}},THREE.BlendCharacter.prototype=Object.create(THREE.SkinnedMesh.prototype),THREE.BlendCharacter.prototype.constructor=THREE.BlendCharacter,THREE.BlendCharacter.prototype.getForward=function(){var t=new THREE.Vector3;return function(){return t.set(-this.matrix.elements[8],-this.matrix.elements[9],-this.matrix.elements[10]),t}},THREE.BufferGeometryUtils={computeTangents:function(t){function e(t,e,i){f.fromArray(s,3*t),m.fromArray(s,3*e),v.fromArray(s,3*i),g.fromArray(l,2*t),E.fromArray(l,2*e),y.fromArray(l,2*i);var o=m.x-f.x,n=v.x-f.x,r=m.y-f.y,a=v.y-f.y,h=m.z-f.z,c=v.z-f.z,p=E.x-g.x,w=y.x-g.x,x=E.y-g.y,R=y.y-g.y,S=1/(p*R-w*x);T.set((R*o-x*n)*S,(R*r-x*a)*S,(R*h-x*c)*S),b.set((p*n-w*o)*S,(p*a-w*r)*S,(p*c-w*h)*S),u[t].add(T),u[e].add(T),u[i].add(T),d[t].add(b),d[e].add(b),d[i].add(b)}function i(t){N.fromArray(a,3*t),$.copy(N),I=u[t],O.copy(I),O.sub(N.multiplyScalar(N.dot(I))).normalize(),P.crossVectors($,I),_=P.dot(d[t]),A=_<0?-1:1,c[4*t]=O.x,c[4*t+1]=O.y,c[4*t+2]=O.z,c[4*t+3]=A}var o=t.index,n=t.attributes;if(null===o||void 0===n.position||void 0===n.normal||void 0===n.uv)return void console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var r=o.array,s=n.position.array,a=n.normal.array,l=n.uv.array,h=s.length/3;void 0===n.tangent&&t.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*h),4));for(var c=n.tangent.array,u=[],d=[],p=0;p<h;p++)u[p]=new THREE.Vector3,d[p]=new THREE.Vector3;var f=new THREE.Vector3,m=new THREE.Vector3,v=new THREE.Vector3,g=new THREE.Vector2,E=new THREE.Vector2,y=new THREE.Vector2,T=new THREE.Vector3,b=new THREE.Vector3,w=t.groups;0===w.length&&(w=[{start:0,count:r.length}]);for(var x=0,R=w.length;x<R;++x)for(var S=w[x],C=S.start,H=S.count,M=C,D=C+H;M<D;M+=3)e(r[M+0],r[M+1],r[M+2]);for(var A,I,_,O=new THREE.Vector3,P=new THREE.Vector3,N=new THREE.Vector3,$=new THREE.Vector3,x=0,R=w.length;x<R;++x)for(var S=w[x],C=S.start,H=S.count,M=C,D=C+H;M<D;M+=3)i(r[M+0]),i(r[M+1]),i(r[M+2])}},THREE.Car=function(){function t(t,e){n.bodyGeometry=t,n.bodyMaterials=e,i()}function e(t,e){n.wheelGeometry=t,n.wheelMaterials=e,i()}function i(){if(n.bodyGeometry&&n.wheelGeometry){if(n.autoWheelGeometry){n.wheelGeometry.computeBoundingBox();var t=n.wheelGeometry.boundingBox;n.wheelOffset.addVectors(t.min,t.max),n.wheelOffset.multiplyScalar(.5),n.wheelDiameter=t.max.y-t.min.y,n.wheelGeometry.center()}var e=n.modelScale,i=new THREE.Vector3,o=new THREE.MultiMaterial(n.bodyMaterials),r=new THREE.MultiMaterial(n.wheelMaterials);n.bodyMesh=new THREE.Mesh(n.bodyGeometry,o),n.bodyMesh.scale.set(e,e,e),n.root.add(n.bodyMesh),i.multiplyVectors(n.wheelOffset,new THREE.Vector3(e,e,e)),n.frontLeftWheelRoot.position.add(i),n.frontLeftWheelMesh=new THREE.Mesh(n.wheelGeometry,r),n.frontLeftWheelMesh.scale.set(e,e,e),n.frontLeftWheelRoot.add(n.frontLeftWheelMesh),n.root.add(n.frontLeftWheelRoot),i.multiplyVectors(n.wheelOffset,new THREE.Vector3((-e),e,e)),n.frontRightWheelRoot.position.add(i),n.frontRightWheelMesh=new THREE.Mesh(n.wheelGeometry,r),n.frontRightWheelMesh.scale.set(e,e,e),n.frontRightWheelMesh.rotation.z=Math.PI,n.frontRightWheelRoot.add(n.frontRightWheelMesh),n.root.add(n.frontRightWheelRoot),i.multiplyVectors(n.wheelOffset,new THREE.Vector3(e,e,(-e))),i.z-=n.backWheelOffset,n.backLeftWheelMesh=new THREE.Mesh(n.wheelGeometry,r),n.backLeftWheelMesh.position.add(i),n.backLeftWheelMesh.scale.set(e,e,e),n.root.add(n.backLeftWheelMesh),i.multiplyVectors(n.wheelOffset,new THREE.Vector3((-e),e,(-e))),i.z-=n.backWheelOffset,n.backRightWheelMesh=new THREE.Mesh(n.wheelGeometry,r),n.backRightWheelMesh.position.add(i),n.backRightWheelMesh.scale.set(e,e,e),n.backRightWheelMesh.rotation.z=Math.PI,n.root.add(n.backRightWheelMesh),n.meshes=[n.bodyMesh,n.frontLeftWheelMesh,n.frontRightWheelMesh,n.backLeftWheelMesh,n.backRightWheelMesh],n.loaded=!0,n.callback&&n.callback(n)}}function o(t){return 1===t?1:-Math.pow(2,-10*t)+1}var n=this;this.modelScale=1,this.backWheelOffset=2,this.autoWheelGeometry=!0,this.wheelOffset=new THREE.Vector3,this.wheelDiameter=1,this.MAX_SPEED=2200,this.MAX_REVERSE_SPEED=-1500,this.MAX_WHEEL_ROTATION=.6,this.FRONT_ACCELERATION=1250,this.BACK_ACCELERATION=1500,this.WHEEL_ANGULAR_ACCELERATION=1.5,this.FRONT_DECCELERATION=750,this.WHEEL_ANGULAR_DECCELERATION=1,this.STEERING_RADIUS_RATIO=.0023,this.MAX_TILT_SIDES=.05,this.MAX_TILT_FRONTBACK=.015,this.speed=0,this.acceleration=0,this.wheelOrientation=0,this.carOrientation=0,this.root=new THREE.Object3D,this.frontLeftWheelRoot=new THREE.Object3D,this.frontRightWheelRoot=new THREE.Object3D,this.bodyMesh=null,this.frontLeftWheelMesh=null,this.frontRightWheelMesh=null,this.backLeftWheelMesh=null,this.backRightWheelMesh=null,this.bodyGeometry=null,this.wheelGeometry=null,this.bodyMaterials=null,this.wheelMaterials=null,this.loaded=!1,this.meshes=[],this.enableShadows=function(t){for(var e=0;e<this.meshes.length;e++)this.meshes[e].castShadow=t,this.meshes[e].receiveShadow=t},this.setVisible=function(t){for(var e=0;e<this.meshes.length;e++)this.meshes[e].visible=t,this.meshes[e].visible=t},this.loadPartsJSON=function(i,o){var n=new THREE.JSONLoader;n.load(i,function(e,i){t(e,i)}),n.load(o,function(t,i){e(t,i)})},this.loadPartsBinary=function(i,o){var n=new THREE.BinaryLoader;n.load(i,function(e,i){t(e,i)}),n.load(o,function(t,i){e(t,i)})},this.updateCarModel=function(t,e){if(e.moveForward&&(this.speed=THREE.Math.clamp(this.speed+t*this.FRONT_ACCELERATION,this.MAX_REVERSE_SPEED,this.MAX_SPEED),this.acceleration=THREE.Math.clamp(this.acceleration+t,-1,1)),e.moveBackward&&(this.speed=THREE.Math.clamp(this.speed-t*this.BACK_ACCELERATION,this.MAX_REVERSE_SPEED,this.MAX_SPEED),this.acceleration=THREE.Math.clamp(this.acceleration-t,-1,1)),e.moveLeft&&(this.wheelOrientation=THREE.Math.clamp(this.wheelOrientation+t*this.WHEEL_ANGULAR_ACCELERATION,-this.MAX_WHEEL_ROTATION,this.MAX_WHEEL_ROTATION)),e.moveRight&&(this.wheelOrientation=THREE.Math.clamp(this.wheelOrientation-t*this.WHEEL_ANGULAR_ACCELERATION,-this.MAX_WHEEL_ROTATION,this.MAX_WHEEL_ROTATION)),!e.moveForward&&!e.moveBackward)if(this.speed>0){var i=o(this.speed/this.MAX_SPEED);this.speed=THREE.Math.clamp(this.speed-i*t*this.FRONT_DECCELERATION,0,this.MAX_SPEED),this.acceleration=THREE.Math.clamp(this.acceleration-i*t,0,1)}else{var i=o(this.speed/this.MAX_REVERSE_SPEED);this.speed=THREE.Math.clamp(this.speed+i*t*this.BACK_ACCELERATION,this.MAX_REVERSE_SPEED,0),
this.acceleration=THREE.Math.clamp(this.acceleration+i*t,-1,0)}e.moveLeft||e.moveRight||(this.wheelOrientation>0?this.wheelOrientation=THREE.Math.clamp(this.wheelOrientation-t*this.WHEEL_ANGULAR_DECCELERATION,0,this.MAX_WHEEL_ROTATION):this.wheelOrientation=THREE.Math.clamp(this.wheelOrientation+t*this.WHEEL_ANGULAR_DECCELERATION,-this.MAX_WHEEL_ROTATION,0));var n=this.speed*t;this.carOrientation+=n*this.STEERING_RADIUS_RATIO*this.wheelOrientation,this.root.position.x+=Math.sin(this.carOrientation)*n,this.root.position.z+=Math.cos(this.carOrientation)*n,this.root.rotation.y=this.carOrientation,this.loaded&&(this.bodyMesh.rotation.z=this.MAX_TILT_SIDES*this.wheelOrientation*(this.speed/this.MAX_SPEED),this.bodyMesh.rotation.x=-this.MAX_TILT_FRONTBACK*this.acceleration);var r=1/(this.modelScale*(this.wheelDiameter/2)),s=n*r;this.loaded&&(this.frontLeftWheelMesh.rotation.x+=s,this.frontRightWheelMesh.rotation.x+=s,this.backLeftWheelMesh.rotation.x+=s,this.backRightWheelMesh.rotation.x+=s),this.frontLeftWheelRoot.rotation.y=this.wheelOrientation,this.frontRightWheelRoot.rotation.y=this.wheelOrientation}};var DAMPING=.03,DRAG=1-DAMPING,MASS=.1,restDistance=25,xSegs=10,ySegs=10,clothFunction=plane(restDistance*xSegs,restDistance*ySegs),cloth=new Cloth(xSegs,ySegs),GRAVITY=981*1.4,gravity=new THREE.Vector3(0,(-GRAVITY),0).multiplyScalar(MASS),TIMESTEP=.018,TIMESTEP_SQ=TIMESTEP*TIMESTEP,pins=[],wind=!0,windStrength=2,windForce=new THREE.Vector3(0,0,0),ballPosition=new THREE.Vector3(0,(-45),0),ballSize=60,tmpForce=new THREE.Vector3,lastTime;Particle.prototype.addForce=function(t){this.a.add(this.tmp2.copy(t).multiplyScalar(this.invMass))},Particle.prototype.integrate=function(t){var e=this.tmp.subVectors(this.position,this.previous);e.multiplyScalar(DRAG).add(this.position),e.add(this.a.multiplyScalar(t)),this.tmp=this.previous,this.previous=this.position,this.position=e,this.a.set(0,0,0)};var diff=new THREE.Vector3;THREE.Curves={},THREE.Curves.GrannyKnot=THREE.Curve.create(function(){},function(t){t=2*Math.PI*t;var e=-.22*Math.cos(t)-1.28*Math.sin(t)-.44*Math.cos(3*t)-.78*Math.sin(3*t),i=-.1*Math.cos(2*t)-.27*Math.sin(2*t)+.38*Math.cos(4*t)+.46*Math.sin(4*t),o=.7*Math.cos(3*t)-.4*Math.sin(3*t);return new THREE.Vector3(e,i,o).multiplyScalar(20)}),THREE.Curves.HeartCurve=THREE.Curve.create(function(t){this.scale=void 0===t?5:t},function(t){t*=2*Math.PI;var e=16*Math.pow(Math.sin(t),3),i=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t),o=0;return new THREE.Vector3(e,i,o).multiplyScalar(this.scale)}),THREE.Curves.VivianiCurve=THREE.Curve.create(function(t){this.radius=t},function(t){t=4*t*Math.PI;var e=this.radius/2,i=e*(1+Math.cos(t)),o=e*Math.sin(t),n=2*e*Math.sin(t/2);return new THREE.Vector3(i,o,n)}),THREE.Curves.KnotCurve=THREE.Curve.create(function(){},function(t){t*=2*Math.PI;var e=10,i=50,o=i*Math.sin(t),n=Math.cos(t)*(e+i*Math.cos(t)),r=Math.sin(t)*(e+i*Math.cos(t));return new THREE.Vector3(o,n,r)}),THREE.Curves.HelixCurve=THREE.Curve.create(function(){},function(t){var e=30,i=150,o=2*Math.PI*t*i/30,n=Math.cos(o)*e,r=Math.sin(o)*e,s=i*t;return new THREE.Vector3(n,r,s)}),THREE.Curves.TrefoilKnot=THREE.Curve.create(function(t){this.scale=void 0===t?10:t},function(t){t*=2*Math.PI;var e=(2+Math.cos(3*t))*Math.cos(2*t),i=(2+Math.cos(3*t))*Math.sin(2*t),o=Math.sin(3*t);return new THREE.Vector3(e,i,o).multiplyScalar(this.scale)}),THREE.Curves.TorusKnot=THREE.Curve.create(function(t){this.scale=void 0===t?10:t},function(t){var e=3,i=4;t*=2*Math.PI;var o=(2+Math.cos(i*t))*Math.cos(e*t),n=(2+Math.cos(i*t))*Math.sin(e*t),r=Math.sin(i*t);return new THREE.Vector3(o,n,r).multiplyScalar(this.scale)}),THREE.Curves.CinquefoilKnot=THREE.Curve.create(function(t){this.scale=void 0===t?10:t},function(t){var e=2,i=5;t*=2*Math.PI;var o=(2+Math.cos(i*t))*Math.cos(e*t),n=(2+Math.cos(i*t))*Math.sin(e*t),r=Math.sin(i*t);return new THREE.Vector3(o,n,r).multiplyScalar(this.scale)}),THREE.Curves.TrefoilPolynomialKnot=THREE.Curve.create(function(t){this.scale=void 0===t?10:t},function(t){t=4*t-2;var e=Math.pow(t,3)-3*t,i=Math.pow(t,4)-4*t*t,o=.2*Math.pow(t,5)-2*t;return new THREE.Vector3(e,i,o).multiplyScalar(this.scale)});var scaleTo=function(t,e,i){var o=e-t;return i*o+t};THREE.Curves.FigureEightPolynomialKnot=THREE.Curve.create(function(t){this.scale=void 0===t?1:t},function(t){t=scaleTo(-4,4,t);var e=.4*t*(t*t-7)*(t*t-10),i=Math.pow(t,4)-13*t*t,o=.1*t*(t*t-4)*(t*t-9)*(t*t-12);return new THREE.Vector3(e,i,o).multiplyScalar(this.scale)}),THREE.Curves.DecoratedTorusKnot4a=THREE.Curve.create(function(t){this.scale=void 0===t?40:t},function(t){t*=2*Math.PI;var e=Math.cos(2*t)*(1+.6*(Math.cos(5*t)+.75*Math.cos(10*t))),i=Math.sin(2*t)*(1+.6*(Math.cos(5*t)+.75*Math.cos(10*t))),o=.35*Math.sin(5*t);return new THREE.Vector3(e,i,o).multiplyScalar(this.scale)}),THREE.Curves.DecoratedTorusKnot4b=THREE.Curve.create(function(t){this.scale=void 0===t?40:t},function(t){var e=t*Math.PI*2,i=Math.cos(2*e)*(1+.45*Math.cos(3*e)+.4*Math.cos(9*e)),o=Math.sin(2*e)*(1+.45*Math.cos(3*e)+.4*Math.cos(9*e)),n=.2*Math.sin(9*e);return new THREE.Vector3(i,o,n).multiplyScalar(this.scale)}),THREE.Curves.DecoratedTorusKnot5a=THREE.Curve.create(function(t){this.scale=void 0===t?40:t},function(t){var e=t*Math.PI*2,i=Math.cos(3*e)*(1+.3*Math.cos(5*e)+.5*Math.cos(10*e)),o=Math.sin(3*e)*(1+.3*Math.cos(5*e)+.5*Math.cos(10*e)),n=.2*Math.sin(20*e);return new THREE.Vector3(i,o,n).multiplyScalar(this.scale)}),THREE.Curves.DecoratedTorusKnot5c=THREE.Curve.create(function(t){this.scale=void 0===t?40:t},function(t){var e=t*Math.PI*2,i=Math.cos(4*e)*(1+.5*(Math.cos(5*e)+.4*Math.cos(20*e))),o=Math.sin(4*e)*(1+.5*(Math.cos(5*e)+.4*Math.cos(20*e))),n=.35*Math.sin(15*e);return new THREE.Vector3(i,o,n).multiplyScalar(this.scale)});var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),t},addGetWebGLMessage:function(t){var e,i,o;t=t||{},e=void 0!==t.parent?t.parent:document.body,i=void 0!==t.id?t.id:"oldie",o=Detector.getWebGLErrorMessage(),o.id=i,e.appendChild(o)}};"object"==typeof module&&(module.exports=Detector),THREE.Encodings=function(){if(void 0===THREE.toHalf)throw new Error("THREE.Encodings is required for HDRCubeMapLoader when loading half data.")},THREE.Encodings.RGBEByteToRGBFloat=function(t,e,i,o){var n=t[e+3],r=Math.pow(2,n-128)/255;i[o+0]=t[e+0]*r,i[o+1]=t[e+1]*r,i[o+2]=t[e+2]*r},THREE.Encodings.RGBEByteToRGBHalf=function(t,e,i,o){var n=t[e+3],r=Math.pow(2,n-128)/255;i[o+0]=THREE.toHalf(t[e+0]*r),i[o+1]=THREE.toHalf(t[e+1]*r),i[o+2]=THREE.toHalf(t[e+2]*r)},THREE.GPUParticleSystem=function(t){var e=this,t=t||{};e.PARTICLE_COUNT=t.maxParticles||1e6,e.PARTICLE_CONTAINERS=t.containerCount||1,e.PARTICLE_NOISE_TEXTURE=t.particleNoiseTex||null,e.PARTICLE_SPRITE_TEXTURE=t.particleSpriteTex||null,e.PARTICLES_PER_CONTAINER=Math.ceil(e.PARTICLE_COUNT/e.PARTICLE_CONTAINERS),e.PARTICLE_CURSOR=0,e.time=0;var i={vertexShader:["precision highp float;","const vec4 bitSh = vec4(256. * 256. * 256., 256. * 256., 256., 1.);","const vec4 bitMsk = vec4(0.,vec3(1./256.0));","const vec4 bitShifts = vec4(1.) / bitSh;","#define FLOAT_MAX\t1.70141184e38","#define FLOAT_MIN\t1.17549435e-38","lowp vec4 encode_float(highp float v) {","highp float av = abs(v);","//Handle special cases","if(av < FLOAT_MIN) {","return vec4(0.0, 0.0, 0.0, 0.0);","} else if(v > FLOAT_MAX) {","return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;","} else if(v < -FLOAT_MAX) {","return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;","}","highp vec4 c = vec4(0,0,0,0);","//Compute exponent and mantissa","highp float e = floor(log2(av));","highp float m = av * pow(2.0, -e) - 1.0;","c[1] = floor(128.0 * m);","m -= c[1] / 128.0;","c[2] = floor(32768.0 * m);","m -= c[2] / 32768.0;","c[3] = floor(8388608.0 * m);","//Unpack exponent","highp float ebias = e + 127.0;","c[0] = floor(ebias / 2.0);","ebias -= c[0] * 2.0;","c[1] += floor(ebias) * 128.0;","//Unpack sign bit","c[0] += 128.0 * step(0.0, -v);","//Scale back to range","return c / 255.0;","}","vec4 pack(const in float depth)","{","const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);","const vec4 bit_mask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);","vec4 res = mod(depth*bit_shift*vec4(255), vec4(256))/vec4(255);","res -= res.xxyz * bit_mask;","return res;","}","float unpack(const in vec4 rgba_depth)","{","const vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);","float depth = dot(rgba_depth, bit_shift);","return depth;","}","uniform float uTime;","uniform float uScale;","uniform sampler2D tNoise;","attribute vec4 particlePositionsStartTime;","attribute vec4 particleVelColSizeLife;","varying vec4 vColor;","varying float lifeLeft;","void main() {","// unpack things from our attributes","vColor = encode_float( particleVelColSizeLife.y );","// convert our velocity back into a value we can use","vec4 velTurb = encode_float( particleVelColSizeLife.x );","vec3 velocity = vec3( velTurb.xyz );","float turbulence = velTurb.w;","vec3 newPosition;","float timeElapsed = uTime - particlePositionsStartTime.a;","lifeLeft = 1. - (timeElapsed / particleVelColSizeLife.w);","gl_PointSize = ( uScale * particleVelColSizeLife.z ) * lifeLeft;","velocity.x = ( velocity.x - .5 ) * 3.;","velocity.y = ( velocity.y - .5 ) * 3.;","velocity.z = ( velocity.z - .5 ) * 3.;","newPosition = particlePositionsStartTime.xyz + ( velocity * 10. ) * ( uTime - particlePositionsStartTime.a );","vec3 noise = texture2D( tNoise, vec2( newPosition.x * .015 + (uTime * .05), newPosition.y * .02 + (uTime * .015) )).rgb;","vec3 noiseVel = ( noise.rgb - .5 ) * 30.;","newPosition = mix(newPosition, newPosition + vec3(noiseVel * ( turbulence * 5. ) ), (timeElapsed / particleVelColSizeLife.a) );","if( velocity.y > 0. && velocity.y < .05 ) {","lifeLeft = 0.;","}","if( velocity.x < -1.45 ) {","lifeLeft = 0.;","}","if( timeElapsed > 0. ) {","gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","} else {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","lifeLeft = 0.;","gl_PointSize = 0.;","}","}"].join("\n"),fragmentShader:["float scaleLinear(float value, vec2 valueDomain) {","return (value - valueDomain.x) / (valueDomain.y - valueDomain.x);","}","float scaleLinear(float value, vec2 valueDomain, vec2 valueRange) {","return mix(valueRange.x, valueRange.y, scaleLinear(value, valueDomain));","}","varying vec4 vColor;","varying float lifeLeft;","uniform sampler2D tSprite;","void main() {","float alpha = 0.;","if( lifeLeft > .995 ) {","alpha = scaleLinear( lifeLeft, vec2(1., .995), vec2(0., 1.));//mix( 0., 1., ( lifeLeft - .95 ) * 100. ) * .75;","} else {","alpha = lifeLeft * .75;","}","vec4 tex = texture2D( tSprite, gl_PointCoord );","gl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );","}"].join("\n")};e.rand=[];for(var o=1e5;o>0;o--)e.rand.push(Math.random()-.5);e.random=function(){return++o>=e.rand.length?e.rand[o=1]:e.rand[o]};var n=new THREE.TextureLoader;e.particleNoiseTex=e.PARTICLE_NOISE_TEXTURE||n.load("textures/perlin-512.png"),e.particleNoiseTex.wrapS=e.particleNoiseTex.wrapT=THREE.RepeatWrapping,e.particleSpriteTex=e.PARTICLE_SPRITE_TEXTURE||n.load("textures/particle2.png"),e.particleSpriteTex.wrapS=e.particleSpriteTex.wrapT=THREE.RepeatWrapping,e.particleShaderMat=new THREE.ShaderMaterial({transparent:!0,depthWrite:!1,uniforms:{uTime:{value:0},uScale:{value:1},tNoise:{value:e.particleNoiseTex},tSprite:{value:e.particleSpriteTex}},blending:THREE.AdditiveBlending,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),e.particleShaderMat.defaultAttributeValues.particlePositionsStartTime=[0,0,0,0],e.particleShaderMat.defaultAttributeValues.particleVelColSizeLife=[0,0,0,0],e.particleContainers=[],THREE.Object3D.apply(this,arguments),this.init=function(){for(var t=0;t<e.PARTICLE_CONTAINERS;t++){var i=new THREE.GPUParticleContainer(e.PARTICLES_PER_CONTAINER,e);e.particleContainers.push(i),e.add(i)}},this.spawnParticle=function(t){e.PARTICLE_CURSOR++,e.PARTICLE_CURSOR>=e.PARTICLE_COUNT&&(e.PARTICLE_CURSOR=1);var i=e.particleContainers[Math.floor(e.PARTICLE_CURSOR/e.PARTICLES_PER_CONTAINER)];i.spawnParticle(t)},this.update=function(t){for(var i=0;i<e.PARTICLE_CONTAINERS;i++)e.particleContainers[i].update(t)},this.init()},THREE.GPUParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.GPUParticleSystem.prototype.constructor=THREE.GPUParticleSystem,THREE.GPUParticleContainer=function(t,e){function i(t,e,i,o){return r[0]=Math.floor(o),r[1]=Math.floor(i),r[2]=Math.floor(e),r[3]=Math.floor(t),s[0]}function o(t){var e=t>>16,i=(65280&t)>>8,o=255&t;return e>0&&e--,i>0&&i--,o>0&&o--,[e,i,o]}var n=this;n.PARTICLE_COUNT=t||1e5,n.PARTICLE_CURSOR=0,n.time=0,n.DPR=window.devicePixelRatio,n.GPUParticleSystem=e;Math.floor(n.PARTICLE_COUNT/n.MAX_ATTRIBUTES);THREE.Object3D.apply(this,arguments);var r=new Uint8Array(4),s=new Float32Array(r.buffer);n.particles=[],n.deadParticles=[],n.particlesAvailableSlot=[],n.particleUpdate=!1,n.particleShaderGeo=new THREE.BufferGeometry,n.particleVertices=new Float32Array(3*n.PARTICLE_COUNT),n.particlePositionsStartTime=new Float32Array(4*n.PARTICLE_COUNT),n.particleVelColSizeLife=new Float32Array(4*n.PARTICLE_COUNT);for(var a=0;a<n.PARTICLE_COUNT;a++)n.particlePositionsStartTime[4*a+0]=100,n.particlePositionsStartTime[4*a+1]=0,n.particlePositionsStartTime[4*a+2]=0,n.particlePositionsStartTime[4*a+3]=0,n.particleVertices[3*a+0]=0,n.particleVertices[3*a+1]=0,n.particleVertices[3*a+2]=0,n.particleVelColSizeLife[4*a+0]=i(128,128,0,0),n.particleVelColSizeLife[4*a+1]=i(0,254,0,254),n.particleVelColSizeLife[4*a+2]=1,n.particleVelColSizeLife[4*a+3]=0;n.particleShaderGeo.addAttribute("position",new THREE.BufferAttribute(n.particleVertices,3)),n.particleShaderGeo.addAttribute("particlePositionsStartTime",new THREE.BufferAttribute(n.particlePositionsStartTime,4).setDynamic(!0)),n.particleShaderGeo.addAttribute("particleVelColSizeLife",new THREE.BufferAttribute(n.particleVelColSizeLife,4).setDynamic(!0)),n.posStart=n.particleShaderGeo.getAttribute("particlePositionsStartTime"),n.velCol=n.particleShaderGeo.getAttribute("particleVelColSizeLife"),n.particleShaderMat=n.GPUParticleSystem.particleShaderMat,this.init=function(){n.particleSystem=new THREE.Points(n.particleShaderGeo,n.particleShaderMat),n.particleSystem.frustumCulled=!1,this.add(n.particleSystem)};var a,l=new THREE.Vector3,h=new THREE.Vector3,c=0,u=0,d=16777215,p=0,f=0,m=0,v=0,g=2,E=250;this.offset=0,this.count=0,this.spawnParticle=function(t){t=t||{},l=void 0!==t.position?l.copy(t.position):l.set(0,0,0),h=void 0!==t.velocity?h.copy(t.velocity):h.set(0,0,0),c=void 0!==t.positionRandomness?t.positionRandomness:0,u=void 0!==t.velocityRandomness?t.velocityRandomness:0,d=void 0!==t.color?t.color:16777215,p=void 0!==t.colorRandomness?t.colorRandomness:1,T=void 0!==t.turbulence?t.turbulence:1,f=void 0!==t.lifetime?t.lifetime:5,m=void 0!==t.size?t.size:10,v=void 0!==t.sizeRandomness?t.sizeRandomness:0,smoothPosition=void 0!==t.smoothPosition&&t.smoothPosition,void 0!==n.DPR&&(m*=n.DPR),a=n.PARTICLE_CURSOR,n.posStart.array[4*a+0]=l.x+e.random()*c,n.posStart.array[4*a+1]=l.y+e.random()*c,n.posStart.array[4*a+2]=l.z+e.random()*c,n.posStart.array[4*a+3]=n.time+.02*e.random(),smoothPosition===!0&&(n.posStart.array[4*a+0]+=-(h.x*e.random()),n.posStart.array[4*a+1]+=-(h.y*e.random()),n.posStart.array[4*a+2]+=-(h.z*e.random()));var r=h.x+e.random()*u,s=h.y+e.random()*u,y=h.z+e.random()*u,T=Math.floor(254*T);r=Math.floor(E*((r- -g)/(g- -g))),s=Math.floor(E*((s- -g)/(g- -g))),y=Math.floor(E*((y- -g)/(g- -g))),n.velCol.array[4*a+0]=i(r,s,y,T);for(var b=o(d),w=0;w<b.length;w++)b[w]=Math.floor(b[w]+e.random()*p*254),b[w]>254&&(b[w]=254),b[w]<0&&(b[w]=0);n.velCol.array[4*a+1]=i(b[0],b[1],b[2],254),n.velCol.array[4*a+2]=m+e.random()*v,n.velCol.array[4*a+3]=f,0==this.offset&&(this.offset=n.PARTICLE_CURSOR),n.count++,n.PARTICLE_CURSOR++,n.PARTICLE_CURSOR>=n.PARTICLE_COUNT&&(n.PARTICLE_CURSOR=0),n.particleUpdate=!0},this.update=function(t){n.time=t,n.particleShaderMat.uniforms.uTime.value=t,this.geometryUpdate()},this.geometryUpdate=function(){1==n.particleUpdate&&(n.particleUpdate=!1,n.offset+n.count<n.PARTICLE_COUNT?(n.posStart.updateRange.offset=n.velCol.updateRange.offset=4*n.offset,n.posStart.updateRange.count=n.velCol.updateRange.count=4*n.count):(n.posStart.updateRange.offset=0,n.posStart.updateRange.count=n.velCol.updateRange.count=4*n.PARTICLE_COUNT),n.posStart.needsUpdate=!0,n.velCol.needsUpdate=!0,n.offset=0,n.count=0)},this.init()},THREE.GPUParticleContainer.prototype=Object.create(THREE.Object3D.prototype),THREE.GPUParticleContainer.prototype.constructor=THREE.GPUParticleContainer,THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.constructor=THREE.Gyroscope,THREE.Gyroscope.prototype.updateMatrixWorld=function(){var t=new THREE.Vector3,e=new THREE.Quaternion,i=new THREE.Vector3,o=new THREE.Vector3,n=new THREE.Quaternion,r=new THREE.Vector3;return function(s){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||s)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(o,n,r),this.matrix.decompose(t,e,i),this.matrixWorld.compose(o,e,r)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,s=!0);for(var a=0,l=this.children.length;a<l;a++)this.children[a].updateMatrixWorld(s)}}(),THREE.toHalf=function(){var t=new Float32Array(1),e=new Int32Array(t.buffer);return function(i){t[0]=i;var o=e[0],n=o>>16&32768,r=o>>12&2047,s=o>>23&255;return s<103?n:s>142?(n|=31744,n|=(255==s?0:1)&&8388607&o):s<113?(r|=2048,n|=(r>>114-s)+(r>>113-s&1)):(n|=s-112<<10|r>>1,n+=1&r)}}();var ImprovedNoise=function(){function t(t){return t*t*t*(t*(6*t-15)+10)}function e(t,e,i){return e+t*(i-e)}function i(t,e,i,o){var n=15&t,r=n<8?e:i,s=n<4?i:12==n||14==n?e:o;return(0==(1&n)?r:-r)+(0==(2&n)?s:-s)}for(var o=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],n=0;n<256;n++)o[256+n]=o[n];return{noise:function(n,r,s){var a=Math.floor(n),l=Math.floor(r),h=Math.floor(s),c=255&a,u=255&l,d=255&h;n-=a,r-=l,s-=h;var p=n-1,f=r-1,m=s-1,v=t(n),g=t(r),E=t(s),y=o[c]+u,T=o[y]+d,b=o[y+1]+d,w=o[c+1]+u,x=o[w]+d,R=o[w+1]+d;return e(E,e(g,e(v,i(o[T],n,r,s),i(o[x],p,r,s)),e(v,i(o[b],n,f,s),i(o[R],p,f,s))),e(g,e(v,i(o[T+1],n,r,m),i(o[x+1],p,r,s-1)),e(v,i(o[b+1],n,f,m),i(o[R+1],p,f,m))))}}};THREE.MD2Character=function(){function t(t,e){for(var o=new THREE.TextureLoader,n=[],r=0;r<e.length;r++)n[r]=o.load(t+e[r],i),n[r].mapping=THREE.UVMapping,n[r].name=e[r];return n}function e(t,e){var i=new THREE.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),o=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1,map:e,morphTargets:!0,morphNormals:!0}),n=new THREE.Mesh(t,o);return n.rotation.y=-Math.PI/2,n.castShadow=!0,n.receiveShadow=!0,n.materialTexture=o,n.materialWireframe=i,n}function i(){o.loadCounter-=1,0===o.loadCounter&&o.onLoadComplete()}var o=this;this.scale=1,this.animationFPS=6,this.root=new THREE.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(n){this.loadCounter=2*n.weapons.length+n.skins.length+1;for(var r=[],s=0;s<n.weapons.length;s++)r[s]=n.weapons[s][1];this.skinsBody=t(n.baseUrl+"skins/",n.skins),this.skinsWeapon=t(n.baseUrl+"skins/",r);var a=new THREE.MD2Loader;a.load(n.baseUrl+n.body,function(t){t.computeBoundingBox(),o.root.position.y=-o.scale*t.boundingBox.min.y;var n=e(t,o.skinsBody[0]);n.scale.set(o.scale,o.scale,o.scale),o.root.add(n),o.meshBody=n,o.meshBody.clipOffset=0,o.activeAnimationClipName=n.geometry.animations[0].name,o.mixer=new THREE.AnimationMixer(n),i()});for(var l=function(t,n){return function(r){var s=e(r,o.skinsWeapon[t]);s.scale.set(o.scale,o.scale,o.scale),s.visible=!1,s.name=n,o.root.add(s),o.weapons[t]=s,o.meshWeapon=s,i()}},s=0;s<n.weapons.length;s++)a.load(n.baseUrl+n.weapons[s][0],l(s,n.weapons[s][0]))},this.setPlaybackRate=function(t){0!==t?this.mixer.timeScale=1/t:this.mixer.timeScale=0},this.setWireframe=function(t){t?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(t){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[t])},this.setWeapon=function(t){for(var e=0;e<this.weapons.length;e++)this.weapons[e].visible=!1;var i=this.weapons[t];i&&(i.visible=!0,this.meshWeapon=i,o.syncWeaponAnimation())},this.setAnimation=function(t){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var e=this.mixer.clipAction(t,this.meshBody);e&&(this.meshBody.activeAction=e.play())}o.activeClipName=t,o.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var t=o.activeClipName;if(o.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);var e=this.meshWeapon.geometry,i=(e.animations,this.mixer.clipAction(t,this.meshWeapon));i&&(this.meshWeapon.activeAction=i.syncWith(this.meshBody.activeAction).play())}},this.update=function(t){this.mixer&&this.mixer.update(t)}},THREE.MD2CharacterComplex=function(){function t(t,e){for(var o=new THREE.TextureLoader,n=[],r=0;r<e.length;r++)n[r]=o.load(t+e[r],i),n[r].mapping=THREE.UVMapping,n[r].name=e[r];return n}function e(t,e){var i=new THREE.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),o=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1,map:e,morphTargets:!0,morphNormals:!0}),r=new THREE.MorphBlendMesh(t,o);return r.rotation.y=-Math.PI/2,r.materialTexture=o,r.materialWireframe=i,r.autoCreateAnimations(n.animationFPS),r}function i(){n.loadCounter-=1,0===n.loadCounter&&n.onLoadComplete()}function o(t){return 1===t?1:-Math.pow(2,-10*t)+1}var n=this;this.scale=1,this.animationFPS=6,this.transitionFrames=15,this.maxSpeed=275,this.maxReverseSpeed=-275,this.frontAcceleration=600,this.backAcceleration=600,this.frontDecceleration=600,this.angularSpeed=2.5,this.root=new THREE.Object3D,this.meshBody=null,this.meshWeapon=null,this.controls=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.currentSkin=void 0,this.onLoadComplete=function(){},this.meshes=[],this.animations={},this.loadCounter=0,this.speed=0,this.bodyOrientation=0,this.walkSpeed=this.maxSpeed,this.crouchSpeed=.5*this.maxSpeed,this.activeAnimation=null,this.oldAnimation=null,this.enableShadows=function(t){for(var e=0;e<this.meshes.length;e++)this.meshes[e].castShadow=t,this.meshes[e].receiveShadow=t},this.setVisible=function(t){for(var e=0;e<this.meshes.length;e++)this.meshes[e].visible=t,this.meshes[e].visible=t},this.shareParts=function(t){this.animations=t.animations,this.walkSpeed=t.walkSpeed,this.crouchSpeed=t.crouchSpeed,this.skinsBody=t.skinsBody,this.skinsWeapon=t.skinsWeapon;var i=e(t.meshBody.geometry,this.skinsBody[0]);i.scale.set(this.scale,this.scale,this.scale),this.root.position.y=t.root.position.y,this.root.add(i),this.meshBody=i,this.meshes.push(i);for(var o=0;o<t.weapons.length;o++){var n=e(t.weapons[o].geometry,this.skinsWeapon[o]);n.scale.set(this.scale,this.scale,this.scale),n.visible=!1,n.name=t.weapons[o].name,this.root.add(n),this.weapons[o]=n,this.meshWeapon=n,this.meshes.push(n)}},this.loadParts=function(o){this.animations=o.animations,this.walkSpeed=o.walkSpeed,this.crouchSpeed=o.crouchSpeed,this.loadCounter=2*o.weapons.length+o.skins.length+1;for(var r=[],s=0;s<o.weapons.length;s++)r[s]=o.weapons[s][1];this.skinsBody=t(o.baseUrl+"skins/",o.skins),this.skinsWeapon=t(o.baseUrl+"skins/",r);var a=new THREE.MD2Loader;a.load(o.baseUrl+o.body,function(t){t.computeBoundingBox(),n.root.position.y=-n.scale*t.boundingBox.min.y;var o=e(t,n.skinsBody[0]);o.scale.set(n.scale,n.scale,n.scale),n.root.add(o),n.meshBody=o,n.meshes.push(o),i()});for(var l=function(t,o){return function(r){var s=e(r,n.skinsWeapon[t]);s.scale.set(n.scale,n.scale,n.scale),s.visible=!1,s.name=o,n.root.add(s),n.weapons[t]=s,n.meshWeapon=s,n.meshes.push(s),i()}},s=0;s<o.weapons.length;s++)a.load(o.baseUrl+o.weapons[s][0],l(s,o.weapons[s][0]))},this.setPlaybackRate=function(t){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/t),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/t)},this.setWireframe=function(t){t?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(t){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[t],this.currentSkin=t)},this.setWeapon=function(t){for(var e=0;e<this.weapons.length;e++)this.weapons[e].visible=!1;var i=this.weapons[t];i&&(i.visible=!0,this.meshWeapon=i,this.activeAnimation&&(i.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation))))},this.setAnimation=function(t){t!==this.activeAnimation&&t&&(this.meshBody&&(this.meshBody.setAnimationWeight(t,0),this.meshBody.playAnimation(t),this.oldAnimation=this.activeAnimation,this.activeAnimation=t,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(t,0),this.meshWeapon.playAnimation(t)))},this.update=function(t){this.controls&&this.updateMovementModel(t),this.animations&&(this.updateBehaviors(t),this.updateAnimations(t))},this.updateAnimations=function(t){var e=1;this.blendCounter>0&&(e=(this.transitionFrames-this.blendCounter)/this.transitionFrames,this.blendCounter-=1),this.meshBody&&(this.meshBody.update(t),this.meshBody.setAnimationWeight(this.activeAnimation,e),this.meshBody.setAnimationWeight(this.oldAnimation,1-e)),this.meshWeapon&&(this.meshWeapon.update(t),this.meshWeapon.setAnimationWeight(this.activeAnimation,e),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-e))},this.updateBehaviors=function(t){var e,i,o=this.controls,n=this.animations;o.crouch?(e=n.crouchMove,i=n.crouchIdle):(e=n.move,i=n.idle),o.jump&&(e=n.jump,i=n.jump),o.attack&&(o.crouch?(e=n.crouchAttack,i=n.crouchAttack):(e=n.attack,i=n.attack)),(o.moveForward||o.moveBackward||o.moveLeft||o.moveRight)&&this.activeAnimation!==e&&this.setAnimation(e),Math.abs(this.speed)<.2*this.maxSpeed&&!(o.moveLeft||o.moveRight||o.moveForward||o.moveBackward)&&this.activeAnimation!==i&&this.setAnimation(i),o.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation))),o.moveBackward&&(this.meshBody&&(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))},this.updateMovementModel=function(t){var e=this.controls;e.crouch?this.maxSpeed=this.crouchSpeed:this.maxSpeed=this.walkSpeed,this.maxReverseSpeed=-this.maxSpeed,e.moveForward&&(this.speed=THREE.Math.clamp(this.speed+t*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),e.moveBackward&&(this.speed=THREE.Math.clamp(this.speed-t*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed));var i=1;if(e.moveLeft&&(this.bodyOrientation+=t*this.angularSpeed,this.speed=THREE.Math.clamp(this.speed+i*t*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),e.moveRight&&(this.bodyOrientation-=t*this.angularSpeed,this.speed=THREE.Math.clamp(this.speed+i*t*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),!e.moveForward&&!e.moveBackward)if(this.speed>0){var n=o(this.speed/this.maxSpeed);this.speed=THREE.Math.clamp(this.speed-n*t*this.frontDecceleration,0,this.maxSpeed)}else{var n=o(this.speed/this.maxReverseSpeed);this.speed=THREE.Math.clamp(this.speed+n*t*this.backAcceleration,this.maxReverseSpeed,0)}var r=this.speed*t;this.root.position.x+=Math.sin(this.bodyOrientation)*r,this.root.position.z+=Math.cos(this.bodyOrientation)*r,this.root.rotation.y=this.bodyOrientation}},THREE.MarchingCubes=function(t,e,i,o){THREE.ImmediateRenderObject.call(this,e),this.enableUvs=void 0!==i&&i,this.enableColors=void 0!==o&&o,this.init=function(t){this.resolution=t,this.isolation=80,this.size=t,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.vlist=new Float32Array(36),this.nlist=new Float32Array(36),this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount),this.enableUvs&&(this.uvArray=new Float32Array(2*this.maxCount)),this.enableColors&&(this.colorArray=new Float32Array(3*this.maxCount))},this.lerp=function(t,e,i){return t+(e-t)*i},this.VIntX=function(t,e,i,o,n,r,s,a,l,h){var c=(n-l)/(h-l),u=this.normal_cache;e[o]=r+c*this.delta,e[o+1]=s,e[o+2]=a,i[o]=this.lerp(u[t],u[t+3],c),i[o+1]=this.lerp(u[t+1],u[t+4],c),i[o+2]=this.lerp(u[t+2],u[t+5],c)},this.VIntY=function(t,e,i,o,n,r,s,a,l,h){var c=(n-l)/(h-l),u=this.normal_cache;e[o]=r,e[o+1]=s+c*this.delta,e[o+2]=a;var d=t+3*this.yd;
i[o]=this.lerp(u[t],u[d],c),i[o+1]=this.lerp(u[t+1],u[d+1],c),i[o+2]=this.lerp(u[t+2],u[d+2],c)},this.VIntZ=function(t,e,i,o,n,r,s,a,l,h){var c=(n-l)/(h-l),u=this.normal_cache;e[o]=r,e[o+1]=s,e[o+2]=a+c*this.delta;var d=t+3*this.zd;i[o]=this.lerp(u[t],u[d],c),i[o+1]=this.lerp(u[t+1],u[d+1],c),i[o+2]=this.lerp(u[t+2],u[d+2],c)},this.compNorm=function(t){var e=3*t;0===this.normal_cache[e]&&(this.normal_cache[e]=this.field[t-1]-this.field[t+1],this.normal_cache[e+1]=this.field[t-this.yd]-this.field[t+this.yd],this.normal_cache[e+2]=this.field[t-this.zd]-this.field[t+this.zd])},this.polygonize=function(t,e,i,o,n,r){var s=o+1,a=o+this.yd,l=o+this.zd,h=s+this.yd,c=s+this.zd,u=o+this.yd+this.zd,d=s+this.yd+this.zd,p=0,f=this.field[o],m=this.field[s],v=this.field[a],g=this.field[h],E=this.field[l],y=this.field[c],T=this.field[u],b=this.field[d];f<n&&(p|=1),m<n&&(p|=2),v<n&&(p|=8),g<n&&(p|=4),E<n&&(p|=16),y<n&&(p|=32),T<n&&(p|=128),b<n&&(p|=64);var w=THREE.edgeTable[p];if(0===w)return 0;var x=this.delta,R=t+x,S=e+x,C=i+x;1&w&&(this.compNorm(o),this.compNorm(s),this.VIntX(3*o,this.vlist,this.nlist,0,n,t,e,i,f,m)),2&w&&(this.compNorm(s),this.compNorm(h),this.VIntY(3*s,this.vlist,this.nlist,3,n,R,e,i,m,g)),4&w&&(this.compNorm(a),this.compNorm(h),this.VIntX(3*a,this.vlist,this.nlist,6,n,t,S,i,v,g)),8&w&&(this.compNorm(o),this.compNorm(a),this.VIntY(3*o,this.vlist,this.nlist,9,n,t,e,i,f,v)),16&w&&(this.compNorm(l),this.compNorm(c),this.VIntX(3*l,this.vlist,this.nlist,12,n,t,e,C,E,y)),32&w&&(this.compNorm(c),this.compNorm(d),this.VIntY(3*c,this.vlist,this.nlist,15,n,R,e,C,y,b)),64&w&&(this.compNorm(u),this.compNorm(d),this.VIntX(3*u,this.vlist,this.nlist,18,n,t,S,C,T,b)),128&w&&(this.compNorm(l),this.compNorm(u),this.VIntY(3*l,this.vlist,this.nlist,21,n,t,e,C,E,T)),256&w&&(this.compNorm(o),this.compNorm(l),this.VIntZ(3*o,this.vlist,this.nlist,24,n,t,e,i,f,E)),512&w&&(this.compNorm(s),this.compNorm(c),this.VIntZ(3*s,this.vlist,this.nlist,27,n,R,e,i,m,y)),1024&w&&(this.compNorm(h),this.compNorm(d),this.VIntZ(3*h,this.vlist,this.nlist,30,n,R,S,i,g,b)),2048&w&&(this.compNorm(a),this.compNorm(u),this.VIntZ(3*a,this.vlist,this.nlist,33,n,t,S,i,v,T)),p<<=4;for(var H,M,D,A=0,I=0;THREE.triTable[p+I]!=-1;)H=p+I,M=H+1,D=H+2,this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[H],3*THREE.triTable[M],3*THREE.triTable[D],r),I+=3,A++;return A},this.posnormtriv=function(t,e,i,o,n,r){var s=3*this.count;if(this.positionArray[s]=t[i],this.positionArray[s+1]=t[i+1],this.positionArray[s+2]=t[i+2],this.positionArray[s+3]=t[o],this.positionArray[s+4]=t[o+1],this.positionArray[s+5]=t[o+2],this.positionArray[s+6]=t[n],this.positionArray[s+7]=t[n+1],this.positionArray[s+8]=t[n+2],this.normalArray[s]=e[i],this.normalArray[s+1]=e[i+1],this.normalArray[s+2]=e[i+2],this.normalArray[s+3]=e[o],this.normalArray[s+4]=e[o+1],this.normalArray[s+5]=e[o+2],this.normalArray[s+6]=e[n],this.normalArray[s+7]=e[n+1],this.normalArray[s+8]=e[n+2],this.enableUvs){var a=2*this.count;this.uvArray[a]=t[i],this.uvArray[a+1]=t[i+2],this.uvArray[a+2]=t[o],this.uvArray[a+3]=t[o+2],this.uvArray[a+4]=t[n],this.uvArray[a+5]=t[n+2]}this.enableColors&&(this.colorArray[s]=t[i],this.colorArray[s+1]=t[i+1],this.colorArray[s+2]=t[i+2],this.colorArray[s+3]=t[o],this.colorArray[s+4]=t[o+1],this.colorArray[s+5]=t[o+2],this.colorArray[s+6]=t[n],this.colorArray[s+7]=t[n+1],this.colorArray[s+8]=t[n+2]),this.count+=3,this.count>=this.maxCount-3&&(this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&(this.hasUvs=!0),this.enableColors&&(this.hasColors=!0),r(this))},this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(t){if(0!==this.count){for(var e=3*this.count;e<this.positionArray.length;e++)this.positionArray[e]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&(this.hasUvs=!0),this.enableColors&&(this.hasColors=!0),t(this)}},this.addBall=function(t,e,i,o,n){var r=this.size*Math.sqrt(o/n),s=i*this.size,a=e*this.size,l=t*this.size,h=Math.floor(s-r);h<1&&(h=1);var c=Math.floor(s+r);c>this.size-1&&(c=this.size-1);var u=Math.floor(a-r);u<1&&(u=1);var d=Math.floor(a+r);d>this.size-1&&(d=this.size-1);var p=Math.floor(l-r);p<1&&(p=1);var f=Math.floor(l+r);f>this.size-1&&(f=this.size-1);var m,v,g,E,y,T,b,w,x,R,S;for(g=h;g<c;g++)for(y=this.size2*g,w=g/this.size-i,x=w*w,v=u;v<d;v++)for(E=y+this.size*v,b=v/this.size-e,R=b*b,m=p;m<f;m++)T=m/this.size-t,S=o/(1e-6+T*T+R+x)-n,S>0&&(this.field[E+m]+=S)},this.addPlaneX=function(t,e){var i,o,n,r,s,a,l,h=this.size,c=this.yd,u=this.zd,d=this.field,p=h*Math.sqrt(t/e);for(p>h&&(p=h),i=0;i<p;i++)if(a=i/h,r=a*a,s=t/(1e-4+r)-e,s>0)for(o=0;o<h;o++)for(l=i+o*c,n=0;n<h;n++)d[u*n+l]+=s},this.addPlaneY=function(t,e){var i,o,n,r,s,a,l,h,c=this.size,u=this.yd,d=this.zd,p=this.field,f=c*Math.sqrt(t/e);for(f>c&&(f=c),o=0;o<f;o++)if(a=o/c,r=a*a,s=t/(1e-4+r)-e,s>0)for(l=o*u,i=0;i<c;i++)for(h=l+i,n=0;n<c;n++)p[d*n+h]+=s},this.addPlaneZ=function(t,e){var i,o,n,r,s,a,l,h,c=this.size,u=this.yd,d=this.zd,p=this.field,f=c*Math.sqrt(t/e);for(f>c&&(f=c),n=0;n<f;n++)if(a=n/c,r=a*a,s=t/(1e-4+r)-e,s>0)for(l=d*n,o=0;o<c;o++)for(h=l+o*u,i=0;i<c;i++)p[h+i]+=s},this.reset=function(){var t;for(t=0;t<this.size3;t++)this.normal_cache[3*t]=0,this.field[t]=0},this.render=function(t){this.begin();for(var e=this.size-2,i=1;i<e;i++)for(var o=this.size2*i,n=(i-this.halfsize)/this.halfsize,r=1;r<e;r++)for(var s=o+this.size*r,a=(r-this.halfsize)/this.halfsize,l=1;l<e;l++){var h=(l-this.halfsize)/this.halfsize,c=s+l;this.polygonize(h,a,n,c,this.isolation,t)}this.end(t)},this.generateGeometry=function(){var t=0,e=new THREE.Geometry,i=[],o=function(o){var n,r,s,a,l,h,c,u,d,p,f,m,v,g;for(n=0;n<o.count;n++)u=3*n,d=u+1,p=u+2,r=o.positionArray[u],s=o.positionArray[d],a=o.positionArray[p],l=new THREE.Vector3(r,s,a),r=o.normalArray[u],s=o.normalArray[d],a=o.normalArray[p],h=new THREE.Vector3(r,s,a),h.normalize(),e.vertices.push(l),i.push(h);for(g=o.count/3,n=0;n<g;n++)u=3*(t+n),d=u+1,p=u+2,f=i[u],m=i[d],v=i[p],c=new THREE.Face3(u,d,p,[f,m,v]),e.faces.push(c);t+=g,o.count=0};return this.render(o),e},this.init(t)},THREE.MarchingCubes.prototype=Object.create(THREE.ImmediateRenderObject.prototype),THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes,THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),THREE.ShaderLib.mirror={uniforms:{mirrorColor:{value:new THREE.Color(8355711)},mirrorSampler:{value:null},textureMatrix:{value:new THREE.Matrix4}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 mirrorCoord;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","mirrorCoord = textureMatrix * worldPosition;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 mirrorColor;","uniform sampler2D mirrorSampler;","varying vec4 mirrorCoord;","float blendOverlay(float base, float blend) {","return( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","void main() {","vec4 color = texture2DProj(mirrorSampler, mirrorCoord);","color = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);","gl_FragColor = color;","}"].join("\n")},THREE.Mirror=function(t,e,i){THREE.Object3D.call(this),this.name="mirror_"+this.id,i=i||{},this.matrixNeedsUpdate=!0;var o=void 0!==i.textureWidth?i.textureWidth:512,n=void 0!==i.textureHeight?i.textureHeight:512;this.clipBias=void 0!==i.clipBias?i.clipBias:0;var r=void 0!==i.color?new THREE.Color(i.color):new THREE.Color(8355711);this.renderer=t,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.mirrorWorldPosition=new THREE.Vector3,this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,(-1)),this.clipPlane=new THREE.Vector4;var s=void 0!==i.debugMode&&i.debugMode;if(s){var a=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),10,16777088),l=new THREE.Geometry;l.vertices.push(new THREE.Vector3((-10),(-10),0)),l.vertices.push(new THREE.Vector3(10,(-10),0)),l.vertices.push(new THREE.Vector3(10,10,0)),l.vertices.push(new THREE.Vector3((-10),10,0)),l.vertices.push(l.vertices[0]);var h=new THREE.Line(l,new THREE.LineBasicMaterial({color:16777088}));this.add(a),this.add(h)}e instanceof THREE.PerspectiveCamera?this.camera=e:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.mirrorCamera.matrixAutoUpdate=!0;var c={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};this.renderTarget=new THREE.WebGLRenderTarget(o,n,c),this.renderTarget2=new THREE.WebGLRenderTarget(o,n,c);var u=THREE.ShaderLib.mirror,d=THREE.UniformsUtils.clone(u.uniforms);this.material=new THREE.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:d}),this.material.uniforms.mirrorSampler.value=this.renderTarget.texture,this.material.uniforms.mirrorColor.value=r,this.material.uniforms.textureMatrix.value=this.textureMatrix,THREE.Math.isPowerOfTwo(o)&&THREE.Math.isPowerOfTwo(n)||(this.renderTarget.texture.generateMipmaps=!1,this.renderTarget2.texture.generateMipmaps=!1),this.updateTextureMatrix(),this.render()},THREE.Mirror.prototype=Object.create(THREE.Object3D.prototype),THREE.Mirror.prototype.constructor=THREE.Mirror,THREE.Mirror.prototype.renderWithMirror=function(t){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var e=t.camera;t.camera=this.mirrorCamera,t.renderTemp(),t.material.uniforms.mirrorSampler.value=t.renderTarget2.texture,this.render(),this.matrixNeedsUpdate=!0,t.material.uniforms.mirrorSampler.value=t.renderTarget.texture,t.camera=e,t.updateTextureMatrix()},THREE.Mirror.prototype.updateTextureMatrix=function(){this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix);var t=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition);t.reflect(this.normal).negate(),t.add(this.mirrorWorldPosition),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var e=this.mirrorWorldPosition.clone().sub(this.lookAtPosition);e.reflect(this.normal).negate(),e.add(this.mirrorWorldPosition),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(t),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(e),this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var i=new THREE.Vector4,o=this.mirrorCamera.projectionMatrix;i.x=(Math.sign(this.clipPlane.x)+o.elements[8])/o.elements[0],i.y=(Math.sign(this.clipPlane.y)+o.elements[9])/o.elements[5],i.z=-1,i.w=(1+o.elements[10])/o.elements[14];var n=new THREE.Vector4;n=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(i)),o.elements[2]=n.x,o.elements[6]=n.y,o.elements[10]=n.z+1-this.clipBias,o.elements[14]=n.w},THREE.Mirror.prototype.render=function(){this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0;for(var t=this;null!==t.parent;)t=t.parent;if(void 0!==t&&t instanceof THREE.Scene){var e=this.material.visible;this.material.visible=!1,this.renderer.render(t,this.mirrorCamera,this.renderTarget,!0),this.material.visible=e}},THREE.Mirror.prototype.renderTemp=function(){this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0;for(var t=this;null!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&this.renderer.render(t,this.mirrorCamera,this.renderTarget2,!0)},THREE.MorphAnimMesh=function(t,e){THREE.Mesh.call(this,t,e),this.type="MorphAnimMesh",this.mixer=new THREE.AnimationMixer(this),this.activeAction=null},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh,THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.mixer.timeScale=1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1},THREE.MorphAnimMesh.prototype.playAnimation=function(t,e){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var i=THREE.AnimationClip.findByName(this,t);if(!i)throw new Error("THREE.MorphAnimMesh: animations["+t+"] undefined in .playAnimation()");var o=this.mixer.clipAction(i);o.timeScale=i.tracks.length*e/i.duration,this.activeAction=o.play()},THREE.MorphAnimMesh.prototype.updateAnimation=function(t){this.mixer.update(t)},THREE.MorphAnimMesh.prototype.copy=function(t){return THREE.Mesh.prototype.copy.call(this,t),this.mixer=new THREE.AnimationMixer(this),this},THREE.MorphAnimation=function(t){this.mesh=t,this.frames=t.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},THREE.MorphAnimation.prototype={constructor:THREE.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(t){if(this.isPlaying!==!1){this.currentTime+=t,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var e=this.duration/this.frames,i=Math.floor(this.currentTime/e),o=this.mesh.morphTargetInfluences;i!==this.currentFrame&&(o[this.lastFrame]=0,o[this.currentFrame]=1,o[i]=0,this.lastFrame=this.currentFrame,this.currentFrame=i);var n=this.currentTime%e/e;o[i]=n,o[this.lastFrame]=1-n}}},THREE.Ocean=function(t,e,i,o){function n(t,e){return void 0!==t?t:e}this.changed=!0,this.initial=!0,this.oceanCamera=new THREE.OrthographicCamera,this.oceanCamera.position.z=1,this.renderer=t,this.renderer.clearColor(16777215),this.scene=new THREE.Scene,o=o||{},this.clearColor=n(o.CLEAR_COLOR,[1,1,1,0]),this.geometryOrigin=n(o.GEOMETRY_ORIGIN,[-1e3,-1e3]),this.sunDirectionX=n(o.SUN_DIRECTION[0],-1),this.sunDirectionY=n(o.SUN_DIRECTION[1],1),this.sunDirectionZ=n(o.SUN_DIRECTION[2],1),this.oceanColor=n(o.OCEAN_COLOR,new THREE.Vector3(.004,.016,.047)),this.skyColor=n(o.SKY_COLOR,new THREE.Vector3(3.2,9.6,12.8)),this.exposure=n(o.EXPOSURE,.35),this.geometryResolution=n(o.GEOMETRY_RESOLUTION,32),this.geometrySize=n(o.GEOMETRY_SIZE,2e3),this.resolution=n(o.RESOLUTION,64),this.floatSize=n(o.SIZE_OF_FLOAT,4),this.windX=n(o.INITIAL_WIND[0],10),this.windY=n(o.INITIAL_WIND[1],10),this.size=n(o.INITIAL_SIZE,250),this.choppiness=n(o.INITIAL_CHOPPINESS,1.5),this.matrixNeedsUpdate=!1;var r=n(o.USE_HALF_FLOAT,!1)?THREE.HalfFloatType:THREE.FloatType,s={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,wrapS:THREE.ClampToEdgeWrapping,wrapT:THREE.ClampToEdgeWrapping,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:r},a={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,wrapS:THREE.ClampToEdgeWrapping,wrapT:THREE.ClampToEdgeWrapping,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:r},l={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,wrapS:THREE.RepeatWrapping,wrapT:THREE.RepeatWrapping,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:r};this.initialSpectrumFramebuffer=new THREE.WebGLRenderTarget(this.resolution,this.resolution,l),this.spectrumFramebuffer=new THREE.WebGLRenderTarget(this.resolution,this.resolution,a),this.pingPhaseFramebuffer=new THREE.WebGLRenderTarget(this.resolution,this.resolution,a),this.pongPhaseFramebuffer=new THREE.WebGLRenderTarget(this.resolution,this.resolution,a),this.pingTransformFramebuffer=new THREE.WebGLRenderTarget(this.resolution,this.resolution,a),this.pongTransformFramebuffer=new THREE.WebGLRenderTarget(this.resolution,this.resolution,a),this.displacementMapFramebuffer=new THREE.WebGLRenderTarget(this.resolution,this.resolution,s),this.normalMapFramebuffer=new THREE.WebGLRenderTarget(this.resolution,this.resolution,s);var h=THREE.ShaderLib.ocean_sim_vertex,c=THREE.ShaderLib.ocean_subtransform,u=THREE.UniformsUtils.clone(c.uniforms);this.materialOceanHorizontal=new THREE.ShaderMaterial({uniforms:u,vertexShader:h.vertexShader,fragmentShader:"#define HORIZONTAL \n"+c.fragmentShader}),this.materialOceanHorizontal.uniforms.u_transformSize={value:this.resolution},this.materialOceanHorizontal.uniforms.u_subtransformSize={value:null},this.materialOceanHorizontal.uniforms.u_input={value:null},this.materialOceanHorizontal.depthTest=!1;var d=THREE.ShaderLib.ocean_subtransform,p=THREE.UniformsUtils.clone(d.uniforms);this.materialOceanVertical=new THREE.ShaderMaterial({uniforms:p,vertexShader:h.vertexShader,fragmentShader:d.fragmentShader}),this.materialOceanVertical.uniforms.u_transformSize={value:this.resolution},this.materialOceanVertical.uniforms.u_subtransformSize={value:null},this.materialOceanVertical.uniforms.u_input={value:null},this.materialOceanVertical.depthTest=!1;var f=THREE.ShaderLib.ocean_initial_spectrum,m=THREE.UniformsUtils.clone(f.uniforms);this.materialInitialSpectrum=new THREE.ShaderMaterial({uniforms:m,vertexShader:h.vertexShader,fragmentShader:f.fragmentShader}),this.materialInitialSpectrum.uniforms.u_wind={value:new THREE.Vector2},this.materialInitialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialInitialSpectrum.depthTest=!1;var v=THREE.ShaderLib.ocean_phase,g=THREE.UniformsUtils.clone(v.uniforms);this.materialPhase=new THREE.ShaderMaterial({uniforms:g,vertexShader:h.vertexShader,fragmentShader:v.fragmentShader}),this.materialPhase.uniforms.u_resolution={value:this.resolution},this.materialPhase.depthTest=!1;var E=THREE.ShaderLib.ocean_spectrum,y=THREE.UniformsUtils.clone(E.uniforms);this.materialSpectrum=new THREE.ShaderMaterial({uniforms:y,vertexShader:h.vertexShader,fragmentShader:E.fragmentShader}),this.materialSpectrum.uniforms.u_initialSpectrum={value:null},this.materialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialSpectrum.depthTest=!1;var T=THREE.ShaderLib.ocean_normals,b=THREE.UniformsUtils.clone(T.uniforms);this.materialNormal=new THREE.ShaderMaterial({uniforms:b,vertexShader:h.vertexShader,fragmentShader:T.fragmentShader}),this.materialNormal.uniforms.u_displacementMap={value:null},this.materialNormal.uniforms.u_resolution={value:this.resolution},this.materialNormal.depthTest=!1;var w=THREE.ShaderLib.ocean_main,x=THREE.UniformsUtils.clone(w.uniforms);this.materialOcean=new THREE.ShaderMaterial({uniforms:x,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader}),this.materialOcean.uniforms.u_geometrySize={value:this.resolution},this.materialOcean.uniforms.u_displacementMap={value:this.displacementMapFramebuffer.texture},this.materialOcean.uniforms.u_normalMap={value:this.normalMapFramebuffer.texture},this.materialOcean.uniforms.u_oceanColor={value:this.oceanColor},this.materialOcean.uniforms.u_skyColor={value:this.skyColor},this.materialOcean.uniforms.u_sunDirection={value:new THREE.Vector3(this.sunDirectionX,this.sunDirectionY,this.sunDirectionZ)},this.materialOcean.uniforms.u_exposure={value:this.exposure},this.materialOceanHorizontal.blending=0,this.materialOceanVertical.blending=0,this.materialInitialSpectrum.blending=0,this.materialPhase.blending=0,this.materialSpectrum.blending=0,this.materialNormal.blending=0,this.materialOcean.blending=0,this.screenQuad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2)),this.scene.add(this.screenQuad),this.generateSeedPhaseTexture(),this.generateMesh()},THREE.Ocean.prototype.generateMesh=function(){var t=new THREE.PlaneBufferGeometry(this.geometrySize,this.geometrySize,this.geometryResolution,this.geometryResolution);t.rotateX(-Math.PI/2),this.oceanMesh=new THREE.Mesh(t,this.materialOcean);
},THREE.Ocean.prototype.render=function(){this.scene.overrideMaterial=null,this.changed&&this.renderInitialSpectrum(),this.renderWavePhase(),this.renderSpectrum(),this.renderSpectrumFFT(),this.renderNormalMap(),this.scene.overrideMaterial=null},THREE.Ocean.prototype.generateSeedPhaseTexture=function(){this.pingPhase=!0;for(var t=new window.Float32Array(this.resolution*this.resolution*4),e=0;e<this.resolution;e++)for(var i=0;i<this.resolution;i++)t[e*this.resolution*4+4*i]=2*Math.random()*Math.PI,t[e*this.resolution*4+4*i+1]=0,t[e*this.resolution*4+4*i+2]=0,t[e*this.resolution*4+4*i+3]=0;this.pingPhaseTexture=new THREE.DataTexture(t,this.resolution,this.resolution,THREE.RGBAFormat),this.pingPhaseTexture.wrapS=THREE.ClampToEdgeWrapping,this.pingPhaseTexture.wrapT=THREE.ClampToEdgeWrapping,this.pingPhaseTexture.type=THREE.FloatType,this.pingPhaseTexture.needsUpdate=!0},THREE.Ocean.prototype.renderInitialSpectrum=function(){this.scene.overrideMaterial=this.materialInitialSpectrum,this.materialInitialSpectrum.uniforms.u_wind.value.set(this.windX,this.windY),this.materialInitialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.initialSpectrumFramebuffer,!0)},THREE.Ocean.prototype.renderWavePhase=function(){this.scene.overrideMaterial=this.materialPhase,this.screenQuad.material=this.materialPhase,this.initial?(this.materialPhase.uniforms.u_phases.value=this.pingPhaseTexture,this.initial=!1):this.materialPhase.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialPhase.uniforms.u_deltaTime.value=this.deltaTime,this.materialPhase.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.pingPhase?this.pongPhaseFramebuffer:this.pingPhaseFramebuffer),this.pingPhase=!this.pingPhase},THREE.Ocean.prototype.renderSpectrum=function(){this.scene.overrideMaterial=this.materialSpectrum,this.materialSpectrum.uniforms.u_initialSpectrum.value=this.initialSpectrumFramebuffer.texture,this.materialSpectrum.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialSpectrum.uniforms.u_choppiness.value=this.choppiness,this.materialSpectrum.uniforms.u_size.value=this.size,this.renderer.render(this.scene,this.oceanCamera,this.spectrumFramebuffer)},THREE.Ocean.prototype.renderSpectrumFFT=function(){var t=Math.log(this.resolution)/Math.log(2);this.scene.overrideMaterial=this.materialOceanHorizontal;for(var e=0;e<t;e++)0===e?(this.materialOceanHorizontal.uniforms.u_input.value=this.spectrumFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer)):e%2===1?(this.materialOceanHorizontal.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanHorizontal.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer));this.scene.overrideMaterial=this.materialOceanVertical;for(var e=t;e<2*t;e++)e===2*t-1?(this.materialOceanVertical.uniforms.u_input.value=t%2===0?this.pingTransformFramebuffer.texture:this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.displacementMapFramebuffer)):e%2===1?(this.materialOceanVertical.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pongTransformFramebuffer)):(this.materialOceanVertical.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,e%t+1),this.renderer.render(this.scene,this.oceanCamera,this.pingTransformFramebuffer))},THREE.Ocean.prototype.renderNormalMap=function(){this.scene.overrideMaterial=this.materialNormal,this.changed&&(this.materialNormal.uniforms.u_size.value=this.size),this.materialNormal.uniforms.u_displacementMap.value=this.displacementMapFramebuffer.texture,this.renderer.render(this.scene,this.oceanCamera,this.normalMapFramebuffer,!0)},function(t){"use strict";function e(t){return!isNaN(t)&&isFinite(t)}function i(t){return"[object Array]"===Object.prototype.toString.call(t)}function o(t){return t?i(t)!==!0?[t]:t:[]}function n(t,e){for(var i=0,o=t.length;i<o;i++)if(t[i]===e)return i;return-1}function r(t,e,i){for(var o=0,n=t.length;o<n;o++)if(t[o][e]===i)return o;return-1}t.Octree=function(i){i=i||{},i.tree=this,this.nodeCount=0,this.INDEX_INSIDE_CROSS=-1,this.INDEX_OUTSIDE_OFFSET=2,this.INDEX_OUTSIDE_POS_X=e(i.INDEX_OUTSIDE_POS_X)?i.INDEX_OUTSIDE_POS_X:0,this.INDEX_OUTSIDE_NEG_X=e(i.INDEX_OUTSIDE_NEG_X)?i.INDEX_OUTSIDE_NEG_X:1,this.INDEX_OUTSIDE_POS_Y=e(i.INDEX_OUTSIDE_POS_Y)?i.INDEX_OUTSIDE_POS_Y:2,this.INDEX_OUTSIDE_NEG_Y=e(i.INDEX_OUTSIDE_NEG_Y)?i.INDEX_OUTSIDE_NEG_Y:3,this.INDEX_OUTSIDE_POS_Z=e(i.INDEX_OUTSIDE_POS_Z)?i.INDEX_OUTSIDE_POS_Z:4,this.INDEX_OUTSIDE_NEG_Z=e(i.INDEX_OUTSIDE_NEG_Z)?i.INDEX_OUTSIDE_NEG_Z:5,this.INDEX_OUTSIDE_MAP=[],this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1},this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1,this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1,this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1,this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1,this.FLAG_POS_Z=1<<this.INDEX_OUTSIDE_POS_Z+1,this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1,this.utilVec31Search=new t.Vector3,this.utilVec32Search=new t.Vector3,this.scene=i.scene,this.scene&&(this.visualGeometry=new t.BoxGeometry(1,1,1),this.visualMaterial=new t.MeshBasicMaterial({color:16711782,wireframe:!0,wireframeLinewidth:1})),this.objects=[],this.objectsMap={},this.objectsData=[],this.objectsDeferred=[],this.depthMax=e(i.depthMax)?i.depthMax:1/0,this.objectsThreshold=e(i.objectsThreshold)?i.objectsThreshold:8,this.overlapPct=e(i.overlapPct)?i.overlapPct:.15,this.undeferred=i.undeferred||!1,this.root=i.root instanceof t.OctreeNode?i.root:new t.OctreeNode(i)},t.Octree.prototype={update:function(){if(this.objectsDeferred.length>0){for(var t=0,e=this.objectsDeferred.length;t<e;t++){var i=this.objectsDeferred[t];this.addDeferred(i.object,i.options)}this.objectsDeferred.length=0}},add:function(t,e){this.undeferred?(this.updateObject(t),this.addDeferred(t,e)):this.objectsDeferred.push({object:t,options:e})},addDeferred:function(e,i){var o,n,r,s,a,l,h;if(e instanceof t.OctreeObjectData&&(e=e.object),e.uuid||(e.uuid=t.Math.generateUUID()),!this.objectsMap[e.uuid])if(this.objects.push(e),this.objectsMap[e.uuid]=e,i&&(a=i.useFaces,h=i.useVertices),h===!0)for(r=e.geometry,l=r.vertices,o=0,n=l.length;o<n;o++)this.addObjectData(e,l[o]);else if(a===!0)for(r=e.geometry,s=r.faces,o=0,n=s.length;o<n;o++)this.addObjectData(e,s[o]);else this.addObjectData(e)},addObjectData:function(e,i){var o=new t.OctreeObjectData(e,i);this.objectsData.push(o),this.root.addObject(o)},remove:function(e){var i,o,s,a,l=e;if(e instanceof t.OctreeObjectData&&(e=e.object),this.objectsMap[e.uuid]){if(this.objectsMap[e.uuid]=void 0,s=n(this.objects,e),s!==-1)for(this.objects.splice(s,1),a=this.root.removeObject(l),i=0,o=a.length;i<o;i++)l=a[i],s=n(this.objectsData,l),s!==-1&&this.objectsData.splice(s,1)}else this.objectsDeferred.length>0&&(s=r(this.objectsDeferred,"object",e),s!==-1&&this.objectsDeferred.splice(s,1))},extend:function(e){var i,o,n,r;if(e instanceof t.Octree)for(n=e.objectsData,i=0,o=n.length;i<o;i++)r=n[i],this.add(r,{useFaces:r.faces,useVertices:r.vertices})},rebuild:function(){var e,i,o,n,r,s,a=[];for(e=0,i=this.objectsData.length;e<i;e++)n=this.objectsData[e],o=n.node,n.update(),o instanceof t.OctreeNode&&!n.positionLast.equals(n.position)&&(s=n.indexOctant,r=o.getOctantIndex(n),r!==s&&a.push(n));for(e=0,i=a.length;e<i;e++)n=a[e],n.node.removeObject(n),this.root.addObject(n)},updateObject:function(t){var e,i,o,n,r=[t];for(o=t.parent;o;)r.push(o),o=o.parent;for(e=0,i=r.length;e<i;e++)o=r[e],o.matrixWorldNeedsUpdate===!0&&(n=o);"undefined"!=typeof n&&n.updateMatrixWorld()},search:function(e,i,o,r){var s,a,l,h,c,u,d,p,f,m,v;for(h=[].concat(this.root.objects),i>0||(i=Number.MAX_VALUE),r instanceof t.Vector3&&(r=this.utilVec31Search.copy(r).normalize(),v=this.utilVec32Search.set(1,1,1).divide(r)),s=0,a=this.root.nodesIndices.length;s<a;s++)l=this.root.nodesByIndex[this.root.nodesIndices[s]],h=l.search(e,i,h,r,v);if(o===!0)for(d=[],f=[],s=0,a=h.length;s<a;s++)c=h[s],u=c.object,m=n(f,u),m===-1?(p={object:u,faces:[],vertices:[]},d.push(p),f.push(u)):p=d[m],c.faces?p.faces.push(c.faces):c.vertices&&p.vertices.push(c.vertices);else d=h;return d},setRoot:function(e){e instanceof t.OctreeNode&&(this.root=e,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}},t.OctreeObjectData=function(e,i){this.object=e,i instanceof t.Face3?(this.faces=i,this.face3=!0,this.utilVec31FaceBounds=new t.Vector3):i instanceof t.Vector3&&(this.vertices=i),this.radius=0,this.position=new t.Vector3,this.object instanceof t.Object3D&&this.update(),this.positionLast=this.position.clone()},t.OctreeObjectData.prototype={update:function(){this.face3?(this.radius=this.getFace3BoundingRadius(this.object,this.faces),this.position.copy(this.faces.centroid).applyMatrix4(this.object.matrixWorld)):this.vertices?(this.radius=this.object.material.size||1,this.position.copy(this.vertices).applyMatrix4(this.object.matrixWorld)):this.object.geometry?(null===this.object.geometry.boundingSphere&&this.object.geometry.computeBoundingSphere(),this.radius=this.object.geometry.boundingSphere.radius,this.position.copy(this.object.geometry.boundingSphere.center).applyMatrix4(this.object.matrixWorld)):(this.radius=this.object.boundRadius,this.position.setFromMatrixPosition(this.object.matrixWorld)),this.radius=this.radius*Math.max(this.object.scale.x,this.object.scale.y,this.object.scale.z)},getFace3BoundingRadius:function(e,i){void 0===i.centroid&&(i.centroid=new t.Vector3);var o,n=e.geometry||e,r=n.vertices,s=i.centroid,a=r[i.a],l=r[i.b],h=r[i.c],c=this.utilVec31FaceBounds;return s.addVectors(a,l).add(h).divideScalar(3),o=Math.max(c.subVectors(s,a).length(),c.subVectors(s,l).length(),c.subVectors(s,h).length())}},t.OctreeNode=function(e){this.utilVec31Branch=new t.Vector3,this.utilVec31Expand=new t.Vector3,this.utilVec31Ray=new t.Vector3,e=e||{},e.tree instanceof t.Octree?this.tree=e.tree:e.parent instanceof t.OctreeNode!=!0&&(e.root=this,this.tree=new t.Octree(e)),this.id=this.tree.nodeCount++,this.position=e.position instanceof t.Vector3?e.position:new t.Vector3,this.radius=e.radius>0?e.radius:1,this.indexOctant=e.indexOctant,this.depth=0,this.reset(),this.setParent(e.parent),this.overlap=this.radius*this.tree.overlapPct,this.radiusOverlap=this.radius+this.overlap,this.left=this.position.x-this.radiusOverlap,this.right=this.position.x+this.radiusOverlap,this.bottom=this.position.y-this.radiusOverlap,this.top=this.position.y+this.radiusOverlap,this.back=this.position.z-this.radiusOverlap,this.front=this.position.z+this.radiusOverlap,this.tree.scene&&(this.visual=new t.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual))},t.OctreeNode.prototype={setParent:function(t){t!==this&&this.parent!==t&&(this.parent=t,this.updateProperties())},updateProperties:function(){var e,i;for(this.parent instanceof t.OctreeNode?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0,e=0,i=this.nodesIndices.length;e<i;e++)this.nodesByIndex[this.nodesIndices[e]].updateProperties()},reset:function(t,e){var i,o,n,r=this.nodesIndices||[],s=this.nodesByIndex;for(this.objects=[],this.nodesIndices=[],this.nodesByIndex={},i=0,o=r.length;i<o;i++)n=s[r[i]],n.setParent(void 0),t===!0&&n.reset(t,e);e===!0&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},addNode:function(t,e){t.indexOctant=e,n(this.nodesIndices,e)===-1&&this.nodesIndices.push(e),this.nodesByIndex[e]=t,t.parent!==this&&t.setParent(this)},removeNode:function(t){var e,i;e=n(this.nodesIndices,t),this.nodesIndices.splice(e,1),i=i||this.nodesByIndex[t],delete this.nodesByIndex[t],i.parent===this&&i.setParent(void 0)},addObject:function(e){var i,o,r;o=this.getOctantIndex(e),o>-1&&this.nodesIndices.length>0?(r=this.branch(o),r.addObject(e)):o<-1&&this.parent instanceof t.OctreeNode?this.parent.addObject(e):(i=n(this.objects,e),i===-1&&this.objects.push(e),e.node=this,this.checkGrow())},addObjectWithoutCheck:function(t){var e,i,o;for(e=0,i=t.length;e<i;e++)o=t[e],this.objects.push(o),o.node=this},removeObject:function(t){var e,i,o,n;if(n=this.removeObjectRecursive(t,{searchComplete:!1,nodesRemovedFrom:[],objectsDataRemoved:[]}),o=n.nodesRemovedFrom,o.length>0)for(e=0,i=o.length;e<i;e++)o[e].shrink();return n.objectsDataRemoved},removeObjectRecursive:function(e,i){var o,r,s,a,l,h=-1;if(e instanceof t.OctreeObjectData)h=n(this.objects,e),h!==-1&&(this.objects.splice(h,1),e.node=void 0,i.objectsDataRemoved.push(e),i.searchComplete=l=!0);else for(o=this.objects.length-1;o>=0;o--)if(s=this.objects[o],s.object===e&&(this.objects.splice(o,1),s.node=void 0,i.objectsDataRemoved.push(s),l=!0,!s.faces&&!s.vertices)){i.searchComplete=!0;break}if(l===!0&&i.nodesRemovedFrom.push(this),i.searchComplete!==!0)for(o=0,r=this.nodesIndices.length;o<r&&(a=this.nodesByIndex[this.nodesIndices[o]],i=a.removeObjectRecursive(e,i),i.searchComplete!==!0);o++);return i},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&this.tree.objectsThreshold>0&&this.grow()},grow:function(){var t,e,i,o,n=[],r=[],s=[],a=[],l=[];for(i=0,o=this.objects.length;i<o;i++)e=this.objects[i],t=this.getOctantIndex(e),t>-1?(s.push(e),a.push(t)):t<-1?(n.push(e),r.push(t)):l.push(e);s.length>0&&(l=l.concat(this.split(s,a))),n.length>0&&(l=l.concat(this.expand(n,r))),this.objects=l,this.checkMerge()},split:function(t,e){var i,o,n,r,s,a;if(this.depth<this.tree.depthMax){for(t=t||this.objects,e=e||[],a=[],i=0,o=t.length;i<o;i++)r=t[i],n=e[i],n>-1?(s=this.branch(n),s.addObject(r)):a.push(r);t===this.objects&&(this.objects=a)}else a=this.objects;return a},branch:function(e){var i,o,n,r,s,a;return this.nodesByIndex[e]instanceof t.OctreeNode?i=this.nodesByIndex[e]:(n=.5*this.radiusOverlap,o=n*this.tree.overlapPct,r=n-o,s=this.utilVec31Branch.set(1&e?r:-r,2&e?r:-r,4&e?r:-r),a=(new t.Vector3).addVectors(this.position,s),i=new t.OctreeNode({tree:this.tree,parent:this,position:a,radius:n,indexOctant:e}),this.addNode(i,e)),i},expand:function(e,i){var o,n,r,s,a,l,h,c,u,d,p,f,m,v,g,E,y,T,b,w,x,R,S,C,H,M,D,A,I,_=this.tree.INDEX_OUTSIDE_MAP,O=this.utilVec31Expand;if(this.tree.root.getDepthEnd()<this.tree.depthMax){for(e=e||this.objects,i=i||[],s=[],a=[],o=0,n=_.length;o<n;o++)_[o].count=0;for(o=0,n=e.length;o<n;o++)r=e[o],l=i[o],l<-1?(h=-l-this.tree.INDEX_OUTSIDE_OFFSET,h&this.tree.FLAG_POS_X?_[this.tree.INDEX_OUTSIDE_POS_X].count++:h&this.tree.FLAG_NEG_X&&_[this.tree.INDEX_OUTSIDE_NEG_X].count++,h&this.tree.FLAG_POS_Y?_[this.tree.INDEX_OUTSIDE_POS_Y].count++:h&this.tree.FLAG_NEG_Y&&_[this.tree.INDEX_OUTSIDE_NEG_Y].count++,h&this.tree.FLAG_POS_Z?_[this.tree.INDEX_OUTSIDE_POS_Z].count++:h&this.tree.FLAG_NEG_Z&&_[this.tree.INDEX_OUTSIDE_NEG_Z].count++,a.push(r)):s.push(r);if(a.length>0)for(u=_.slice(0),u.sort(function(t,e){return e.count-t.count}),d=u[0],m=1|d.index,g=u[1],E=u[2],p=(1|g.index)!==m?g:E,v=1|p.index,g=u[2],E=u[3],y=u[4],T=1|g.index,b=1|E.index,f=T!==m&&T!==v?g:b!==m&&b!==v?E:y,w=d.x+p.x+f.x,x=d.y+p.y+f.y,R=d.z+p.z+f.z,l=this.getOctantIndexFromPosition(w,x,R),c=this.getOctantIndexFromPosition(-w,-x,-R),S=this.overlap,C=this.radius,M=this.tree.overlapPct>0?S/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*C,D=M*this.tree.overlapPct,H=M+D-(C+S),O.set(1&l?H:-H,2&l?H:-H,4&l?H:-H),A=(new t.Vector3).addVectors(this.position,O),I=new t.OctreeNode({tree:this.tree,position:A,radius:M}),I.addNode(this,c),this.tree.setRoot(I),o=0,n=a.length;o<n;o++)this.tree.root.addObject(a[o]);e===this.objects&&(this.objects=s)}else s=e;return s},shrink:function(){this.checkMerge(),this.tree.root.checkContract()},checkMerge:function(){for(var e,i=this;i.parent instanceof t.OctreeNode&&i.getObjectCountEnd()<this.tree.objectsThreshold;)e=i,i=i.parent;i!==this&&i.merge(e)},merge:function(t){var e,i,n;for(t=o(t),e=0,i=t.length;e<i;e++)n=t[e],this.addObjectWithoutCheck(n.getObjectsEnd()),n.reset(!0,!0),this.removeNode(n.indexOctant,n);this.checkMerge()},checkContract:function(){var e,i,o,n,r,s,a;if(this.nodesIndices.length>0){for(s=0,a=this.objects.length,e=0,i=this.nodesIndices.length;e<i;e++)o=this.nodesByIndex[this.nodesIndices[e]],n=o.getObjectCountEnd(),a+=n,(r instanceof t.OctreeNode==!1||n>s)&&(r=o,s=n);a-=s,a<this.tree.objectsThreshold&&r instanceof t.OctreeNode&&this.contract(r)}},contract:function(t){var e,i,o;for(e=0,i=this.nodesIndices.length;e<i;e++)o=this.nodesByIndex[this.nodesIndices[e]],o!==t&&(t.addObjectWithoutCheck(o.getObjectsEnd()),o.reset(!0,!0));t.addObjectWithoutCheck(this.objects),this.reset(!1,!0),this.tree.setRoot(t),t.checkContract()},getOctantIndex:function(e){var i,o,n,r,s,a,l,h,c,u=this.position,d=this.radiusOverlap,p=this.overlap,f=0;if(e instanceof t.OctreeObjectData?(o=e.radius,i=e.position,e.positionLast.copy(i)):e instanceof t.OctreeNode&&(i=e.position,o=0),n=i.x-u.x,r=i.y-u.y,s=i.z-u.z,a=Math.abs(n),l=Math.abs(r),h=Math.abs(s),c=Math.max(a,l,h),c+o>d)return a+o>d&&(f^=n>0?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),l+o>d&&(f^=r>0?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),h+o>d&&(f^=s>0?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),e.indexOctant=-f-this.tree.INDEX_OUTSIDE_OFFSET,e.indexOctant;if(n-o>-p)f=1|f;else if(!(n+o<p))return e.indexOctant=this.tree.INDEX_INSIDE_CROSS,e.indexOctant;if(r-o>-p)f=2|f;else if(!(r+o<p))return e.indexOctant=this.tree.INDEX_INSIDE_CROSS,e.indexOctant;if(s-o>-p)f=4|f;else if(!(s+o<p))return e.indexOctant=this.tree.INDEX_INSIDE_CROSS,e.indexOctant;return e.indexOctant=f,e.indexOctant},getOctantIndexFromPosition:function(t,e,i){var o=0;return t>0&&(o=1|o),e>0&&(o=2|o),i>0&&(o=4|o),o},search:function(t,e,i,o,n){var r,s,a,l;if(l=o?this.intersectRay(t,o,e,n):this.intersectSphere(t,e),l===!0)for(i=i.concat(this.objects),r=0,s=this.nodesIndices.length;r<s;r++)a=this.nodesByIndex[this.nodesIndices[r]],i=a.search(t,e,i,o);return i},intersectSphere:function(t,e){var i=e*e,o=t.x,n=t.y,r=t.z;return o<this.left?i-=Math.pow(o-this.left,2):o>this.right&&(i-=Math.pow(o-this.right,2)),n<this.bottom?i-=Math.pow(n-this.bottom,2):n>this.top&&(i-=Math.pow(n-this.top,2)),r<this.back?i-=Math.pow(r-this.back,2):r>this.front&&(i-=Math.pow(r-this.front,2)),i>=0},intersectRay:function(t,e,i,o){"undefined"==typeof o&&(o=this.utilVec31Ray.set(1,1,1).divide(e));var n,r=(this.left-t.x)*o.x,s=(this.right-t.x)*o.x,a=(this.bottom-t.y)*o.y,l=(this.top-t.y)*o.y,h=(this.back-t.z)*o.z,c=(this.front-t.z)*o.z,u=Math.min(Math.min(Math.max(r,s),Math.max(a,l)),Math.max(h,c));return!(u<0)&&(n=Math.max(Math.max(Math.min(r,s),Math.min(a,l)),Math.min(h,c)),!(n>u||n>i))},getDepthEnd:function(t){var e,i,o;if(this.nodesIndices.length>0)for(e=0,i=this.nodesIndices.length;e<i;e++)o=this.nodesByIndex[this.nodesIndices[e]],t=o.getDepthEnd(t);else t=!t||this.depth>t?this.depth:t;return t},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var t,e,i=this.nodesIndices.length;for(t=0,e=this.nodesIndices.length;t<e;t++)i+=this.nodesByIndex[this.nodesIndices[t]].getNodeCountRecursive();return i},getObjectsEnd:function(t){var e,i,o;for(t=(t||[]).concat(this.objects),e=0,i=this.nodesIndices.length;e<i;e++)o=this.nodesByIndex[this.nodesIndices[e]],t=o.getObjectsEnd(t);return t},getObjectCountEnd:function(){var t,e,i=this.objects.length;for(t=0,e=this.nodesIndices.length;t<e;t++)i+=this.nodesByIndex[this.nodesIndices[t]].getObjectCountEnd();return i},getObjectCountStart:function(){for(var e=this.objects.length,i=this.parent;i instanceof t.OctreeNode;)e+=i.objects.length,i=i.parent;return e},toConsole:function(t){var e,i,o,n="   ";for(t="string"==typeof t?t:n,console.log(this.parent?t+" octree NODE > ":" octree ROOT > ",this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth),console.log(this.parent?t+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects),console.log(this.parent?t+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex),e=0,i=this.nodesIndices.length;e<i;e++)o=this.nodesByIndex[this.nodesIndices[e]],o.toConsole(t+n)}},t.Raycaster.prototype.intersectOctreeObject=function(e,i){var o,n,r,s;return e.object instanceof t.Object3D?(n=e,e=n.object,s=n.faces,r=e.geometry.faces,s.length>0&&(e.geometry.faces=s),o=this.intersectObject(e,i),s.length>0&&(e.geometry.faces=r)):o=this.intersectObject(e,i),o},t.Raycaster.prototype.intersectOctreeObjects=function(t,e){var i,o,n=[];for(i=0,o=t.length;i<o;i++)n=n.concat(this.intersectOctreeObject(t[i],e));return n}}(THREE);var PRNG=function(){this.seed=1,this.next=function(){return this.gen()/2147483647},this.nextRange=function(t,e){return t+(e-t)*this.next()},this.gen=function(){return this.seed=16807*this.seed%2147483647}};THREE.ParametricGeometries={klein:function(t,e){e*=Math.PI,t*=2*Math.PI,e=2*e;var i,o,n;return e<Math.PI?(i=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(e)*Math.cos(t),n=-8*Math.sin(e)-2*(1-Math.cos(e)/2)*Math.sin(e)*Math.cos(t)):(i=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(t+Math.PI),n=-8*Math.sin(e)),o=-2*(1-Math.cos(e)/2)*Math.sin(t),new THREE.Vector3(i,o,n)},plane:function(t,e){return function(i,o){var n=i*t,r=0,s=o*e;return new THREE.Vector3(n,r,s)}},mobius:function(t,e){t-=.5;var i,o,n,r=2*Math.PI*e,s=2;return i=Math.cos(r)*(s+t*Math.cos(r/2)),o=Math.sin(r)*(s+t*Math.cos(r/2)),n=t*Math.sin(r/2),new THREE.Vector3(i,o,n)},mobius3d:function(t,e){t*=Math.PI,e*=2*Math.PI,t=2*t;var i,o,n,r=t/2,s=2.25,a=.125,l=.65;return i=a*Math.cos(e)*Math.cos(r)-l*Math.sin(e)*Math.sin(r),n=a*Math.cos(e)*Math.sin(r)+l*Math.sin(e)*Math.cos(r),o=(s+i)*Math.sin(t),i=(s+i)*Math.cos(t),new THREE.Vector3(i,o,n)}},THREE.ParametricGeometries.TubeGeometry=function(t,e,i,o,n,r){this.path=t,this.segments=e||64,this.radius=i||1,this.segmentsRadius=o||8,this.closed=n||!1,r&&(this.debug=new THREE.Object3D);var s,a,l,h,c,u,d,p=this,f=this.segments+1,m=new THREE.Vector3,v=new THREE.TubeGeometry.FrenetFrames(t,e,n),g=v.tangents,E=v.normals,y=v.binormals;this.tangents=g,this.normals=E,this.binormals=y;var T=function(e,o){return o*=2*Math.PI,d=e*(f-1),d=Math.floor(d),u=t.getPointAt(e),s=g[d],a=E[d],l=y[d],p.debug&&(p.debug.add(new THREE.ArrowHelper(s,u,i,255)),p.debug.add(new THREE.ArrowHelper(a,u,i,16711680)),p.debug.add(new THREE.ArrowHelper(l,u,i,65280))),h=-p.radius*Math.cos(o),c=p.radius*Math.sin(o),m.copy(u),m.x+=h*a.x+c*l.x,m.y+=h*a.y+c*l.y,m.z+=h*a.z+c*l.z,m.clone()};THREE.ParametricGeometry.call(this,T,e,o)},THREE.ParametricGeometries.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometries.TubeGeometry.prototype.constructor=THREE.ParametricGeometries.TubeGeometry,THREE.ParametricGeometries.TorusKnotGeometry=function(t,e,i,o,n,r){this.radius=t||200,this.tube=e||40,this.segmentsT=i||64,this.segmentsR=o||8,this.p=n||2,this.q=r||3;var s=THREE.Curve.create(function(){},function(e){e*=2*Math.PI;var i=.5,o=(1+i*Math.cos(r*e))*Math.cos(n*e),s=(1+i*Math.cos(r*e))*Math.sin(n*e),a=i*Math.sin(r*e);return new THREE.Vector3(o,s,a).multiplyScalar(t)}),a=i,l=o,h=new s;THREE.ParametricGeometries.TubeGeometry.call(this,h,a,e,l,!0,!1)},THREE.ParametricGeometries.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometries.TorusKnotGeometry.prototype.constructor=THREE.ParametricGeometries.TorusKnotGeometry,THREE.ParametricGeometries.SphereGeometry=function(t,e,i){function o(e,i){e*=Math.PI,i*=2*Math.PI;var o=t*Math.sin(e)*Math.cos(i),n=t*Math.sin(e)*Math.sin(i),r=t*Math.cos(e);return new THREE.Vector3(o,n,r)}THREE.ParametricGeometry.call(this,o,e,i,!1)},THREE.ParametricGeometries.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometries.SphereGeometry.prototype.constructor=THREE.ParametricGeometries.SphereGeometry,THREE.ParametricGeometries.PlaneGeometry=function(t,e,i,o){function n(i,o){var n=i*t,r=0,s=o*e;return new THREE.Vector3(n,r,s)}THREE.ParametricGeometry.call(this,n,i,o)},THREE.ParametricGeometries.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometries.PlaneGeometry.prototype.constructor=THREE.ParametricGeometries.PlaneGeometry;var RollerCoasterGeometry=function(t,e){THREE.BufferGeometry.call(this);var i=[],o=[],n=[],r=[1,1,1],s=[1,1,0],a=new THREE.Vector3(0,1,0),l=new THREE.Vector3,h=new THREE.Vector3,c=new THREE.Quaternion,u=new THREE.Quaternion;u.setFromAxisAngle(a,Math.PI/2);var d=new THREE.Vector3,p=new THREE.Vector3;p.copy(t.getPointAt(0));for(var f=[new THREE.Vector3((-2.25),0,0),new THREE.Vector3(0,(-.5),0),new THREE.Vector3(0,(-1.75),0),new THREE.Vector3(0,(-.5),0),new THREE.Vector3(2.25,0,0),new THREE.Vector3(0,(-1.75),0)],m=2*Math.PI,v=5,g=[],E=0;E<v;E++){var y=E/v*m;g.push(new THREE.Vector3(.6*Math.sin(y),.6*Math.cos(y),0))}for(var v=6,T=[],E=0;E<v;E++){var y=E/v*m;T.push(new THREE.Vector3(.25*Math.sin(y),.25*Math.cos(y),0))}for(var b=new THREE.Vector3,w=new THREE.Vector3,x=function(t,e){w.set(0,0,-1).applyQuaternion(c);for(var r=0;r<t.length;r++)b.copy(t[r]),b.applyQuaternion(c),b.add(d),i.push(b.x,b.y,b.z),o.push(w.x,w.y,w.z),n.push(e[0],e[1],e[2]);w.set(0,0,1).applyQuaternion(c);for(var r=t.length-1;r>=0;r--)b.copy(t[r]),b.applyQuaternion(c),b.add(d),i.push(b.x,b.y,b.z),o.push(w.x,w.y,w.z),n.push(e[0],e[1],e[2])},R=new THREE.Vector3,S=new THREE.Vector3,C=new THREE.Vector3,H=new THREE.Vector3,M=new THREE.Vector3,D=new THREE.Vector3,A=new THREE.Vector3,I=new THREE.Vector3,_=function(t,e,r){for(var s=0,a=t.length;s<a;s++){var l=t[s],h=t[(s+1)%a];R.copy(l).add(e),R.applyQuaternion(c),R.add(d),S.copy(h).add(e),S.applyQuaternion(c),S.add(d),C.copy(h).add(e),C.applyQuaternion(u),C.add(p),H.copy(l).add(e),H.applyQuaternion(u),H.add(p),i.push(R.x,R.y,R.z),i.push(S.x,S.y,S.z),i.push(H.x,H.y,H.z),i.push(S.x,S.y,S.z),i.push(C.x,C.y,C.z),i.push(H.x,H.y,H.z),M.copy(l),M.applyQuaternion(c),M.normalize(),D.copy(h),D.applyQuaternion(c),D.normalize(),A.copy(h),A.applyQuaternion(u),A.normalize(),I.copy(l),I.applyQuaternion(u),I.normalize(),o.push(M.x,M.y,M.z),o.push(D.x,D.y,D.z),o.push(I.x,I.y,I.z),o.push(D.x,D.y,D.z),o.push(A.x,A.y,A.z),o.push(I.x,I.y,I.z),n.push(r[0],r[1],r[2]),n.push(r[0],r[1],r[2]),n.push(r[0],r[1],r[2]),n.push(r[0],r[1],r[2]),n.push(r[0],r[1],r[2]),n.push(r[0],r[1],r[2])}},O=new THREE.Vector3,E=1;E<=e;E++){d.copy(t.getPointAt(E/e)),a.set(0,1,0),l.subVectors(d,p).normalize(),h.crossVectors(a,l).normalize(),a.crossVectors(l,h);var y=Math.atan2(l.x,l.z);c.setFromAxisAngle(a,y),E%2===0&&x(f,s),_(g,O.set(0,-1.25,0),s),_(T,O.set(2,0,0),r),_(T,O.set(-2,0,0),r),p.copy(d),u.copy(c)}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(i),3)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(o),3)),this.addAttribute("color",new THREE.BufferAttribute(new Float32Array(n),3))};RollerCoasterGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);var RollerCoasterLiftersGeometry=function(t,e){THREE.BufferGeometry.call(this);for(var i=[],o=[],n=new THREE.Quaternion,r=new THREE.Vector3(0,1,0),s=new THREE.Vector3,a=new THREE.Vector3,l=[new THREE.Vector3(0,.5,(-.5)),new THREE.Vector3(0,.5,.5),new THREE.Vector3(0,(-.5),0)],h=[new THREE.Vector3((-.5),0,.5),new THREE.Vector3((-.5),0,(-.5)),new THREE.Vector3(.5,0,0)],c=[new THREE.Vector3(.5,0,(-.5)),new THREE.Vector3(.5,0,.5),new THREE.Vector3((-.5),0,0)],u=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector3,v=new THREE.Vector3,g=new THREE.Vector3,E=new THREE.Vector3,y=function(t,e,r){for(var s=0,a=t.length;s<a;s++){var l=t[s],h=t[(s+1)%a];u.copy(l),u.applyQuaternion(n),u.add(e),d.copy(h),d.applyQuaternion(n),d.add(e),p.copy(h),p.applyQuaternion(n),p.add(r),f.copy(l),f.applyQuaternion(n),f.add(r),i.push(u.x,u.y,u.z),i.push(d.x,d.y,d.z),i.push(f.x,f.y,f.z),i.push(d.x,d.y,d.z),i.push(p.x,p.y,p.z),i.push(f.x,f.y,f.z),m.copy(l),m.applyQuaternion(n),m.normalize(),v.copy(h),v.applyQuaternion(n),v.normalize(),g.copy(h),g.applyQuaternion(n),g.normalize(),E.copy(l),E.applyQuaternion(n),E.normalize(),o.push(m.x,m.y,m.z),o.push(v.x,v.y,v.z),o.push(E.x,E.y,E.z),o.push(v.x,v.y,v.z),o.push(g.x,g.y,g.z),o.push(E.x,E.y,E.z)}},T=new THREE.Vector3,b=new THREE.Vector3,w=1;w<=e;w++){s.copy(t.getPointAt(w/e)),a.copy(t.getTangentAt(w/e));var x=Math.atan2(a.x,a.z);n.setFromAxisAngle(r,x),s.y>100?(T.set(-7.5,-3.5,0),T.applyQuaternion(n),T.add(s),b.set(7.5,-3.5,0),b.applyQuaternion(n),b.add(s),y(l,T,b),T.set(-7,-3,0),T.applyQuaternion(n),T.add(s),b.set(-7,-s.y,0),b.applyQuaternion(n),b.add(s),y(h,T,b),T.set(7,-3,0),T.applyQuaternion(n),T.add(s),b.set(7,-s.y,0),b.applyQuaternion(n),b.add(s),y(c,T,b)):(T.set(0,-2,0),T.applyQuaternion(n),T.add(s),b.set(0,-s.y,0),b.applyQuaternion(n),b.add(s),y(c,T,b))}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(i),3)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(o),3))};RollerCoasterLiftersGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);var RollerCoasterShadowGeometry=function(t,e){THREE.BufferGeometry.call(this);var i=[],o=new THREE.Vector3(0,1,0),n=new THREE.Vector3,r=new THREE.Quaternion,s=new THREE.Quaternion;s.setFromAxisAngle(o,Math.PI/2);var a=new THREE.Vector3,l=new THREE.Vector3;l.copy(t.getPointAt(0)),l.y=0;for(var h=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,d=new THREE.Vector3,p=1;p<=e;p++){a.copy(t.getPointAt(p/e)),a.y=0,n.subVectors(a,l);var f=Math.atan2(n.x,n.z);r.setFromAxisAngle(o,f),h.set(-3,0,0),h.applyQuaternion(r),h.add(a),c.set(3,0,0),c.applyQuaternion(r),c.add(a),u.set(3,0,0),u.applyQuaternion(s),u.add(l),d.set(-3,0,0),d.applyQuaternion(s),d.add(l),i.push(h.x,h.y,h.z),i.push(c.x,c.y,c.z),i.push(d.x,d.y,d.z),i.push(c.x,c.y,c.z),i.push(u.x,u.y,u.z),i.push(d.x,d.y,d.z),l.copy(a),s.copy(r)}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(i),3))};RollerCoasterShadowGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);var SkyGeometry=function(){THREE.BufferGeometry.call(this);for(var t=[],e=0;e<100;e++){var i=8e3*Math.random()-4e3,o=500*Math.random()+500,n=8e3*Math.random()-4e3,r=400*Math.random()+200;t.push(i-r,o,n-r),t.push(i+r,o,n-r),t.push(i-r,o,n+r),t.push(i+r,o,n-r),t.push(i+r,o,n+r),t.push(i-r,o,n+r)}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3));
};SkyGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);var TreesGeometry=function(t){THREE.BufferGeometry.call(this);var e=[],i=[],o=new THREE.Raycaster;o.ray.direction.set(0,-1,0);for(var n=0;n<2e3;n++){var r=5e3*Math.random()-2500,s=5e3*Math.random()-2500;o.ray.origin.set(r,500,s);var a=o.intersectObject(t);if(0!==a.length){var l=a[0].point.y,h=50*Math.random()+5,c=Math.random()*Math.PI*2;e.push(r+10*Math.sin(c),l,s+10*Math.cos(c)),e.push(r,l+h,s),e.push(r+10*Math.sin(c+Math.PI),l,s+10*Math.cos(c+Math.PI)),c+=Math.PI/2,e.push(r+10*Math.sin(c),l,s+10*Math.cos(c)),e.push(r,l+h,s),e.push(r+10*Math.sin(c+Math.PI),l,s+10*Math.cos(c+Math.PI));for(var u=.1*Math.random(),d=0;d<6;d++)i.push(.2+u,.4+u,0)}}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(e),3)),this.addAttribute("color",new THREE.BufferAttribute(new Float32Array(i),3))};TreesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.ShaderGodRays={godrays_generate:{uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );","vec2 stepv = fStepSize * delta / dist;","float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;","if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_combine:{uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_fake_sun:{uniforms:{vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)},fAspect:{value:1},sunColor:{value:new THREE.Color(16772608)},bgColor:{value:new THREE.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;","diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n")}},THREE.ShaderSkin={skinSimple:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{enableBump:{value:0},enableSpecular:{value:0},tDiffuse:{value:null},tBeckmann:{value:null},diffuse:{value:new THREE.Color(15658734)},specular:{value:new THREE.Color(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75},bumpMap:{value:null},bumpScale:{value:1},specularMap:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)},uWrapRGB:{value:new THREE.Vector3(.75,.375,.1875)}}]),fragmentShader:["#define USE_BUMPMAP","uniform bool enableBump;","uniform bool enableSpecular;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform vec3 uWrapRGB;","uniform sampler2D tDiffuse;","uniform sampler2D tBeckmann;","uniform sampler2D specularMap;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.packing,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse.rgb *= colDiffuse.rgb;","diffuseColor = diffuseColor * colDiffuse;","vec3 normal = normalize( vNormal );","vec3 viewerDirection = normalize( vViewPosition );","float specularStrength;","if ( enableSpecular ) {","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","} else {","specularStrength = 1.0;","}","#ifdef USE_BUMPMAP","if ( enableBump ) normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","vec3 totalSpecularLight = vec3( 0.0 );","vec3 totalDiffuseLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","float pointDiffuseWeightFull = max( dot( normal, lVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, lVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), uWrapRGB );","float pointSpecularWeight = KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += pointLight[ i ].color * ( pointDiffuseWeight * attenuation );","totalSpecularLight += pointLight[ i ].color * specular * ( pointSpecularWeight * specularStrength * attenuation );","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeightFull = max( dot( normal, dirVector ), 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3 ( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), uWrapRGB );","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * ( dirSpecularWeight * specularStrength );","}","#endif","#if NUM_HEMI_LIGHTS > 0","for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","hemiSpecularWeight += KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","vec3 lVectorGround = -lVector;","hemiSpecularWeight += KS_Skin_Specular( normal, lVectorGround, viewerDirection, uRoughness, uSpecularBrightness );","vec3 hemiSpecularColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","totalSpecularLight += hemiSpecularColor * specular * ( hemiSpecularWeight * specularStrength );","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor * diffuse ) + totalSpecularLight;","gl_FragColor = linearToOutputTexel( vec4( outgoingLight, diffuseColor.a ) );",THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform vec4 offsetRepeat;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},skin:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{passID:{value:0},tDiffuse:{value:null},tNormal:{value:null},tBlur1:{value:null},tBlur2:{value:null},tBlur3:{value:null},tBlur4:{value:null},tBeckmann:{value:null},uNormalScale:{value:1},diffuse:{value:new THREE.Color(15658734)},specular:{value:new THREE.Color(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75}}]),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform int passID;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tBlur1;","uniform sampler2D tBlur2;","uniform sampler2D tBlur3;","uniform sampler2D tBlur4;","uniform sampler2D tBeckmann;","uniform float uNormalScale;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.fog_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 mSpecular = vec4( specular, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse *= colDiffuse;","diffuseColor *= colDiffuse;","vec4 posAndU = vec4( -vViewPosition, vUv.x );","vec4 posAndU_dx = dFdx( posAndU ),  posAndU_dy = dFdy( posAndU );","vec3 tangent = posAndU_dx.w * posAndU_dx.xyz + posAndU_dy.w * posAndU_dy.xyz;","vec3 normal = normalize( vNormal );","vec3 binormal = normalize( cross( tangent, normal ) );","tangent = cross( normal, binormal );","mat3 tsb = mat3( tangent, binormal, normal );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","vec3 finalNormal = tsb * normalTex;","normal = normalize( finalNormal );","vec3 viewerDirection = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 pointVector = normalize( pointLights[ i ].direction );","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","totalDiffuseLight += pointLightColor[ i ] * ( pointDiffuseWeight * attenuation );","if ( passID == 1 ) {","float pointSpecularWeight = KS_Skin_Specular( normal, pointVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += pointLightColor[ i ] * mSpecular.xyz * ( pointSpecularWeight * attenuation );","}","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","if ( passID == 1 ) {","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += directionalLights[ i ].color * mSpecular.xyz * dirSpecularWeight;","}","}","#endif","outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalSpecularLight );","if ( passID == 0 ) {","outgoingLight = sqrt( outgoingLight );","} else if ( passID == 1 ) {","#ifdef VERSION1","vec3 nonblurColor = sqrt(outgoingLight );","#else","vec3 nonblurColor = outgoingLight;","#endif","vec3 blur1Color = texture2D( tBlur1, vUv ).xyz;","vec3 blur2Color = texture2D( tBlur2, vUv ).xyz;","vec3 blur3Color = texture2D( tBlur3, vUv ).xyz;","vec3 blur4Color = texture2D( tBlur4, vUv ).xyz;","outgoingLight = vec3( vec3( 0.22,  0.437, 0.635 ) * nonblurColor + ","vec3( 0.101, 0.355, 0.365 ) * blur1Color + ","vec3( 0.119, 0.208, 0.0 )   * blur2Color + ","vec3( 0.114, 0.0,   0.0 )   * blur3Color + ","vec3( 0.444, 0.0,   0.0 )   * blur4Color );","outgoingLight *= sqrt( colDiffuse.xyz );","outgoingLight += ambientLightColor * diffuse * colDiffuse.xyz + totalSpecularLight;","#ifndef VERSION1","outgoingLight = sqrt( outgoingLight );","#endif","}","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;","gl_Position = projectionMatrix * displacedPosition;","#else","gl_Position = projectionMatrix * mvPosition;","#endif","}"].join("\n"),vertexShaderUV:["varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","gl_Position = vec4( uv.x * 2.0 - 1.0, uv.y * 2.0 - 1.0, 0.0, 1.0 );","}"].join("\n")},beckmann:{uniforms:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","float PHBeckmann( float ndoth, float m ) {","float alpha = acos( ndoth );","float ta = tan( alpha );","float val = 1.0 / ( m * m * pow( ndoth, 4.0 ) ) * exp( -( ta * ta ) / ( m * m ) );","return val;","}","float KSTextureCompute( vec2 tex ) {","return 0.5 * pow( PHBeckmann( tex.x, tex.y ), 0.1 );","}","void main() {","float x = KSTextureCompute( vUv );","gl_FragColor = vec4( x, x, x, 1.0 );","}"].join("\n")}},THREE.ShaderTerrain={terrain:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{enableDiffuse1:{value:0},enableDiffuse2:{value:0},enableSpecular:{value:0},enableReflection:{value:0},tDiffuse1:{value:null},tDiffuse2:{value:null},tDetail:{value:null},tNormal:{value:null},tSpecular:{value:null},tDisplacement:{value:null},uNormalScale:{value:1},uDisplacementBias:{value:0},uDisplacementScale:{value:1},diffuse:{value:new THREE.Color(15658734)},specular:{value:new THREE.Color(1118481)},shininess:{value:30},opacity:{value:1},uRepeatBase:{value:new THREE.Vector2(1,1)},uRepeatOverlay:{value:new THREE.Vector2(1,1)},uOffset:{value:new THREE.Vector2(0,0)}}]),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );"," } else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );",THREE.ShaderChunk.fog_fragment,"gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")}},THREE.ShaderToon={toon1:{uniforms:{uDirLightPos:{value:new THREE.Vector3},uDirLightColor:{value:new THREE.Color(15658734)},uAmbientLightColor:{value:new THREE.Color(328965)},uBaseColor:{value:new THREE.Color(16777215)}},vertexShader:["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vNormal = normalize( normalMatrix * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vRefract = refract( normalize( I ), worldNormal, 1.02 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","intensity += length(lightWeighting) * 0.2;","float cameraWeighting = dot( normalize( vNormal ), vRefract );","intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","intensity = intensity * 0.2 + 0.3;","if ( intensity < 0.50 ) {","gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","} else {","gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n")},toon2:{uniforms:{uDirLightPos:{value:new THREE.Vector3},uDirLightColor:{value:new THREE.Color(15658734)},uAmbientLightColor:{value:new THREE.Color(328965)},uBaseColor:{value:new THREE.Color(15658734)},uLineColor1:{value:new THREE.Color(8421504)},uLineColor2:{value:new THREE.Color(0)},uLineColor3:{value:new THREE.Color(0)},uLineColor4:{value:new THREE.Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","gl_FragColor *= vec4( uLineColor1, 1.0 );","}","if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","gl_FragColor *= vec4( uLineColor2, 1.0 );","}","}"].join("\n")},hatching:{uniforms:{uDirLightPos:{value:new THREE.Vector3},uDirLightColor:{value:new THREE.Color(15658734)},uAmbientLightColor:{value:new THREE.Color(328965)},uBaseColor:{value:new THREE.Color(16777215)},uLineColor1:{value:new THREE.Color(0)},uLineColor2:{value:new THREE.Color(0)},uLineColor3:{value:new THREE.Color(0)},uLineColor4:{value:new THREE.Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.75 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor2, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor3, 1.0 );","}","}","if ( length(lightWeighting) < 0.3465 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor4, 1.0 );","}","}","}"].join("\n")},dotted:{uniforms:{uDirLightPos:{value:new THREE.Vector3},uDirLightColor:{value:new THREE.Color(15658734)},uAmbientLightColor:{value:new THREE.Color(328965)},uBaseColor:{value:new THREE.Color(16777215)},uLineColor1:{value:new THREE.Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","}"].join("\n")}};var SimplexNoise=function(t){void 0==t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());this.perm=[];for(var e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};SimplexNoise.prototype.dot=function(t,e,i){return t[0]*e+t[1]*i},SimplexNoise.prototype.dot3=function(t,e,i,o){return t[0]*e+t[1]*i+t[2]*o},SimplexNoise.prototype.dot4=function(t,e,i,o,n){return t[0]*e+t[1]*i+t[2]*o+t[3]*n},SimplexNoise.prototype.noise=function(t,e){var i,o,n,r,s,a=.5*(Math.sqrt(3)-1),l=(t+e)*a,h=Math.floor(t+l),c=Math.floor(e+l),u=(3-Math.sqrt(3))/6,d=(h+c)*u,p=h-d,f=c-d,m=t-p,v=e-f;m>v?(r=1,s=0):(r=0,s=1);var g=m-r+u,E=v-s+u,y=m-1+2*u,T=v-1+2*u,b=255&h,w=255&c,x=this.perm[b+this.perm[w]]%12,R=this.perm[b+r+this.perm[w+s]]%12,S=this.perm[b+1+this.perm[w+1]]%12,C=.5-m*m-v*v;C<0?i=0:(C*=C,i=C*C*this.dot(this.grad3[x],m,v));var H=.5-g*g-E*E;H<0?o=0:(H*=H,o=H*H*this.dot(this.grad3[R],g,E));var M=.5-y*y-T*T;return M<0?n=0:(M*=M,n=M*M*this.dot(this.grad3[S],y,T)),70*(i+o+n)},SimplexNoise.prototype.noise3d=function(t,e,i){var o,n,r,s,a,l,h,c,u,d,p=1/3,f=(t+e+i)*p,m=Math.floor(t+f),v=Math.floor(e+f),g=Math.floor(i+f),E=1/6,y=(m+v+g)*E,T=m-y,b=v-y,w=g-y,x=t-T,R=e-b,S=i-w;x>=R?R>=S?(a=1,l=0,h=0,c=1,u=1,d=0):x>=S?(a=1,l=0,h=0,c=1,u=0,d=1):(a=0,l=0,h=1,c=1,u=0,d=1):R<S?(a=0,l=0,h=1,c=0,u=1,d=1):x<S?(a=0,l=1,h=0,c=0,u=1,d=1):(a=0,l=1,h=0,c=1,u=1,d=0);var C=x-a+E,H=R-l+E,M=S-h+E,D=x-c+2*E,A=R-u+2*E,I=S-d+2*E,_=x-1+3*E,O=R-1+3*E,P=S-1+3*E,N=255&m,$=255&v,L=255&g,k=this.perm[N+this.perm[$+this.perm[L]]]%12,V=this.perm[N+a+this.perm[$+l+this.perm[L+h]]]%12,U=this.perm[N+c+this.perm[$+u+this.perm[L+d]]]%12,W=this.perm[N+1+this.perm[$+1+this.perm[L+1]]]%12,j=.6-x*x-R*R-S*S;
j<0?o=0:(j*=j,o=j*j*this.dot3(this.grad3[k],x,R,S));var F=.6-C*C-H*H-M*M;F<0?n=0:(F*=F,n=F*F*this.dot3(this.grad3[V],C,H,M));var z=.6-D*D-A*A-I*I;z<0?r=0:(z*=z,r=z*z*this.dot3(this.grad3[U],D,A,I));var B=.6-_*_-O*O-P*P;return B<0?s=0:(B*=B,s=B*B*this.dot3(this.grad3[W],_,O,P)),32*(o+n+r+s)},SimplexNoise.prototype.noise4d=function(t,e,i,o){var n,r,s,a,l,h,c,u,d,p,f,m,v,g,E,y,T,b=this.grad4,w=this.simplex,x=this.perm,R=(Math.sqrt(5)-1)/4,S=(5-Math.sqrt(5))/20,C=(t+e+i+o)*R,H=Math.floor(t+C),M=Math.floor(e+C),D=Math.floor(i+C),A=Math.floor(o+C),I=(H+M+D+A)*S,_=H-I,O=M-I,P=D-I,N=A-I,$=t-_,L=e-O,k=i-P,V=o-N,U=$>L?32:0,W=$>k?16:0,j=L>k?8:0,F=$>V?4:0,z=L>V?2:0,B=k>V?1:0,G=U+W+j+F+z+B;h=w[G][0]>=3?1:0,c=w[G][1]>=3?1:0,u=w[G][2]>=3?1:0,d=w[G][3]>=3?1:0,p=w[G][0]>=2?1:0,f=w[G][1]>=2?1:0,m=w[G][2]>=2?1:0,v=w[G][3]>=2?1:0,g=w[G][0]>=1?1:0,E=w[G][1]>=1?1:0,y=w[G][2]>=1?1:0,T=w[G][3]>=1?1:0;var X=$-h+S,Q=L-c+S,K=k-u+S,q=V-d+S,Y=$-p+2*S,Z=L-f+2*S,J=k-m+2*S,tt=V-v+2*S,et=$-g+3*S,it=L-E+3*S,ot=k-y+3*S,nt=V-T+3*S,rt=$-1+4*S,st=L-1+4*S,at=k-1+4*S,lt=V-1+4*S,ht=255&H,ct=255&M,ut=255&D,dt=255&A,pt=x[ht+x[ct+x[ut+x[dt]]]]%32,ft=x[ht+h+x[ct+c+x[ut+u+x[dt+d]]]]%32,mt=x[ht+p+x[ct+f+x[ut+m+x[dt+v]]]]%32,vt=x[ht+g+x[ct+E+x[ut+y+x[dt+T]]]]%32,gt=x[ht+1+x[ct+1+x[ut+1+x[dt+1]]]]%32,Et=.6-$*$-L*L-k*k-V*V;Et<0?n=0:(Et*=Et,n=Et*Et*this.dot4(b[pt],$,L,k,V));var yt=.6-X*X-Q*Q-K*K-q*q;yt<0?r=0:(yt*=yt,r=yt*yt*this.dot4(b[ft],X,Q,K,q));var Tt=.6-Y*Y-Z*Z-J*J-tt*tt;Tt<0?s=0:(Tt*=Tt,s=Tt*Tt*this.dot4(b[mt],Y,Z,J,tt));var bt=.6-et*et-it*it-ot*ot-nt*nt;bt<0?a=0:(bt*=bt,a=bt*bt*this.dot4(b[vt],et,it,ot,nt));var wt=.6-rt*rt-st*st-at*at-lt*lt;return wt<0?l=0:(wt*=wt,l=wt*wt*this.dot4(b[gt],rt,st,at,lt)),27*(n+r+s+a+l)},THREE.ShaderLib.sky={uniforms:{luminance:{value:1},turbidity:{value:2},reileigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 sunPosition;","varying vec3 vWorldPosition;","vec3 cameraPos = vec3(0., 0., 0.);","// uniform sampler2D sDiffuse;","// const float turbidity = 10.0; //","// const float reileigh = 2.; //","// const float luminance = 1.0; //","// const float mieCoefficient = 0.005;","// const float mieDirectionalG = 0.8;","uniform float luminance;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","// constants for atmospheric scattering","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003; // refractive index of air","const float N = 2.545E25; // number of molecules per unit volume for air at","// 288.15K and 1013mb (sea level -45 celsius)","const float pn = 0.035;\t// depolatization factor for standard air","// wavelength of used primaries, according to preetham","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","// mie stuff","// K coefficient for the primaries","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","// optical length at zenith for molecules","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3(0.0, 1.0, 0.0);","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","// 66 arc seconds -> degrees, and the cosine of that","// earth shadow hack","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","// A simplied version of the total Reayleigh scattering to works on browsers that use ANGLE","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{\t ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","//\treturn (1.0 / (3.0*pi)) * (1.0 + pow(cosTheta, 2.0));","//\treturn (3.0 / 4.0) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - pow(e, -((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// float logLuminance(vec3 c)","// {","// \treturn log(c.r * 0.2126 + c.g * 0.7152 + c.b * 0.0722);","// }","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);","// luminance =  1.0 ;// vWorldPosition.y / 450000. + 0.5; //sunPosition.y / 450000. * 1. + 0.5;","// gl_FragColor = vec4(sunfade, sunfade, sunfade, 1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(sunPosition);","float sunE = sunIntensity(dot(sunDirection, up));","// extinction (absorbtion + out scattering) ","// rayleigh coefficients","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","// mie coefficients","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","// optical length","// cutoff angle at 90 to avoid singularity in next formula.","float zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","// combined extinction factor\t","vec3 Fex = exp(-(betaR * sR + betaM * sM));","// in scattering","float cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));","//nightsky","vec3 direction = normalize(vWorldPosition - cameraPos);","float theta = acos(direction.y); // elevation --> y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --> x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","// vec3 L0 = texture2D(skySampler, uv).rgb+0.1 * Fex;","vec3 L0 = vec3(0.1) * Fex;","// composition + solar disc","//if (cosTheta > sunAngularDiameterCos)","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","// if (normalize(vWorldPosition - cameraPos).y>0.0)","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminance;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1.0;","}"].join("\n")},THREE.Sky=function(){var t=THREE.ShaderLib.sky,e=THREE.UniformsUtils.clone(t.uniforms),i=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:e,side:THREE.BackSide}),o=new THREE.SphereBufferGeometry(45e4,32,15),n=new THREE.Mesh(o,i);this.mesh=n,this.uniforms=e},THREE.TimelinerController=function(t,e,i){this._scene=t,this._trackInfo=e,this._onUpdate=i,this._mixer=new THREE.AnimationMixer(t),this._clip=null,this._action=null,this._tracks={},this._propRefs={},this._channelNames=[]},THREE.TimelinerController.prototype={constructor:THREE.TimelinerController,init:function(t){for(var e=[],i=this._trackInfo,o=0,n=i.length;o!==n;++o){var r=i[o];e.push(this._addTrack(r.type,r.propertyPath,r.initialValue,r.interpolation))}this._clip=new THREE.AnimationClip("editclip",0,e),this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(t){this._action.time=t,this._mixer.update(0),this._onUpdate()},setDuration:function(t){this._clip.duration=t},getChannelNames:function(){return this._channelNames},getChannelKeyTimes:function(t){return this._tracks[t].times},setKeyframe:function(t,e){var i=this._tracks[t],o=i.times,n=Timeliner.binarySearch(o,e),r=i.values,s=i.getValueSize(),a=n*s;if(n<0){n=~n,a=n*s;for(var l=o.length+1,h=r.length+s,c=l-1;c!==n;--c)o[c]=o[c-1];for(var c=h-1,u=a+s-1;c!==u;--c)r[c]=r[c-s]}o[n]=e,this._propRefs[t].getValue(r,a)},delKeyframe:function(t,e){var i=this._tracks[t],o=i.times,n=Timeliner.binarySearch(o,e);if(o.length>1&&n>=0){for(var r=o.length-1,s=i.values,a=i.getValueSize(),l=s.length-a,h=n;h!==r;++h)o[h]=o[h+1];o.pop();for(var c=n*a;c!==l;++c)s[c]=s[c+a];s.length=l}},moveKeyframe:function(t,e,i,o){var n=this._tracks[t],r=n.times,s=Timeliner.binarySearch(r,e);if(s>=0){for(var a=o?r.length:s+1,l=r[s-1]<=e||!o&&e>=r[s+1];s!==a;)r[s++]+=i;l&&this._sort(n)}},serialize:function(){for(var t={duration:this._clip.duration,channels:{}},e=this._channelNames,i=this._tracks,o=t.channels,n=0,r=e.length;n!==r;++n){var s=e[n],a=i[s];o[s]={times:a.times,values:a.values}}return t},deserialize:function(t){var e=this._channelNames,i=this._tracks,o=t.channels;this.setDuration(t.duration);for(var n=0,r=e.length;n!==r;++n){var s=e[n],a=i[s];data=o[s],this._setArray(a.times,data.times),this._setArray(a.values,data.values)}this.setDisplayTime(this._mixer.time)},_sort:function(t){var e=t.times,i=THREE.AnimationUtils.getKeyframeOrder(e);this._setArray(e,THREE.AnimationUtils.sortedArray(e,1,i));var o=t.values,n=t.getValueSize();this._setArray(o,THREE.AnimationUtils.sortedArray(o,n,i))},_setArray:function(t,e){t.length=0,t.push.apply(t,e)},_addTrack:function(t,e,i,o){var n=new t(e,[0],i,o);return n.times=Array.prototype.slice.call(n.times),n.values=Array.prototype.slice.call(n.values),this._channelNames.push(e),this._tracks[e]=n,this._propRefs[e]=new THREE.PropertyBinding(this._scene,e),n}},THREE.TypedArrayUtils={},THREE.TypedArrayUtils.quicksortIP=function(t,e,i){for(var o,n,r=[],s=-1,a=0,l=t.length/e-1,h=0,c=0,u=0,d=function(i,o){for(i*=e,o*=e,u=0;u<e;u++)h=t[i+u],t[i+u]=t[o+u],t[o+u]=h},p=new Float32Array(e),f=new Float32Array(e);;)if(l-a<=25){for(n=a+1;n<=l;n++){for(c=0;c<e;c++)p[c]=t[n*e+c];for(o=n-1;o>=a&&t[o*e+i]>p[i];){for(c=0;c<e;c++)t[(o+1)*e+c]=t[o*e+c];o--}for(c=0;c<e;c++)t[(o+1)*e+c]=p[c]}if(s==-1)break;l=r[s--],a=r[s--]}else{var m=a+l>>1;for(o=a+1,n=l,d(m,o),t[a*e+i]>t[l*e+i]&&d(a,l),t[o*e+i]>t[l*e+i]&&d(o,l),t[a*e+i]>t[o*e+i]&&d(a,o),c=0;c<e;c++)f[c]=t[o*e+c];for(;;){do o++;while(t[o*e+i]<f[i]);do n--;while(t[n*e+i]>f[i]);if(n<o)break;d(o,n)}for(c=0;c<e;c++)t[(a+1)*e+c]=t[n*e+c],t[n*e+c]=f[c];l-o+1>=n-a?(r[++s]=o,r[++s]=l,l=n-1):(r[++s]=a,r[++s]=n-1,a=o)}return t},THREE.TypedArrayUtils.Kdtree=function(t,e,i){function o(t,e,a,l){var h,c,u=e%i,d=t.length/i;return e>r&&(r=e),0===d?null:1===d?new n.Node(s(t,0),e,a,l):(THREE.TypedArrayUtils.quicksortIP(t,i,u),h=Math.floor(d/2),c=new n.Node(s(t,h),e,a,h+l),c.left=o(t.subarray(0,h*i),e+1,c,l),c.right=o(t.subarray((h+1)*i,t.length),e+1,c,l+h+1),c)}var n=this,r=0,s=function(t,e){return t.subarray(e*i,e*i+i)};this.root=o(t,0,null,0),this.getMaxDepth=function(){return r},this.nearest=function(t,o,r){function s(n){function r(t,e){h.push([t,e]),h.size()>o&&h.pop()}var a,l,c,u=n.depth%i,d=e(t,n.obj),p=0,f=[];for(c=0;c<i;c+=1)c===n.depth%i?f[c]=t[c]:f[c]=n.obj[c];return p=e(f,n.obj),null===n.right&&null===n.left?void((h.size()<o||d<h.peek()[1])&&r(n,d)):(a=null===n.right?n.left:null===n.left?n.right:t[u]<n.obj[u]?n.left:n.right,s(a),(h.size()<o||d<h.peek()[1])&&r(n,d),void((h.size()<o||Math.abs(p)<h.peek()[1])&&(l=a===n.left?n.right:n.left,null!==l&&s(l))))}var a,l,h;if(h=new THREE.TypedArrayUtils.Kdtree.BinaryHeap(function(t){return-t[1]}),r)for(a=0;a<o;a+=1)h.push([null,r]);for(s(n.root),l=[],a=0;a<o;a+=1)h.content[a][0]&&l.push([h.content[a][0],h.content[a][1]]);return l}},THREE.TypedArrayUtils.Kdtree.prototype.Node=function(t,e,i,o){this.obj=t,this.left=null,this.right=null,this.parent=i,this.depth=e,this.pos=o},THREE.TypedArrayUtils.Kdtree.BinaryHeap=function(t){this.content=[],this.scoreFunction=t},THREE.TypedArrayUtils.Kdtree.BinaryHeap.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,i=0;i<e;i++)if(this.content[i]==t){var o=this.content.pop();return void(i!=e-1&&(this.content[i]=o,this.scoreFunction(o)<this.scoreFunction(t)?this.bubbleUp(i):this.sinkDown(i)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var i=Math.floor((t+1)/2)-1,o=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(o)))break;this.content[i]=e,this.content[t]=o,t=i}},sinkDown:function(t){for(var e=this.content.length,i=this.content[t],o=this.scoreFunction(i);;){var n=2*(t+1),r=n-1,s=null;if(r<e){var a=this.content[r],l=this.scoreFunction(a);l<o&&(s=r)}if(n<e){var h=this.content[n],c=this.scoreFunction(h);c<(null===s?o:l)&&(s=n)}if(null===s)break;this.content[t]=this.content[s],this.content[s]=i,t=s}}},THREE.UCSCharacter=function(){function t(t,e){for(var i=new THREE.TextureLoader,n=[],r=0;r<e.length;r++)n[r]=i.load(t+e[r],o.checkLoadComplete),n[r].mapping=THREE.UVMapping,n[r].name=e[r];return n}function e(t){for(var e=[],i=0;i<t.length;i++)e[i]=new THREE.MeshLambertMaterial({color:15658734,specular:10,map:t[i],skinning:!0,morphTargets:!0});return e}var i,o=this;this.scale=1,this.root=new THREE.Object3D,this.numSkins,this.numMorphs,this.skins=[],this.materials=[],this.morphs=[],this.mixer=new THREE.AnimationMixer(this.root),this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(n){this.numSkins=n.skins.length,this.numMorphs=n.morphs.length,this.loadCounter=1+n.skins.length,this.skins=t(n.baseUrl+"skins/",n.skins),this.materials=e(this.skins),this.morphs=n.morphs;var r=new THREE.JSONLoader;console.log(n.baseUrl+n.character),r.load(n.baseUrl+n.character,function(t){t.computeBoundingBox(),t.computeVertexNormals(),i=new THREE.SkinnedMesh(t,new THREE.MultiMaterial),i.name=n.character,o.root.add(i);var e=t.boundingBox;o.root.scale.set(n.s,n.s,n.s),o.root.position.set(n.x,n.y-e.min.y*n.s,n.z),i.castShadow=!0,i.receiveShadow=!0,o.mixer.clipAction(t.animations[0],i).play(),o.setSkin(0),o.checkLoadComplete()})},this.setSkin=function(t){i&&o.materials&&(i.material=o.materials[t])},this.updateMorphs=function(t){if(i)for(var e=0;e<o.numMorphs;e++)i.morphTargetInfluences[e]=t[o.morphs[e]]/100},this.checkLoadComplete=function(){o.loadCounter-=1,0===o.loadCounter&&o.onLoadComplete()}},THREE.ViveController=function(t){function e(){requestAnimationFrame(e);var o=navigator.getGamepads()[t];if(void 0!==o&&null!==o.pose){var n=o.pose;i.position.fromArray(n.position),i.quaternion.fromArray(n.orientation),i.matrix.compose(i.position,i.quaternion,i.scale),i.matrix.multiplyMatrices(i.standingMatrix,i.matrix),i.matrixWorldNeedsUpdate=!0,i.visible=!0}else i.visible=!1}THREE.Object3D.call(this),this.matrixAutoUpdate=!1,this.standingMatrix=new THREE.Matrix4;var i=this;e()},THREE.ViveController.prototype=Object.create(THREE.Object3D.prototype),THREE.ViveController.prototype.constructor=THREE.ViveController,THREE.Volume=function(t,e,i,o,n){if(arguments.length>0){switch(this.xLength=Number(t)||1,this.yLength=Number(e)||1,this.zLength=Number(i)||1,o){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(n);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(n);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(n);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(n);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(n);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32":case"uint32_t":this.data=new Uint32Array(n);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in THREE.Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(n);break;case"Float64":case"float64":case"double":this.data=new Float64Array(n);break;default:this.data=new Uint8Array(n)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in THREE.Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new THREE.Matrix3,this.matrix.identity();var r=-(1/0);Object.defineProperty(this,"lowerThreshold",{get:function(){return r},set:function(t){r=t,this.sliceList.forEach(function(t){t.geometryNeedsUpdate=!0})}});var s=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return s},set:function(t){s=t,this.sliceList.forEach(function(t){t.geometryNeedsUpdate=!0})}}),this.sliceList=[]},THREE.Volume.prototype={constructor:THREE.Volume,getData:function(t,e,i){return this.data[i*this.xLength*this.yLength+e*this.xLength+t]},access:function(t,e,i){return i*this.xLength*this.yLength+e*this.xLength+t},reverseAccess:function(t){var e=Math.floor(t/(this.yLength*this.xLength)),i=Math.floor((t-e*this.yLength*this.xLength)/this.xLength),o=t-e*this.yLength*this.xLength-i*this.xLength;return[o,i,e]},map:function(t,e){var i=this.data.length;e=e||this;for(var o=0;o<i;o++)this.data[o]=t.call(e,this.data[o],o,this.data);return this},extractPerpendicularPlane:function(axis,RASIndex){var iLength,jLength,sliceAccess,planeMatrix=(new THREE.Matrix4).identity(),volume=this,planeWidth,planeHeight,firstSpacing,secondSpacing,positionOffset,IJKIndex,axisInIJK=new THREE.Vector3,firstDirection=new THREE.Vector3,secondDirection=new THREE.Vector3,dimensions=new THREE.Vector3(this.xLength,this.yLength,this.zLength);switch(axis){case"x":axisInIJK.set(1,0,0),firstDirection.set(0,0,-1),secondDirection.set(0,-1,0),firstSpacing=this.spacing[2],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(RASIndex,0,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationY(Math.PI/2)),positionOffset=(volume.RASDimensions[0]-1)/2,planeMatrix.setPosition(new THREE.Vector3(RASIndex-positionOffset,0,0));break;case"y":axisInIJK.set(0,1,0),firstDirection.set(1,0,0),secondDirection.set(0,0,1),firstSpacing=this.spacing[0],secondSpacing=this.spacing[2],IJKIndex=new THREE.Vector3(0,RASIndex,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationX(-Math.PI/2)),positionOffset=(volume.RASDimensions[1]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,RASIndex-positionOffset,0));break;case"z":default:axisInIJK.set(0,0,1),firstDirection.set(1,0,0),secondDirection.set(0,-1,0),firstSpacing=this.spacing[0],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(0,0,RASIndex),positionOffset=(volume.RASDimensions[2]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,0,RASIndex-positionOffset))}firstDirection.applyMatrix4(volume.inverseMatrix).normalize(),firstDirection.argVar="i",secondDirection.applyMatrix4(volume.inverseMatrix).normalize(),secondDirection.argVar="j",axisInIJK.applyMatrix4(volume.inverseMatrix).normalize(),iLength=Math.floor(Math.abs(firstDirection.dot(dimensions))),jLength=Math.floor(Math.abs(secondDirection.dot(dimensions))),planeWidth=Math.abs(iLength*firstSpacing),planeHeight=Math.abs(jLength*secondSpacing),IJKIndex=Math.abs(Math.round(IJKIndex.applyMatrix4(volume.inverseMatrix).dot(axisInIJK)));var base=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],iDirection=[firstDirection,secondDirection,axisInIJK].find(function(t){return Math.abs(t.dot(base[0]))>.9}),jDirection=[firstDirection,secondDirection,axisInIJK].find(function(t){return Math.abs(t.dot(base[1]))>.9}),kDirection=[firstDirection,secondDirection,axisInIJK].find(function(t){return Math.abs(t.dot(base[2]))>.9}),argumentsWithInversion=["volume.xLength-1-","volume.yLength-1-","volume.zLength-1-"],arguments=["i","j","k"],argArray=[iDirection,jDirection,kDirection].map(function(t,e){return(t.dot(base[e])>0?"":argumentsWithInversion[e])+(t===axisInIJK?"IJKIndex":t.argVar)}),argString=argArray.join(",");return sliceAccess=eval("(function sliceAccess (i,j) {return volume.access( "+argString+");})"),{iLength:iLength,jLength:jLength,sliceAccess:sliceAccess,matrix:planeMatrix,planeWidth:planeWidth,planeHeight:planeHeight}},extractSlice:function(t,e){var i=new THREE.VolumeSlice(this,e,t);return this.sliceList.push(i),i},repaintAllSlices:function(){return this.sliceList.forEach(function(t){t.repaint()}),this},computeMinMax:function(){var t=1/0,e=-(1/0),i=this.data.length,o=0;for(o=0;o<i;o++)if(!isNaN(this.data[o])){var n=this.data[o];t=Math.min(t,n),e=Math.max(e,n)}return this.min=t,this.max=e,[t,e]}},THREE.VolumeSlice=function(t,e,i){var o=this;this.volume=t,e=e||0,Object.defineProperty(this,"index",{get:function(){return e},set:function(t){return e=t,o.geometryNeedsUpdate=!0,e}}),this.axis=i||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var n=new THREE.Texture(this.canvas);n.minFilter=THREE.LinearFilter,n.wrapS=n.wrapT=THREE.ClampToEdgeWrapping;var r=new THREE.MeshBasicMaterial({map:n,side:THREE.DoubleSide,transparent:!0});this.mesh=new THREE.Mesh(this.geometry,r),this.geometryNeedsUpdate=!0,this.repaint()},THREE.VolumeSlice.prototype={constructor:THREE.VolumeSlice,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var t=this.iLength,e=this.jLength,i=this.sliceAccess,o=this.volume,n=(this.axis,this.index,this.canvasBuffer),r=this.ctxBuffer,s=r.getImageData(0,0,t,e),a=s.data,l=o.data,h=o.upperThreshold,c=o.lowerThreshold,u=o.windowLow,d=o.windowHigh,p=0;if("label"===o.dataType)for(var f=0;f<e;f++)for(var m=0;m<t;m++){var v=l[i(m,f)];v=v>=this.colorMap.length?v%this.colorMap.length+1:v;var g=this.colorMap[v];a[4*p]=g>>24&255,a[4*p+1]=g>>16&255,a[4*p+2]=g>>8&255,a[4*p+3]=255&g,p++}else for(var f=0;f<e;f++)for(var m=0;m<t;m++){var E=l[i(m,f)],y=255;y=h>=E&&c<=E?y:0,E=Math.floor(255*(E-u)/(d-u)),E=E>255?255:E<0?0:0|E,a[4*p]=E,a[4*p+1]=E,a[4*p+2]=E,a[4*p+3]=y,p++}r.putImageData(s,0,0),this.ctx.drawImage(n,0,0,t,e,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var t=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=t.sliceAccess,this.jLength=t.jLength,this.iLength=t.iLength,this.matrix=t.matrix,this.canvas.width=t.planeWidth,this.canvas.height=t.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry=new THREE.PlaneGeometry(t.planeWidth,t.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix=(new THREE.Matrix4).identity(),this.mesh.applyMatrix(this.matrix)),this.geometryNeedsUpdate=!1}},THREE.ShaderLib.water={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},distortionScale:{value:20},noiseScale:{value:1},textureMatrix:{value:new THREE.Matrix4},sunColor:{value:new THREE.Color(8355711)},sunDirection:{value:new THREE.Vector3(.70707,.70707,0)},eye:{value:new THREE.Vector3},waterColor:{value:new THREE.Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","void main()","{","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyz;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","vec4 getNoise( vec2 uv )","{","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor )","{","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,"void main()","{","\tvec4 noise = getNoise( worldPosition.xz );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( sunColor * diffuseLight * 0.3 + scatter, ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance );","\tvec3 outgoingLight = albedo;",THREE.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, alpha );","}"].join("\n")},THREE.Water=function(t,e,i,o){function n(t,e){return void 0!==t?t:e}THREE.Object3D.call(this),this.name="water_"+this.id,o=o||{},this.matrixNeedsUpdate=!0;var r=n(o.textureWidth,512),s=n(o.textureHeight,512);this.clipBias=n(o.clipBias,0),this.alpha=n(o.alpha,1),this.time=n(o.time,0),this.normalSampler=n(o.waterNormals,null),this.sunDirection=n(o.sunDirection,new THREE.Vector3(.70707,.70707,0)),this.sunColor=new THREE.Color(n(o.sunColor,16777215)),this.waterColor=new THREE.Color(n(o.waterColor,8355711)),this.eye=n(o.eye,new THREE.Vector3(0,0,0)),this.distortionScale=n(o.distortionScale,20),this.side=n(o.side,THREE.FrontSide),this.fog=n(o.fog,!1),this.renderer=t,this.scene=i,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.mirrorWorldPosition=new THREE.Vector3,this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,(-1)),this.clipPlane=new THREE.Vector4,e instanceof THREE.PerspectiveCamera?this.camera=e:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.renderTarget=new THREE.WebGLRenderTarget(r,s),this.renderTarget2=new THREE.WebGLRenderTarget(r,s);var a=THREE.ShaderLib.water,l=THREE.UniformsUtils.clone(a.uniforms);this.material=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:l,transparent:!0,side:this.side,fog:this.fog}),this.material.uniforms.mirrorSampler.value=this.renderTarget.texture,this.material.uniforms.textureMatrix.value=this.textureMatrix,this.material.uniforms.alpha.value=this.alpha,this.material.uniforms.time.value=this.time,this.material.uniforms.normalSampler.value=this.normalSampler,this.material.uniforms.sunColor.value=this.sunColor,this.material.uniforms.waterColor.value=this.waterColor,this.material.uniforms.sunDirection.value=this.sunDirection,this.material.uniforms.distortionScale.value=this.distortionScale,this.material.uniforms.eye.value=this.eye,THREE.Math.isPowerOfTwo(r)&&THREE.Math.isPowerOfTwo(s)||(this.renderTarget.texture.generateMipmaps=!1,this.renderTarget.texture.minFilter=THREE.LinearFilter,this.renderTarget2.texture.generateMipmaps=!1,this.renderTarget2.texture.minFilter=THREE.LinearFilter),this.updateTextureMatrix(),this.render()},THREE.Water.prototype=Object.create(THREE.Mirror.prototype),THREE.Water.prototype.constructor=THREE.Water,THREE.Water.prototype.updateTextureMatrix=function(){function t(t){return t?t<0?-1:1:0}this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix);var e=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition);e.reflect(this.normal).negate(),e.add(this.mirrorWorldPosition),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var i=this.mirrorWorldPosition.clone().sub(this.lookAtPosition);i.reflect(this.normal).negate(),i.add(this.mirrorWorldPosition),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(e),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(i),this.mirrorCamera.aspect=this.camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var o=new THREE.Vector4,n=this.mirrorCamera.projectionMatrix;o.x=(t(this.clipPlane.x)+n.elements[8])/n.elements[0],o.y=(t(this.clipPlane.y)+n.elements[9])/n.elements[5],
o.z=-1,o.w=(1+n.elements[10])/n.elements[14];var r=new THREE.Vector4;r=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(o)),n.elements[2]=r.x,n.elements[6]=r.y,n.elements[10]=r.z+1-this.clipBias,n.elements[14]=r.w;var s=new THREE.Vector3;s.setFromMatrixPosition(this.camera.matrixWorld),this.eye=s,this.material.uniforms.eye.value=this.eye};var WEBVR={isLatestAvailable:function(){return void 0!==navigator.getVRDisplays},isAvailable:function(){return void 0!==navigator.getVRDisplays||void 0!==navigator.getVRDevices},getMessage:function(){var t;if(navigator.getVRDisplays?navigator.getVRDisplays().then(function(e){0===e.length&&(t="WebVR supported, but no VRDisplays found.")}):t=navigator.getVRDevices?'Your browser supports WebVR but not the latest version. See <a href="http://webvr.info">webvr.info</a> for more info.':'Your browser does not support WebVR. See <a href="http://webvr.info">webvr.info</a> for assistance.',void 0!==t){var e=document.createElement("div");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.right="0",e.style.zIndex="999",e.align="center";var i=document.createElement("div");return i.style.fontFamily="sans-serif",i.style.fontSize="16px",i.style.fontStyle="normal",i.style.lineHeight="26px",i.style.backgroundColor="#fff",i.style.color="#000",i.style.padding="10px 20px",i.style.margin="50px",i.style.display="inline-block",i.innerHTML=t,e.appendChild(i),e}},getButton:function(t){var e=document.createElement("button");return e.style.position="absolute",e.style.left="calc(50% - 50px)",e.style.bottom="20px",e.style.width="100px",e.style.border="0",e.style.padding="8px",e.style.cursor="pointer",e.style.backgroundColor="#000",e.style.color="#fff",e.style.fontFamily="sans-serif",e.style.fontSize="13px",e.style.fontStyle="normal",e.style.textAlign="center",e.style.zIndex="999",e.textContent="ENTER VR",e.onclick=function(){t.isPresenting?t.exitPresent():t.requestPresent()},window.addEventListener("vrdisplaypresentchange",function(i){e.textContent=t.isPresenting?"EXIT VR":"ENTER VR"},!1),e}};